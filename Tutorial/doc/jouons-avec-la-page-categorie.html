<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Tuto Jobeet Symfony2 FR :: Tutoriel Jobeet avec Symfony2</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" type="text/css" href="assets/css/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="assets/css/bootstrap-responsive.css" />
<link rel="stylesheet" type="text/css" href="assets/css/style.css" />
<link rel="stylesheet" type="text/css" href="assets/css/docs.css" />
<link rel="stylesheet" type="text/css" href="assets/css/prettify.css" />
<link rel="stylesheet" type="text/css" href="assets/css/shadowbox.css" />
<link rel="stylesheet" type="text/css" href="assets/css/print.css" media="print" />
<link rel="shortcut icon" href="assets/img/favicon.ico">
<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
</head>

<body>
	<a href="https://github.com/thujohn/Jobeet" target="_blank" id="gogithub"><img src="assets/img/github.gif" alt="" /></a>
	<div class="navbar navbar-inverse hide-on-desktop show-on-tablets show-on-mobile noprint">
		<div class="navbar-inner noprint">
			<div class="container">
				<button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="brand" href="./">Jobeet FR</a>
				<div class="nav-collapse collapse">
					<ul class="nav">
						<li class="sommaire"><a href="sommaire.html"><i class="icon-chevron-right"></i>Sommaire</a></li><li class="demarrage-du-projet"><a href="demarrage-du-projet.html"><i class="icon-chevron-right"></i><strong>[01]</strong> Démarrage du projet</a></li><li class="le-projet"><a href="le-projet.html"><i class="icon-chevron-right"></i><strong>[02]</strong> Le projet</a></li><li class="le-modele-de-donnees"><a href="le-modele-de-donnees.html"><i class="icon-chevron-right"></i><strong>[03]</strong> Le Modèle de Données</a></li><li class="le-controleur-et-la-vue"><a href="le-controleur-et-la-vue.html"><i class="icon-chevron-right"></i><strong>[04]</strong> Le Contrôleur et la Vue</a></li><li class="le-routage"><a href="le-routage.html"><i class="icon-chevron-right"></i><strong>[05]</strong> Le Routage</a></li><li class="aller-plus-loin-avec-le-modele"><a href="aller-plus-loin-avec-le-modele.html"><i class="icon-chevron-right"></i><strong>[06]</strong> Aller plus loin avec le Modèle</a></li><li class="active"><a href="jouons-avec-la-page-categorie.html"><i class="icon-chevron-right"></i><strong>[07]</strong> Jouons avec les catégories</a></li><li class="les-tests-unitaires"><a href="les-tests-unitaires.html"><i class="icon-chevron-right"></i><strong>[08]</strong> Les tests unitaires</a></li><li class="les-tests-fonctionnels"><a href="les-tests-fonctionnels.html"><i class="icon-chevron-right"></i><strong>[09]</strong> Les tests fonctionnels</a></li><li class="les-formulaires"><a href="les-formulaires.html"><i class="icon-chevron-right"></i><strong>[10]</strong> Les formulaires</a></li><li class="testez-vos-formulaires"><a href="testez-vos-formulaires.html"><i class="icon-chevron-right"></i><strong>[11]</strong> Testez vos formulaires</a></li><li class="le-paquet-admin"><a href="le-paquet-admin.html"><i class="icon-chevron-right"></i><strong>[12]</strong> Le paquet Admin</a></li><li class="securite"><a href="securite.html"><i class="icon-chevron-right"></i><strong>[13]</strong> Sécurité</a></li><li class="flux-de-donnees"><a href="flux-de-donnees.html"><i class="icon-chevron-right"></i><strong>[14]</strong> Flux de données</a></li><li class="services-web"><a href="services-web.html"><i class="icon-chevron-right"></i><strong>[15]</strong> Services Web</a></li><li class="l-envoi-d-email"><a href="l-envoi-d-email.html"><i class="icon-chevron-right"></i><strong>[16]</strong> L'envoi d'email</a></li><li class="la-recherche"><a href="la-recherche.html"><i class="icon-chevron-right"></i><strong>[17]</strong> La recherche</a></li><li class="ajax"><a href="ajax.html"><i class="icon-chevron-right"></i><strong>[18]</strong> AJAX</a></li><li class="internationalisation-et-regionalisation"><a href="internationalisation-et-regionalisation.html"><i class="icon-chevron-right"></i><strong>[19]</strong> Internationalisation et régionalisation</a></li>
					</ul>
				</div>
			</div>
		</div>
	</div>
	<div id="container">
		<div id="bootstrap-docs">
			<header class="jumbotron subhead hide-on-tablets hide-on-mobile" id="overview">
				<div class="container">
					<h1><a href="./">Jobeet FR</a></h1>
					<p class="lead">Le tutoriel pour Symfony2 en français</p>
				</div>
			</header>
			<div class="container">
				<div class="row">
										<div class="span3 bs-docs-sidebar hide-on-tablets hide-on-mobile noprint">
						<ul class="nav nav-list bs-docs-sidenav">
							<li class="sommaire"><a href="sommaire.html"><i class="icon-chevron-right"></i>Sommaire</a></li><li class="demarrage-du-projet"><a href="demarrage-du-projet.html"><i class="icon-chevron-right"></i><strong>[01]</strong> Démarrage du projet</a></li><li class="le-projet"><a href="le-projet.html"><i class="icon-chevron-right"></i><strong>[02]</strong> Le projet</a></li><li class="le-modele-de-donnees"><a href="le-modele-de-donnees.html"><i class="icon-chevron-right"></i><strong>[03]</strong> Le Modèle de Données</a></li><li class="le-controleur-et-la-vue"><a href="le-controleur-et-la-vue.html"><i class="icon-chevron-right"></i><strong>[04]</strong> Le Contrôleur et la Vue</a></li><li class="le-routage"><a href="le-routage.html"><i class="icon-chevron-right"></i><strong>[05]</strong> Le Routage</a></li><li class="aller-plus-loin-avec-le-modele"><a href="aller-plus-loin-avec-le-modele.html"><i class="icon-chevron-right"></i><strong>[06]</strong> Aller plus loin avec le Modèle</a></li><li class="active"><a href="jouons-avec-la-page-categorie.html"><i class="icon-chevron-right"></i><strong>[07]</strong> Jouons avec les catégories</a></li><li class="les-tests-unitaires"><a href="les-tests-unitaires.html"><i class="icon-chevron-right"></i><strong>[08]</strong> Les tests unitaires</a></li><li class="les-tests-fonctionnels"><a href="les-tests-fonctionnels.html"><i class="icon-chevron-right"></i><strong>[09]</strong> Les tests fonctionnels</a></li><li class="les-formulaires"><a href="les-formulaires.html"><i class="icon-chevron-right"></i><strong>[10]</strong> Les formulaires</a></li><li class="testez-vos-formulaires"><a href="testez-vos-formulaires.html"><i class="icon-chevron-right"></i><strong>[11]</strong> Testez vos formulaires</a></li><li class="le-paquet-admin"><a href="le-paquet-admin.html"><i class="icon-chevron-right"></i><strong>[12]</strong> Le paquet Admin</a></li><li class="securite"><a href="securite.html"><i class="icon-chevron-right"></i><strong>[13]</strong> Sécurité</a></li><li class="flux-de-donnees"><a href="flux-de-donnees.html"><i class="icon-chevron-right"></i><strong>[14]</strong> Flux de données</a></li><li class="services-web"><a href="services-web.html"><i class="icon-chevron-right"></i><strong>[15]</strong> Services Web</a></li><li class="l-envoi-d-email"><a href="l-envoi-d-email.html"><i class="icon-chevron-right"></i><strong>[16]</strong> L'envoi d'email</a></li><li class="la-recherche"><a href="la-recherche.html"><i class="icon-chevron-right"></i><strong>[17]</strong> La recherche</a></li><li class="ajax"><a href="ajax.html"><i class="icon-chevron-right"></i><strong>[18]</strong> AJAX</a></li><li class="internationalisation-et-regionalisation"><a href="internationalisation-et-regionalisation.html"><i class="icon-chevron-right"></i><strong>[19]</strong> Internationalisation et régionalisation</a></li>
						</ul>
					</div>
					<div class="span9">
                        <section class="justify">
                        <a href="jouons-avec-la-page-categorie-full.html" class="pull-right btn btn-success hide-on-tablets hide-on-mobile noprint">Pleine page</a><div class="page-header clearfix"><h1 class="pull-left">Jouons avec la page Catégorie</h1></div>
							<p>Dans ce chapitre, nous allons faire la page de catégorie, comme il est décrit dans les scénarios du deuxième chapitre: "<em>L'utilisateur voit une liste de toutes les offres d'emploi de la catégorie triées par date et paginée avec 20 emplois par page</em>".</p>
<br>
<h2>La route Category</h2>
<p>Tout d'abord, nous devons ajouter une route pour utiliser des URL propres pour la page de catégorie. Ajoutez ce code au début du fichier de configuration:</p>
<pre class="prettyprint linenums lang-yaml"><ol class="linenums"><li class="L0"><span class="com"># src/Ens/JobeetBundle/Resources/config/routing.yml</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="kwd">EnsJobeetBundle_category:</span></li><li class="L3"><span class="pln">    </span><span class="kwd">pattern: </span><span class="pln"> /category/{slug}</span></li><li class="L4"><span class="pln">    </span><span class="kwd">defaults: </span><span class="pln">{ </span><span class="kwd">_controller: </span><span class="pln">EnsJobeetBundle</span><span class="pun">:</span><span class="pln">Category</span><span class="pun">:</span><span class="pln">show }</span></li></ol></pre>
<p>Pour obtenir le jeton (slug) d'une catégorie, nous devons ajouter la méthode <strong>getSlug()</strong> à notre classe <strong>Category</strong>:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">// src/Ens/JobeetBundle/Entity/Category.php</span></li><li class="L1"><span class="com">// ...</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="kwd">use</span><span class="pln"> </span><span class="typ">Ens</span><span class="pln">\JobeetBundle\Utils\Jobeet</span><span class="pun">;</span></li><li class="L4"><span class="pln"> </span></li><li class="L5"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Category</span></li><li class="L6"><span class="pun">{</span></li><li class="L7"><span class="pln">  </span><span class="com">// ...</span></li><li class="L8"><span class="pln"> </span></li><li class="L9"><span class="pln">  </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> getSlug</span><span class="pun">()</span></li><li class="L0"><span class="pln">  </span><span class="pun">{</span></li><li class="L1"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Jobeet</span><span class="pun">::</span><span class="pln">slugify</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">getName</span><span class="pun">());</span></li><li class="L2"><span class="pln">  </span><span class="pun">}</span></li><li class="L3"><span class="pln"> </span></li><li class="L4"><span class="pln">  </span><span class="com">// ...</span></li><li class="L5"><span class="pun">}</span></li></ol></pre>
<br>
<h2>Le lien de la catégorie</h2>
<p>Maintenant, modifiez le template <strong>index.html.twig</strong> du contrôleur <strong>Job</strong> et ajoutez le lien vers la page catégorie:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">&lt;!-- src/Ens/JobeetBundle/Resources/views/Job/index.html.twig --&gt;</span></li><li class="L1"><span class="com">&lt;!-- some HTML code --&gt;</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pln">            </span><span class="tag">&lt;h1&gt;&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('EnsJobeetBundle_category', { 'slug': category.slug }) }}"</span><span class="tag">&gt;</span><span class="pln">{{ category.name }}</span><span class="tag">&lt;/a&gt;&lt;/h1&gt;</span></li><li class="L4"><span class="pln"> </span></li><li class="L5"><span class="com">&lt;!-- some HTML code --&gt;</span></li><li class="L6"><span class="pln"> </span></li><li class="L7"><span class="pln">          </span><span class="tag">&lt;/table&gt;</span></li><li class="L8"><span class="pln"> </span></li><li class="L9"><span class="pln">          {% if category.morejobs %}</span></li><li class="L0"><span class="pln">            </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"more_jobs"</span><span class="tag">&gt;</span></li><li class="L1"><span class="pln">              and </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('EnsJobeetBundle_category', { 'slug': category.slug }) }}"</span><span class="tag">&gt;</span><span class="pln">{{ category.morejobs }}</span><span class="tag">&lt;/a&gt;</span></li><li class="L2"><span class="pln">              more...</span></li><li class="L3"><span class="pln">            </span><span class="tag">&lt;/div&gt;</span></li><li class="L4"><span class="pln">          {% endif %}</span></li><li class="L5"><span class="pln">        </span><span class="tag">&lt;/div&gt;</span></li><li class="L6"><span class="pln">      {% endfor %}</span></li><li class="L7"><span class="pln">    </span><span class="tag">&lt;/div&gt;</span></li><li class="L8"><span class="pln">{% endblock %}</span></li></ol></pre>
<p>Dans le template ci-dessus, nous avons utilisé <strong>category.morejobs</strong>, nous allons donc le définir:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">// src/Ens/JobeetBunlde/Entity/Category.php</span></li><li class="L1"><span class="com">// ...</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="kwd">private</span><span class="pln"> $more_jobs</span><span class="pun">;</span></li><li class="L4"><span class="pln"> </span></li><li class="L5"><span class="com">// ...</span></li><li class="L6"><span class="pln"> </span></li><li class="L7"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> setMoreJobs</span><span class="pun">(</span><span class="pln">$jobs</span><span class="pun">)</span></li><li class="L8"><span class="pun">{</span></li><li class="L9"><span class="pln">  $this</span><span class="pun">-&gt;</span><span class="pln">more_jobs </span><span class="pun">=</span><span class="pln"> $jobs </span><span class="pun">&gt;=</span><span class="pln">  </span><span class="lit">0</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> $jobs </span><span class="pun">:</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></li><li class="L0"><span class="pun">}</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> getMoreJobs</span><span class="pun">()</span></li><li class="L3"><span class="pun">{</span></li><li class="L4"><span class="pln">  </span><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">more_jobs</span><span class="pun">;</span></li><li class="L5"><span class="pun">}</span></li><li class="L6"><span class="pln"> </span></li><li class="L7"><span class="com">// ...</span></li></ol></pre>
<p>La propriété <strong>more_jobs</strong> prendra comme valeur le nombre d'offres actives pour la catégorie moins le nombre d'offres figurant sur la page d'accueil. Maintenant, dans <strong>JobController</strong>, nous avons besoin de définir la valeur <strong>more_jobs</strong> pour chaque catégorie:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">// src/Ens/JobeetBundle/Controller/JobController.php</span></li><li class="L1"><span class="com">// ...</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> indexAction</span><span class="pun">()</span></li><li class="L4"><span class="pun">{</span></li><li class="L5"><span class="pln">  $em </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">getDoctrine</span><span class="pun">()-&gt;</span><span class="pln">getEntityManager</span><span class="pun">();</span></li><li class="L6"><span class="pln"> </span></li><li class="L7"><span class="pln">  $categories </span><span class="pun">=</span><span class="pln"> $em</span><span class="pun">-&gt;</span><span class="pln">getRepository</span><span class="pun">(</span><span class="str">'EnsJobeetBundle:Category'</span><span class="pun">)-&gt;</span><span class="pln">getWithJobs</span><span class="pun">();</span></li><li class="L8"><span class="pln"> </span></li><li class="L9"><span class="pln">  </span><span class="kwd">foreach</span><span class="pun">(</span><span class="pln">$categories </span><span class="kwd">as</span><span class="pln"> $category</span><span class="pun">)</span></li><li class="L0"><span class="pln">  </span><span class="pun">{</span></li><li class="L1"><span class="pln">    $category</span><span class="pun">-&gt;</span><span class="pln">setActiveJobs</span><span class="pun">(</span><span class="pln">$em</span><span class="pun">-&gt;</span><span class="pln">getRepository</span><span class="pun">(</span><span class="str">'EnsJobeetBundle:Job'</span><span class="pun">)-&gt;</span><span class="pln">getActiveJobs</span><span class="pun">(</span><span class="pln">$category</span><span class="pun">-&gt;</span><span class="pln">getId</span><span class="pun">(),</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">container</span><span class="pun">-&gt;</span><span class="pln">getParameter</span><span class="pun">(</span><span class="str">'max_jobs_on_homepage'</span><span class="pun">)));</span></li><li class="L2"><span class="pln">    $category</span><span class="pun">-&gt;</span><span class="pln">setMoreJobs</span><span class="pun">(</span><span class="pln">$em</span><span class="pun">-&gt;</span><span class="pln">getRepository</span><span class="pun">(</span><span class="str">'EnsJobeetBundle:Job'</span><span class="pun">)-&gt;</span><span class="pln">countActiveJobs</span><span class="pun">(</span><span class="pln">$category</span><span class="pun">-&gt;</span><span class="pln">getId</span><span class="pun">())</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">container</span><span class="pun">-&gt;</span><span class="pln">getParameter</span><span class="pun">(</span><span class="str">'max_jobs_on_homepage'</span><span class="pun">));</span></li><li class="L3"><span class="pln">  </span><span class="pun">}</span></li><li class="L4"><span class="pln"> </span></li><li class="L5"><span class="pln">  </span><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">render</span><span class="pun">(</span><span class="str">'EnsJobeetBundle:Job:index.html.twig'</span><span class="pun">,</span><span class="pln"> array</span><span class="pun">(</span></li><li class="L6"><span class="pln">    </span><span class="str">'categories'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> $categories</span></li><li class="L7"><span class="pln">  </span><span class="pun">));</span></li><li class="L8"><span class="pun">}</span></li><li class="L9"><span class="com">// ...</span></li></ol></pre>
<p>La fonction <strong>countActiveJobs</strong> doit être ajoutée dans <strong>JobRepository</strong>:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">// src/Ens/JobeetBundle/Repository/JobRepository.php</span></li><li class="L1"><span class="com">// ...</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> countActiveJobs</span><span class="pun">(</span><span class="pln">$category_id </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span></li><li class="L4"><span class="pun">{</span></li><li class="L5"><span class="pln">  $qb </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">createQueryBuilder</span><span class="pun">(</span><span class="str">'j'</span><span class="pun">)</span></li><li class="L6"><span class="pln">    </span><span class="pun">-&gt;</span><span class="kwd">select</span><span class="pun">(</span><span class="str">'count(j.id)'</span><span class="pun">)</span></li><li class="L7"><span class="pln">    </span><span class="pun">-&gt;</span><span class="kwd">where</span><span class="pun">(</span><span class="str">'j.expires_at &gt; :date'</span><span class="pun">)</span></li><li class="L8"><span class="pln">    </span><span class="pun">-&gt;</span><span class="pln">setParameter</span><span class="pun">(</span><span class="str">'date'</span><span class="pun">,</span><span class="pln"> date</span><span class="pun">(</span><span class="str">'Y-m-d H:i:s'</span><span class="pun">,</span><span class="pln"> time</span><span class="pun">()));</span></li><li class="L9"><span class="pln"> </span></li><li class="L0"><span class="pln">  </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">$category_id</span><span class="pun">)</span></li><li class="L1"><span class="pln">  </span><span class="pun">{</span></li><li class="L2"><span class="pln">    $qb</span><span class="pun">-&gt;</span><span class="pln">andWhere</span><span class="pun">(</span><span class="str">'j.category = :category_id'</span><span class="pun">)</span></li><li class="L3"><span class="pln">    </span><span class="pun">-&gt;</span><span class="pln">setParameter</span><span class="pun">(</span><span class="str">'category_id'</span><span class="pun">,</span><span class="pln"> $category_id</span><span class="pun">);</span></li><li class="L4"><span class="pln">  </span><span class="pun">}</span></li><li class="L5"><span class="pln"> </span></li><li class="L6"><span class="pln">  $query </span><span class="pun">=</span><span class="pln"> $qb</span><span class="pun">-&gt;</span><span class="pln">getQuery</span><span class="pun">();</span></li><li class="L7"><span class="pln"> </span></li><li class="L8"><span class="pln">  </span><span class="kwd">return</span><span class="pln"> $query</span><span class="pun">-&gt;</span><span class="pln">getSingleScalarResult</span><span class="pun">();</span></li><li class="L9"><span class="pun">}</span></li><li class="L0"><span class="pln"> </span></li><li class="L1"><span class="com">// ...</span></li></ol></pre>
<p>Maintenant, vous devriez voir le résultat dans votre navigateur:</p>
<p class="tcenter"><a href="assets/img/jobeet_7-1.png" rel="shadowbox"><img src="assets/img/jobeet_7-1.png" alt="" class="img-polaroid"></a></p>
<br>
<h2>Création du contrôleur Category</h2>
<p>Il est maintenant temps de créer le contrôleur <strong>Category</strong>. Créez un nouveau fichier <strong>CategoryController.php</strong> dans votre répertoire <strong>Controller</strong>:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">// src/Ens/JobeetBundle/Controller/CategoryController.php</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="kwd">namespace</span><span class="pln"> </span><span class="typ">Ens</span><span class="pln">\JobeetBundle\Controller</span><span class="pun">;</span></li><li class="L3"><span class="kwd">use</span><span class="pln"> </span><span class="typ">Symfony</span><span class="pln">\Bundle\FrameworkBundle\Controller\Controller</span><span class="pun">;</span></li><li class="L4"><span class="kwd">use</span><span class="pln"> </span><span class="typ">Ens</span><span class="pln">\JobeetBundle\Entity\Category</span><span class="pun">;</span></li><li class="L5"><span class="pln"> </span></li><li class="L6"><span class="com">/**</span></li><li class="L7"><span class="com">* Category controller.</span></li><li class="L8"><span class="com">*</span></li><li class="L9"><span class="com">*/</span></li><li class="L0"><span class="kwd">class</span><span class="pln"> </span><span class="typ">CategoryController</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Controller</span></li><li class="L1"><span class="pun">{</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pun">}</span></li></ol></pre>
<p>Nous pourrions utiliser la commande <strong>doctrine:generate:crud</strong> comme nous l'avons fait pour <strong>JobController</strong>, mais nous n'aurons pas besoin de 90% du code généré, donc nous pouvons juste créer un nouveau contrôleur à partir de zéro.</p>
<br>
<h2>Mettre à jour la Base De Données</h2>
<p>Nous avons besoin d'ajouter une colonne <strong>slug</strong> dans la table <strong>category</strong> et une entrée <strong>lifecycleCallbacks</strong> pour définir la valeur de cette colonne:</p>
<pre class="prettyprint linenums lang-yaml"><ol class="linenums"><li class="L0"><span class="com"># src/Ens/JobeetBundle/Resources/config/doctrine/Category.orm.yml</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="pln">Ens\JobeetBundle\Entity\</span><span class="kwd">Category:</span></li><li class="L3"><span class="pln">  </span><span class="kwd">type: </span><span class="pln">entity</span></li><li class="L4"><span class="pln">  </span><span class="kwd">repositoryClass: </span><span class="pln">Ens\JobeetBundle\Repository\CategoryRepository</span></li><li class="L5"><span class="pln">  </span><span class="kwd">table: </span><span class="pln">category</span></li><li class="L6"><span class="pln">  </span><span class="kwd">id:</span></li><li class="L7"><span class="pln">    </span><span class="kwd">id:</span></li><li class="L8"><span class="pln">      </span><span class="kwd">type: </span><span class="pln">integer</span></li><li class="L9"><span class="pln">      </span><span class="kwd">generator: </span><span class="pln">{ </span><span class="kwd">strategy: </span><span class="pln">AUTO }</span></li><li class="L0"><span class="pln">  </span><span class="kwd">fields:</span></li><li class="L1"><span class="pln">    </span><span class="kwd">name:</span></li><li class="L2"><span class="pln">      </span><span class="kwd">type: </span><span class="pln">string</span></li><li class="L3"><span class="pln">      </span><span class="kwd">length: </span><span class="pln">255</span></li><li class="L4"><span class="pln">      </span><span class="kwd">unique: </span><span class="pln">true</span></li><li class="L5"><span class="pln">    </span><span class="kwd">slug:</span></li><li class="L6"><span class="pln">      </span><span class="kwd">type: </span><span class="pln">string</span></li><li class="L7"><span class="pln">      </span><span class="kwd">length: </span><span class="pln">255</span></li><li class="L8"><span class="pln">      </span><span class="kwd">unique: </span><span class="pln">true</span></li><li class="L9"><span class="pln">  </span><span class="kwd">oneToMany:</span></li><li class="L0"><span class="pln">    </span><span class="kwd">jobs:</span></li><li class="L1"><span class="pln">      </span><span class="kwd">targetEntity: </span><span class="pln">Job</span></li><li class="L2"><span class="pln">      </span><span class="kwd">mappedBy: </span><span class="pln">category</span></li><li class="L3"><span class="pln">    </span><span class="kwd">category_affiliates:</span></li><li class="L4"><span class="pln">      </span><span class="kwd">targetEntity: </span><span class="pln">CategoryAffiliate</span></li><li class="L5"><span class="pln">      </span><span class="kwd">mappedBy: </span><span class="pln">category</span></li><li class="L6"><span class="pln">  </span><span class="kwd">lifecycleCallbacks:</span></li><li class="L7"><span class="pln">    </span><span class="kwd">prePersist: </span><span class="pln">[ setSlugValue ]</span></li><li class="L8"><span class="pln">    </span><span class="kwd">preUpdate: </span><span class="pln">[ setSlugValue ]</span></li></ol></pre>
<p>Retirez de l'entité <strong>Category</strong> (<strong>src/Ens/JobeetBundle/Entity/category.php</strong>) la méthode <strong>getSlug</strong> que nous avons créé précédemment et exécutez la commande Doctrine pour mettre à jour la classe d'entité <strong>Category</strong>:</p>
<pre>php app/console doctrine:generate:entities EnsJobeetBundle</pre>
<p>Maintenant vous devriez avoir ce qui suit ajouté à <strong>Category.php</strong>:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">// srr/Ens/JobeetBundle/Entity/Category.php</span></li><li class="L1"><span class="com">// ...</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="com">/**</span></li><li class="L4"><span class="com">* @var string $slug</span></li><li class="L5"><span class="com">*/</span></li><li class="L6"><span class="kwd">private</span><span class="pln"> $slug</span><span class="pun">;</span></li><li class="L7"><span class="pln"> </span></li><li class="L8"><span class="com">/**</span></li><li class="L9"><span class="com">* Set slug</span></li><li class="L0"><span class="com">*</span></li><li class="L1"><span class="com">* @param string $slug</span></li><li class="L2"><span class="com">*/</span></li><li class="L3"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> setSlug</span><span class="pun">(</span><span class="pln">$slug</span><span class="pun">)</span></li><li class="L4"><span class="pun">{</span></li><li class="L5"><span class="pln">    $this</span><span class="pun">-&gt;</span><span class="pln">slug </span><span class="pun">=</span><span class="pln"> $slug</span><span class="pun">;</span></li><li class="L6"><span class="pun">}</span></li><li class="L7"><span class="com">/**</span></li><li class="L8"><span class="com">* Get slug</span></li><li class="L9"><span class="com">*</span></li><li class="L0"><span class="com">* @return string</span></li><li class="L1"><span class="com">*/</span></li><li class="L2"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> getSlug</span><span class="pun">()</span></li><li class="L3"><span class="pun">{</span></li><li class="L4"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">slug</span><span class="pun">;</span></li><li class="L5"><span class="pun">}</span></li><li class="L6"><span class="com">/**</span></li><li class="L7"><span class="com">* @ORM\prePersist</span></li><li class="L8"><span class="com">*/</span></li><li class="L9"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> setSlugValue</span><span class="pun">()</span></li><li class="L0"><span class="pun">{</span></li><li class="L1"><span class="pln">    </span><span class="com">// Add your code here</span></li><li class="L2"><span class="pun">}</span></li></ol></pre>
<p>Changez la fonction <strong>setSlugValue</strong> avec ce qui suit:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> setSlugValue</span><span class="pun">()</span></li><li class="L1"><span class="pun">{</span></li><li class="L2"><span class="pln">    $this</span><span class="pun">-&gt;</span><span class="pln">slug </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Jobeet</span><span class="pun">::</span><span class="pln">slugify</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">getName</span><span class="pun">());</span></li><li class="L3"><span class="pun">}</span></li></ol></pre>
<p>Maintenant, nous devons supprimer la BDD et la recréer avec la nouvelle colonne de la table <strong>category</strong> et charger les fixtures:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="pln">php app</span><span class="pun">/</span><span class="pln">console doctrine</span><span class="pun">:</span><span class="pln">database</span><span class="pun">:</span><span class="pln">drop </span><span class="pun">--</span><span class="pln">force</span></li><li class="L1"><span class="pln">php app</span><span class="pun">/</span><span class="pln">console doctrine</span><span class="pun">:</span><span class="pln">database</span><span class="pun">:</span><span class="pln">create</span></li><li class="L2"><span class="pln">php app</span><span class="pun">/</span><span class="pln">console doctrine</span><span class="pun">:</span><span class="pln">schema</span><span class="pun">:</span><span class="pln">update </span><span class="pun">--</span><span class="pln">force</span></li><li class="L3"><span class="pln">php app</span><span class="pun">/</span><span class="pln">console doctrine</span><span class="pun">:</span><span class="pln">fixtures</span><span class="pun">:</span><span class="pln">load</span></li></ol></pre>
<br>
<h2>La page catégorie</h2>
<p>Tout est maintenant en place pour créer la méthode <strong>showAction()</strong>. Ajoutez le code suivant au fichier <strong>CategoryController.php</strong>:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">// src/Ens/JobeetBundle/Controller/CategoryController.php</span></li><li class="L1"><span class="com">// ...</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> showAction</span><span class="pun">(</span><span class="pln">$slug</span><span class="pun">)</span></li><li class="L4"><span class="pun">{</span></li><li class="L5"><span class="pln">    $em </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">getDoctrine</span><span class="pun">()-&gt;</span><span class="pln">getEntityManager</span><span class="pun">();</span></li><li class="L6"><span class="pln"> </span></li><li class="L7"><span class="pln">    $category </span><span class="pun">=</span><span class="pln"> $em</span><span class="pun">-&gt;</span><span class="pln">getRepository</span><span class="pun">(</span><span class="str">'EnsJobeetBundle:Category'</span><span class="pun">)-&gt;</span><span class="pln">findOneBySlug</span><span class="pun">(</span><span class="pln">$slug</span><span class="pun">);</span></li><li class="L8"><span class="pln"> </span></li><li class="L9"><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">$category</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class="L0"><span class="pln">        </span><span class="kwd">throw</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">createNotFoundException</span><span class="pun">(</span><span class="str">'Unable to find Category entity.'</span><span class="pun">);</span></li><li class="L1"><span class="pln">    </span><span class="pun">}</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pln">    $category</span><span class="pun">-&gt;</span><span class="pln">setActiveJobs</span><span class="pun">(</span><span class="pln">$em</span><span class="pun">-&gt;</span><span class="pln">getRepository</span><span class="pun">(</span><span class="str">'EnsJobeetBundle:Job'</span><span class="pun">)-&gt;</span><span class="pln">getActiveJobs</span><span class="pun">(</span><span class="pln">$category</span><span class="pun">-&gt;</span><span class="pln">getId</span><span class="pun">()));</span></li><li class="L4"><span class="pln"> </span></li><li class="L5"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">render</span><span class="pun">(</span><span class="str">'EnsJobeetBundle:Category:show.html.twig'</span><span class="pun">,</span><span class="pln"> array</span><span class="pun">(</span></li><li class="L6"><span class="pln">        </span><span class="str">'category'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> $category</span><span class="pun">,</span></li><li class="L7"><span class="pln">    </span><span class="pun">));</span></li><li class="L8"><span class="pun">}</span></li><li class="L9"><span class="pln"> </span></li><li class="L0"><span class="com">// ...</span></li></ol></pre>
<p>La dernière étape consiste à créer le template <strong>show.html.twig</strong>:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">&lt;!-- src/Ens/JobeetBundle/Resources/view/Category/show.html.twig --&gt;</span></li><li class="L1"><span class="pln">&nbsp;</span></li><li class="L2"><span class="pln">{% extends 'EnsJobeetBundle::layout.html.twig' %}</span></li><li class="L3"><span class="pln"> </span></li><li class="L4"><span class="pln">{% block title %}</span></li><li class="L5"><span class="pln">  Jobs in the {{ category.name }} category</span></li><li class="L6"><span class="pln">{% endblock %}</span></li><li class="L7"><span class="pln"> </span></li><li class="L8"><span class="pln">{% block stylesheets %}</span></li><li class="L9"><span class="pln">  {{ parent() }}</span></li><li class="L0"><span class="pln">  </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"stylesheet"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ asset('bundles/ensjobeet/css/jobs.css') }}"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text/css"</span><span class="pln"> </span><span class="atn">media</span><span class="pun">=</span><span class="atv">"all"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L1"><span class="pln">{% endblock %}</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pln">{% block content %}</span></li><li class="L4"><span class="pln">  </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"category"</span><span class="tag">&gt;</span></li><li class="L5"><span class="pln">    </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"feed"</span><span class="tag">&gt;</span></li><li class="L6"><span class="pln">      </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">""</span><span class="tag">&gt;</span><span class="pln">Feed</span><span class="tag">&lt;/a&gt;</span></li><li class="L7"><span class="pln">    </span><span class="tag">&lt;/div&gt;</span></li><li class="L8"><span class="pln">    </span><span class="tag">&lt;h1&gt;</span><span class="pln">{{ category.name }}</span><span class="tag">&lt;/h1&gt;</span></li><li class="L9"><span class="pln">  </span><span class="tag">&lt;/div&gt;</span></li><li class="L0"><span class="pln"> </span></li><li class="L1"><span class="pln">  </span><span class="tag">&lt;table</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"jobs"</span><span class="tag">&gt;</span></li><li class="L2"><span class="pln">    {% for entity in category.activejobs %}</span></li><li class="L3"><span class="pln">      </span><span class="tag">&lt;tr</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"{{ cycle(['even', 'odd'], loop.index) }}"</span><span class="tag">&gt;</span></li><li class="L4"><span class="pln">        </span><span class="tag">&lt;td</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"location"</span><span class="tag">&gt;</span><span class="pln">{{ entity.location }}</span><span class="tag">&lt;/td&gt;</span></li><li class="L5"><span class="pln">        </span><span class="tag">&lt;td</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"position"</span><span class="tag">&gt;</span></li><li class="L6"><span class="pln">          </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('ens_job_show', { 'id': entity.id, 'company': entity.companyslug, 'location': entity.locationslug, 'position': entity.positionslug }) }}"</span><span class="tag">&gt;</span></li><li class="L7"><span class="pln">            {{ entity.position }}</span></li><li class="L8"><span class="pln">          </span><span class="tag">&lt;/a&gt;</span></li><li class="L9"><span class="pln">        </span><span class="tag">&lt;/td&gt;</span></li><li class="L0"><span class="pln">        </span><span class="tag">&lt;td</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"company"</span><span class="tag">&gt;</span><span class="pln">{{ entity.company }}</span><span class="tag">&lt;/td&gt;</span></li><li class="L1"><span class="pln">      </span><span class="tag">&lt;/tr&gt;</span></li><li class="L2"><span class="pln">    {% endfor %}</span></li><li class="L3"><span class="pln">  </span><span class="tag">&lt;/table&gt;</span></li><li class="L4"><span class="pln">{% endblock %}</span></li></ol></pre>
<br>
<h2>Inclure d'autres templates Twig</h2>
<p>Notez que nous avons copié/collé la balise <strong>&lt;table&gt;</strong> qui crée une liste d'offres à partir du template des offres <strong>index.html.twig</strong>. C'est une mauvaise solution. Lorsque vous avez besoin de réutiliser une partie d'un template, vous devez créer un nouveau template Twig avec ce code et l'inclure où vous en avez besoin.</p>
<p>Créez le fichier <strong>list.html.twig</strong>:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">&lt;!-- src/Ens/JobeetBundle/Resources/views/Job/list.html.twig --&gt;</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="tag">&lt;table</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"jobs"</span><span class="tag">&gt;</span></li><li class="L3"><span class="pln">  {% for entity in jobs %}</span></li><li class="L4"><span class="pln">    </span><span class="tag">&lt;tr</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"{{ cycle(['even', 'odd'], loop.index) }}"</span><span class="tag">&gt;</span></li><li class="L5"><span class="pln">      </span><span class="tag">&lt;td</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"location"</span><span class="tag">&gt;</span><span class="pln">{{ entity.location }}</span><span class="tag">&lt;/td&gt;</span></li><li class="L6"><span class="pln">      </span><span class="tag">&lt;td</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"position"</span><span class="tag">&gt;</span></li><li class="L7"><span class="pln">        </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('ens_job_show', { 'id': entity.id, 'company': entity.companyslug, 'location': entity.locationslug, 'position': entity.positionslug }) }}"</span><span class="tag">&gt;</span></li><li class="L8"><span class="pln">          {{ entity.position }}</span></li><li class="L9"><span class="pln">        </span><span class="tag">&lt;/a&gt;</span></li><li class="L0"><span class="pln">      </span><span class="tag">&lt;/td&gt;</span></li><li class="L1"><span class="pln">      </span><span class="tag">&lt;td</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"company"</span><span class="tag">&gt;</span><span class="pln">{{ entity.company }}</span><span class="tag">&lt;/td&gt;</span></li><li class="L2"><span class="pln">    </span><span class="tag">&lt;/tr&gt;</span></li><li class="L3"><span class="pln">  {% endfor %}</span></li><li class="L4"><span class="tag">&lt;/table&gt;</span></li></ol></pre>
<p>Vous pouvez inclure un template à l'aide de la balise <strong>{% include%}</strong>. Remplacez le code HTML <strong>&lt;table&gt;</strong> dans les deux templates avec la balise <strong>include</strong>:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">&lt;!-- in src/Ens/JobeetBundle/Resources/view/Job/index.html.twig --&gt;</span></li><li class="L1"><span class="pln">{% include 'EnsJobeetBundle:Job:list.html.twig' with {'jobs': category.activejobs} %}</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="com">&lt;!-- in src/Ens/JobeetBundle/Resources/view/Category/show.html.twig --&gt;</span></li><li class="L4"><span class="pln">{% include 'EnsJobeetBundle:Job:list.html.twig' with {'jobs': category.activejobs} %}</span></li></ol></pre>
<br>
<h2>Pagination de listes</h2>

<p>Depuis la version 2.2 de Doctrine, il y existe un objet <a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/tutorials/pagination.html" target="_blank">Paginator</a> que nous allons pouvoir utiliser. </p>
<p>Tout d'abord, nous allons ajouter un paramètre <strong>page</strong> à la route <strong>EnsJobeetBundle_category</strong>. Le paramètre <strong>page</strong> aura une valeur par défaut de 1, donc il ne sera pas obligatoire:</p>
<pre class="prettyprint linenums lang-yaml">
# src/Ens/JobeetBundle/Resources/config/routing.yml
 
EnsJobeetBundle_category:
    pattern: /category/{slug}/{page}
    defaults: { _controller: EnsJobeetBundle:Category:show, page: 1 }
 
# ...
</pre>
<p>Le nombre d'offres sur chaque page sera défini comme un paramètre personnalisé dans le fichier <strong>app/config/config.yml</strong>:</p>
<pre class="prettyprint linenums lang-yaml">
# app/config/config.yml
# ...
 
parameters:
    max_jobs_on_homepage: 10
    max_jobs_on_category: 20
</pre>
<p>Ajoutez la référence au Paginator <strong>Doctrine\ORM\Tools\Pagination\Paginator</strong></p>
<p>Puis modifiez la méthode <strong>getActiveJobs</strong> de <strong>JobRepository</strong> afin d'inclure un paramètre <strong>$offset</strong> pour être utilisé par Doctrine lors de la récupération des offres:</p>
<pre class="prettyprint linenums">
// src/Ens/JobeetBundle/Repository/JobRepository.php
// ...

use Doctrine\ORM\Tools\Pagination\Paginator;
// ...
class JobRepository extends EntityRepository
{
    // ...
    public function getActiveJobs($category_id = null, $max = null, $offset = null)
    {
      $qb = $this->createQueryBuilder('j')
        ->where('j.expires_at > :date')
        ->setParameter('date', date('Y-m-d H:i:s', time()))
        ->orderBy('j.expires_at', 'DESC');
     
      if($max)
      {
        $qb->setMaxResults($max);
      }
     
      if($offset)
      {
        $qb->setFirstResult($offset);
      }
     
      if($category_id)
      {
        $qb->andWhere('j.category = :category_id')
           ->setParameter('category_id', $category_id);
      }
     
      $query = $qb->getQuery();
     
      $paginator = new Paginator($query, $fetchJoinCollection = true);
      
      return $paginator;
    }
 
// ...
</pre>
<p>Modifiez l'action <strong>showAction</strong> de <strong>CategoryController</strong> avec ce qui suit:</p>
<pre class="prettyprint linenums">
    public function showAction($slug,$page)
    {
        $em = $this->getDoctrine()->getEntityManager();

        $category = $em->getRepository('EnsJobeetBundle:Category')->findOneBySlug($slug);

        if (!$category) {
            throw $this->createNotFoundException('Unable to find Category entity.');
        }

        $jobs_per_page = $this->container->getParameter('max_jobs_on_category');
        
        $activeJobsPaginator = $em->getRepository('EnsJobeetBundle:Job')->getActiveJobs($category->getId(), $jobs_per_page, ($page - 1) * $jobs_per_page);
        $total_jobs = $activeJobsPaginator->count();
        $last_page = ceil($total_jobs / $jobs_per_page);
        $previous_page = $page > 1 ? $page - 1 : 1;
        $next_page = $page < $last_page ? $page + 1 : $last_page;
        
        $category->setActiveJobs($activeJobsPaginator);

        return $this->render('EnsJobeetBundle:Category:show.html.twig', array(
            'category' => $category,
            'last_page' => $last_page,
            'previous_page' => $previous_page,
            'current_page' => $page,
            'next_page' => $next_page,
            'total_jobs' => $total_jobs
        ));
    }
</pre>
<p>Enfin, nous allons mettre à jour le template:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">&lt;!-- src/Ens/JobeetBundle/Resources/views/Category/show.html.twig --&gt;</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="pln">{% extends 'EnsJobeetBundle::layout.html.twig' %}</span></li><li class="L3"><span class="pln"> </span></li><li class="L4"><span class="pln">{% block title %}</span></li><li class="L5"><span class="pln">  Jobs in the {{ category.name }} category</span></li><li class="L6"><span class="pln">{% endblock %}</span></li><li class="L7"><span class="pln"> </span></li><li class="L8"><span class="pln">{% block stylesheets %}</span></li><li class="L9"><span class="pln">  {{ parent() }}</span></li><li class="L0"><span class="pln">  </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"stylesheet"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ asset('bundles/ensjobeet/css/jobs.css') }}"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text/css"</span><span class="pln"> </span><span class="atn">media</span><span class="pun">=</span><span class="atv">"all"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L1"><span class="pln">{% endblock %}</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pln">{% block content %}</span></li><li class="L4"><span class="pln">  </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"category"</span><span class="tag">&gt;</span></li><li class="L5"><span class="pln">    </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"feed"</span><span class="tag">&gt;</span></li><li class="L6"><span class="pln">      </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">""</span><span class="tag">&gt;</span><span class="pln">Feed</span><span class="tag">&lt;/a&gt;</span></li><li class="L7"><span class="pln">    </span><span class="tag">&lt;/div&gt;</span></li><li class="L8"><span class="pln">    </span><span class="tag">&lt;h1&gt;</span><span class="pln">{{ category.name }}</span><span class="tag">&lt;/h1&gt;</span></li><li class="L9"><span class="pln">  </span><span class="tag">&lt;/div&gt;</span></li><li class="L0"><span class="pln"> </span></li><li class="L1"><span class="pln">  {% include 'EnsJobeetBundle:Job:list.html.twig' with {'jobs': category.activejobs} %}</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pln">  {% if last_page &gt; 1 %}</span></li><li class="L4"><span class="pln">    </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"pagination"</span><span class="tag">&gt;</span></li><li class="L5"><span class="pln">      </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('EnsJobeetBundle_category', { 'slug': category.slug, 'page': 1 }) }}"</span><span class="tag">&gt;</span></li><li class="L6"><span class="pln">        </span><span class="tag">&lt;img</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"{{ asset('bundles/ensjobeet/images/first.png') }}"</span><span class="pln"> </span><span class="atn">alt</span><span class="pun">=</span><span class="atv">"First page"</span><span class="pln"> </span><span class="atn">title</span><span class="pun">=</span><span class="atv">"First page"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L7"><span class="pln">      </span><span class="tag">&lt;/a&gt;</span></li><li class="L8"><span class="pln"> </span></li><li class="L9"><span class="pln">      </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('EnsJobeetBundle_category', { 'slug': category.slug, 'page': previous_page }) }}"</span><span class="tag">&gt;</span></li><li class="L0"><span class="pln">        </span><span class="tag">&lt;img</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"{{ asset('bundles/ensjobeet/images/previous.png') }}"</span><span class="pln"> </span><span class="atn">alt</span><span class="pun">=</span><span class="atv">"Previous page"</span><span class="pln"> </span><span class="atn">title</span><span class="pun">=</span><span class="atv">"Previous page"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L1"><span class="pln">      </span><span class="tag">&lt;/a&gt;</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pln">      {% for page in 1..last_page %}</span></li><li class="L4"><span class="pln">        {% if page == current_page %}</span></li><li class="L5"><span class="pln">          {{ page }}</span></li><li class="L6"><span class="pln">        {% else %}</span></li><li class="L7"><span class="pln">          </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('EnsJobeetBundle_category', { 'slug': category.slug, 'page': page }) }}"</span><span class="tag">&gt;</span><span class="pln">{{ page }}</span><span class="tag">&lt;/a&gt;</span></li><li class="L8"><span class="pln">        {% endif %}</span></li><li class="L9"><span class="pln">      {% endfor %}</span></li><li class="L0"><span class="pln"> </span></li><li class="L1"><span class="pln">      </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('EnsJobeetBundle_category', { 'slug': category.slug, 'page': next_page }) }}"</span><span class="tag">&gt;</span></li><li class="L2"><span class="pln">        </span><span class="tag">&lt;img</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"{{ asset('bundles/ensjobeet/images/next.png') }}"</span><span class="pln"> </span><span class="atn">alt</span><span class="pun">=</span><span class="atv">"Next page"</span><span class="pln"> </span><span class="atn">title</span><span class="pun">=</span><span class="atv">"Next page"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L3"><span class="pln">      </span><span class="tag">&lt;/a&gt;</span></li><li class="L4"><span class="pln"> </span></li><li class="L5"><span class="pln">      </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('EnsJobeetBundle_category', { 'slug': category.slug, 'page': last_page }) }}"</span><span class="tag">&gt;</span></li><li class="L6"><span class="pln">        </span><span class="tag">&lt;img</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"{{ asset('bundles/ensjobeet/images/last.png') }}"</span><span class="pln"> </span><span class="atn">alt</span><span class="pun">=</span><span class="atv">"Last page"</span><span class="pln"> </span><span class="atn">title</span><span class="pun">=</span><span class="atv">"Last page"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L7"><span class="pln">      </span><span class="tag">&lt;/a&gt;</span></li><li class="L8"><span class="pln">    </span><span class="tag">&lt;/div&gt;</span></li><li class="L9"><span class="pln">  {% endif %}</span></li><li class="L0"><span class="pln"> </span></li><li class="L1"><span class="pln">  </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"pagination_desc"</span><span class="tag">&gt;</span></li><li class="L2"><span class="pln">    </span><span class="tag">&lt;strong&gt;</span><span class="pln">{{ total_jobs }}</span><span class="tag">&lt;/strong&gt;</span><span class="pln"> jobs in this category</span></li><li class="L3"><span class="pln"> </span></li><li class="L4"><span class="pln">    {% if last_page &gt; 1 %}</span></li><li class="L5"><span class="pln">      - page </span><span class="tag">&lt;strong&gt;</span><span class="pln">{{ current_page }}/{{ last_page }}</span><span class="tag">&lt;/strong&gt;</span></li><li class="L6"><span class="pln">    {% endif %}</span></li><li class="L7"><span class="pln">  </span><span class="tag">&lt;/div&gt;</span></li><li class="L8"><span class="pln">{% endblock %}</span></li></ol></pre>
<p>Le résultat:</p>
<p class="tcenter"><a href="assets/img/jobeet_7-2.png" rel="shadowbox"><img src="assets/img/jobeet_7-2.png" alt="" class="img-polaroid"></a></p>
<br>
<p class="clearfix noprint">
	<a href="aller-plus-loin-avec-le-modele.html" class="btn btn-success pull-left">Chapitre précédent</a>
	<a href="les-tests-unitaires.html" class="btn btn-success pull-right">Chapitre suivant</a>
</p>														<p class="link_source noprint"><a href="http://www.ens.ro/2012/04/11/symfony2-jobeet-day-7-playing-with-the-category-page/" target="_blank">» Lire l'article original</a></p>
																					<br>
                        </section>
					</div>
				</div>
				<hr />
				<footer>
					<p class="tcenter">Tutoriel original par <a href="http://www.ens.ro/2012/03/21/jobeet-tutorial-with-symfony2/" target="_blank">Dragos Holban</a> - Traduit par <a href="https://plus.google.com/109236735134093009460?rel=author" target="_blank">Jonathan Thuau</a> - Le tuto sur <a href="https://github.com/thujohn/Jobeet" target="_blank">github</a></p>
				</footer>
			</div>
		</div>
	</div>
<script src="assets/js/jquery-1.8.2.min.js"></script>
<script src="assets/js/bootstrap.js"></script>
<script src="assets/js/prettify.js"></script>
<script src="assets/js/lang-yaml.js"></script>
<script src="assets/js/shadowbox.js"></script>
<script type="text/javascript">
<!--
jQuery(document).ready(function(){
	Shadowbox.init();
	prettyPrint();
	jQuery('.bs-docs-sidenav').affix({
		offset: {
			top: 150,
			bottom: 270
		}
	});
	jQuery('a[href*=#]').click(function (e) {
		var hash = jQuery(this).attr('href');
		e.preventDefault();
		var dest = 0;
		if (jQuery(this.hash).offset().top > (jQuery(document).height() - jQuery(window).height())){
			dest = jQuery(document).height() - jQuery(window).height();
		}else{
			dest = jQuery(this.hash).offset().top;
		}
		jQuery('html,body').animate({scrollTop:dest}, 1000, 'swing');
	});
});
-->
</script>
</body>
</html>