<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Tuto Jobeet Symfony2 FR :: Démarrage du projet</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link rel="stylesheet" type="text/css" href="assets/css/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="assets/css/bootstrap-responsive.css" />
<link rel="stylesheet" type="text/css" href="assets/css/style.css" />
<link rel="stylesheet" type="text/css" href="assets/css/docs.css" />
<link rel="stylesheet" type="text/css" href="assets/css/prettify.css" />
<link rel="stylesheet" type="text/css" href="assets/css/shadowbox.css" />
<link rel="stylesheet" type="text/css" href="assets/css/print.css" media="print" />
<link rel="shortcut icon" href="assets/img/favicon.ico">
<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

</head>

<body>
	<!--<a href="https://github.com/thujohn/Jobeet" target="_blank" id="gogithub"><img src="assets/img/github.gif" alt="" /></a>-->
	<div class="navbar navbar-inverse hide-on-desktop show-on-tablets show-on-mobile noprint">
		<div class="navbar-inner noprint">
			<div class="container">
				<button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="brand" href="./">Jobeet FR</a>
				<div class="nav-collapse collapse">
					<ul class="nav">
						<li class="sommaire"><a href="sommaire.html"><i class="icon-chevron-right"></i>Sommaire</a></li><li class="demarrage-du-projet"><a href="demarrage-du-projet.html"><i class="icon-chevron-right"></i><strong>[01]</strong> Démarrage du projet</a></li><li class="le-projet"><a href="le-projet.html"><i class="icon-chevron-right"></i><strong>[02]</strong> Le projet</a></li><li class="le-modele-de-donnees"><a href="le-modele-de-donnees.html"><i class="icon-chevron-right"></i><strong>[03]</strong> Le Modèle de Données</a></li><li class="le-controleur-et-la-vue"><a href="le-controleur-et-la-vue.html"><i class="icon-chevron-right"></i><strong>[04]</strong> Le Contrôleur et la Vue</a></li><li class="le-routage"><a href="le-routage.html"><i class="icon-chevron-right"></i><strong>[05]</strong> Le Routage</a></li><li class="aller-plus-loin-avec-le-modele"><a href="aller-plus-loin-avec-le-modele.html"><i class="icon-chevron-right"></i><strong>[06]</strong> Aller plus loin avec le Modèle</a></li><li class="jouons-avec-la-page-categorie"><a href="jouons-avec-la-page-categorie.html"><i class="icon-chevron-right"></i><strong>[07]</strong> Jouons avec les catégories</a></li><li class="les-tests-unitaires"><a href="les-tests-unitaires.html"><i class="icon-chevron-right"></i><strong>[08]</strong> Les tests unitaires</a></li><li class="les-tests-fonctionnels"><a href="les-tests-fonctionnels.html"><i class="icon-chevron-right"></i><strong>[09]</strong> Les tests fonctionnels</a></li><li class="les-formulaires"><a href="les-formulaires.html"><i class="icon-chevron-right"></i><strong>[10]</strong> Les formulaires</a></li><li class="testez-vos-formulaires"><a href="testez-vos-formulaires.html"><i class="icon-chevron-right"></i><strong>[11]</strong> Testez vos formulaires</a></li><li class="le-paquet-admin"><a href="le-paquet-admin.html"><i class="icon-chevron-right"></i><strong>[12]</strong> Le paquet Admin</a></li><li class="active"><a href="securite.html"><i class="icon-chevron-right"></i><strong>[13]</strong> Sécurité</a></li><li class="flux-de-donnees"><a href="flux-de-donnees.html"><i class="icon-chevron-right"></i><strong>[14]</strong> Flux de données</a></li>
					</ul>
				</div>
			</div>
		</div>
	</div>
	<div id="container">
		<div id="bootstrap-docs">
			<header class="jumbotron subhead hide-on-tablets hide-on-mobile" id="overview">
				<div class="container">
					<h1><a href="./">Jobeet FR</a></h1>
					<p class="lead">Le tutoriel pour Symfony2 en français</p>
				</div>
			</header>
			<div class="container">
				<div class="row">
										<div class="span12">
											<section class="justify">
                                            <a href="securite.html" class="pull-right btn btn-success hide-on-tablets hide-on-mobile noprint">Vue normale</a><div class="page-header clearfix"><h1 class="pull-left">Sécurité</h1></div>
							<h2>Sécurisation de l'application</h2>
<p>La sécurité est un processus en deux étapes dont le but est d'empêcher un utilisateur d'accéder à une ressource dont il ne devrait pas avoir accès. Dans la première étape du processus, l'<strong>authentification</strong>, le système de sécurité identifie l'utilisateur en l'obligeant à soumettre une sorte d'identification. Une fois que le système sait qui vous êtes, la prochaine étape, appelée l'<strong>autorisation</strong>, est de déterminer si vous devriez avoir accès à une ressource donnée (il vérifie que vous avez les privilèges pour effectuer une certaine action).</p>
<p>Le composant de sécurité peut être configuré via la configuration de votre application à l'aide du fichier <strong>security.yml</strong> à partir du dossier <strong>app/config</strong>. Pour sécuriser notre application ajoutez ce qui suit à votre fichier <strong>security.yml</strong>:</p>
<pre class="prettyprint linenums lang-yaml"><ol class="linenums"><li class="L0"><span class="com"># app/config/security.yml</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="kwd">security:</span></li><li class="L3"><span class="pln">    </span><span class="kwd">firewalls:</span></li><li class="L4"><span class="pln">        </span><span class="kwd">secured_area:</span></li><li class="L5"><span class="pln">            </span><span class="kwd">pattern: </span><span class="pln">   ^/</span></li><li class="L6"><span class="pln">            </span><span class="kwd">anonymous: </span><span class="pln">~</span></li><li class="L7"><span class="pln">            </span><span class="kwd">form_login:</span></li><li class="L8"><span class="pln">                </span><span class="kwd">login_path: </span><span class="pln"> /login</span></li><li class="L9"><span class="pln">                </span><span class="kwd">check_path: </span><span class="pln"> /login_check</span></li><li class="L0"><span class="pln"> </span></li><li class="L1"><span class="pln">    </span><span class="kwd">access_control:</span></li><li class="L2"><span class="pln">        </span><span class="pun">-</span><span class="pln"> { </span><span class="kwd">path: </span><span class="pln">^/admin, </span><span class="kwd">roles: </span><span class="pln">ROLE_ADMIN }</span></li><li class="L3"><span class="pln"> </span></li><li class="L4"><span class="pln">    </span><span class="kwd">providers:</span></li><li class="L5"><span class="pln">        </span><span class="kwd">in_memory:</span></li><li class="L6"><span class="pln">            </span><span class="kwd">users:</span></li><li class="L7"><span class="pln">                </span><span class="kwd">admin: </span><span class="pln">{ </span><span class="kwd">password: </span><span class="pln">adminpass, </span><span class="kwd">roles: </span><span class="str">'ROLE_ADMIN'</span><span class="pln"> }</span></li><li class="L8"><span class="pln"> </span></li><li class="L9"><span class="pln">    </span><span class="kwd">encoders:</span></li><li class="L0"><span class="pln">        Symfony\Component\Security\Core\User\</span><span class="kwd">User: </span><span class="pln">plaintext</span></li></ol></pre>
<p>Cette configuration protégera la section <strong>/admin</strong> du site (toutes les URL qui commencent par <strong>/admin</strong>) et permettra l'accès uniquement aux utilisateurs avec <strong>ROLE_ADMIN</strong> (voir la section <strong>access_control</strong>). Dans cet exemple, l'utilisateur admin est défini dans le fichier de configuration (la section <strong>providers</strong>) et le mot de passe n'est pas chiffré (<strong>encoders</strong>).</p>
<p>Pour authentifier les utilisateurs, un formulaire de connexion classique sera utilisé, mais nous devons le mettre en œuvre. D'abord, créez deux routes: l'une qui affiche le formulaire de connexion (par exemple <strong>/login</strong>) et une qui va gérer la soumission du formulaire de connexion (par exemple <strong>/login_check</strong>):</p>
<pre class="prettyprint linenums lang-yaml"><ol class="linenums"><li class="L0"><span class="com"># src/Ens/JobeetBundle/Resources/config/routing.yml</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="kwd">login:</span></li><li class="L3"><span class="pln">    </span><span class="kwd">pattern: </span><span class="pln">  /login</span></li><li class="L4"><span class="pln">    </span><span class="kwd">defaults: </span><span class="pln"> { </span><span class="kwd">_controller: </span><span class="pln">EnsJobeetBundle</span><span class="pun">:</span><span class="pln">Default</span><span class="pun">:</span><span class="pln">login }</span></li><li class="L5"><span class="kwd">login_check:</span></li><li class="L6"><span class="pln">    </span><span class="kwd">pattern: </span><span class="pln">  /login_check</span></li><li class="L7"><span class="pln"> </span></li><li class="L8"><span class="com"># ...</span></li></ol></pre>
<p>Nous n'aurons pas besoin de mettre en œuvre un contrôleur pour l'URL <strong>/login_check</strong> puisque le pare-feu va automatiquement intercepter et transformer n'importe quel formulaire soumis à cette URL. Il est facultatif, mais utile, pour créer une route de sorte qu'il peut être utilisé pour générer l'URL de soumission du formulaire dans le template de connexion ci-dessous.</p>
<p>Ensuite, nous allons créer l'action qui permettra d'afficher le formulaire de connexion:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">// src/Ens/JobeetBundle/Controller/DefaultController.php</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="kwd">namespace</span><span class="pln"> </span><span class="typ">Ens</span><span class="pln">\JobeetBundle\Controller</span><span class="pun">;</span></li><li class="L3"><span class="pln"> </span></li><li class="L4"><span class="kwd">use</span><span class="pln"> </span><span class="typ">Symfony</span><span class="pln">\Bundle\FrameworkBundle\Controller\Controller</span><span class="pun">;</span></li><li class="L5"><span class="kwd">use</span><span class="pln"> </span><span class="typ">Symfony</span><span class="pln">\Component\Security\Core\SecurityContext</span><span class="pun">;</span></li><li class="L6"><span class="pln"> </span></li><li class="L7"><span class="kwd">class</span><span class="pln"> </span><span class="typ">DefaultController</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Controller</span></li><li class="L8"><span class="pun">{</span></li><li class="L9"><span class="pln">    </span><span class="com">// ...</span></li><li class="L0"><span class="pln"> </span></li><li class="L1"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> loginAction</span><span class="pun">()</span></li><li class="L2"><span class="pln">    </span><span class="pun">{</span></li><li class="L3"><span class="pln">        $request </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">getRequest</span><span class="pun">();</span></li><li class="L4"><span class="pln">        $session </span><span class="pun">=</span><span class="pln"> $request</span><span class="pun">-&gt;</span><span class="pln">getSession</span><span class="pun">();</span></li><li class="L5"><span class="pln"> </span></li><li class="L6"><span class="pln">        </span><span class="com">// get the login error if there is one</span></li><li class="L7"><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$request</span><span class="pun">-&gt;</span><span class="pln">attributes</span><span class="pun">-&gt;</span><span class="pln">has</span><span class="pun">(</span><span class="typ">SecurityContext</span><span class="pun">::</span><span class="pln">AUTHENTICATION_ERROR</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></li><li class="L8"><span class="pln">            $error </span><span class="pun">=</span><span class="pln"> $request</span><span class="pun">-&gt;</span><span class="pln">attributes</span><span class="pun">-&gt;</span><span class="kwd">get</span><span class="pun">(</span><span class="typ">SecurityContext</span><span class="pun">::</span><span class="pln">AUTHENTICATION_ERROR</span><span class="pun">);</span></li><li class="L9"><span class="pln">        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></li><li class="L0"><span class="pln">            $error </span><span class="pun">=</span><span class="pln"> $session</span><span class="pun">-&gt;</span><span class="kwd">get</span><span class="pun">(</span><span class="typ">SecurityContext</span><span class="pun">::</span><span class="pln">AUTHENTICATION_ERROR</span><span class="pun">);</span></li><li class="L1"><span class="pln">            $session</span><span class="pun">-&gt;</span><span class="pln">remove</span><span class="pun">(</span><span class="typ">SecurityContext</span><span class="pun">::</span><span class="pln">AUTHENTICATION_ERROR</span><span class="pun">);</span></li><li class="L2"><span class="pln">        </span><span class="pun">}</span></li><li class="L3"><span class="pln"> </span></li><li class="L4"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">render</span><span class="pun">(</span><span class="str">'EnsJobeetBundle:Default:login.html.twig'</span><span class="pun">,</span><span class="pln"> array</span><span class="pun">(</span></li><li class="L5"><span class="pln">            </span><span class="com">// last username entered by the user</span></li><li class="L6"><span class="pln">            </span><span class="str">'last_username'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> $session</span><span class="pun">-&gt;</span><span class="kwd">get</span><span class="pun">(</span><span class="typ">SecurityContext</span><span class="pun">::</span><span class="pln">LAST_USERNAME</span><span class="pun">),</span></li><li class="L7"><span class="pln">            </span><span class="str">'error'</span><span class="pln">         </span><span class="pun">=&gt;</span><span class="pln"> $error</span><span class="pun">,</span></li><li class="L8"><span class="pln">        </span><span class="pun">));</span></li><li class="L9"><span class="pln">    </span><span class="pun">}</span></li><li class="L0"><span class="pun">}</span></li></ol></pre>
<p>Lorsque l'utilisateur soumet le formulaire, le système de sécurité gère automatiquement la soumission du formulaire pour vous. Si l'utilisateur a soumis un nom d'utilisateur ou mot de passe invalide, cette action lit l'erreur de soumission du formulaire à partir du système de sécurité de sorte qu'il peut être affiché à l'utilisateur. Votre seule tâche est d'afficher le formulaire de connexion et les erreurs de connexion qui peuvent se produire, mais le système de sécurité lui-même prend soin de vérifier le nom d'utilisateur et mot de passe soumis et l'authentification de l'utilisateur.</p>
<p>Enfin, nous allons créer le template correspondant:</p>
<pre class="prettyprint linenums">
{% extends 'SonataAdminBundle::standard_layout.html.twig' %}
{% block sonata_admin_content %}
{% if error %}
    &lt;div>{{ error.message }}&lt;/div>
{% endif %}
 
&lt;form action="{{ path('login_check') }}" method="post">
    &lt;label for="username">Username:</label>
    &lt;input type="text" id="username" name="_username" value="{{ last_username }}" />
    &lt;label for="password">Password:</label>
    &lt;input type="password" id="password" name="_password" />
    &lt;button type="submit">login</button>
&lt;/form>
{% endblock %}
</pre>
<p>Maintenant, si vous essayez d'accéder à l'URL <a href="http://jobeet.local/app_dev.php/admin/dashboard" target="_blank">http://jobeet.local/app_dev.php/admin/dashboard</a>, le formulaire de connexion apparaîtra et vous devrez entrer le nom d'utilisateur et mot de passe défini dans <strong>security.yml</strong> (admin/adminpass) pour aller dans l'administration de Jobeet.</p>
<br>
<h2>Les fournisseurs d'utilisateurs</h2>
<p>Lors de l'authentification, l'utilisateur soumet un ensemble d'informations d'identification (généralement un nom d'utilisateur et mot de passe). La tâche du système d'authentification est de faire correspondre ces informations à certains groupes d'utilisateurs. Alors d'où vient cette liste d'utilisateurs?</p>
<p>Dans Symfony2, les utilisateurs peuvent venir de n'importe où - un fichier de configuration, une table de la BDD, un Web Service, ou toute autre chose dont vous pouvez rêver. Tout ce qui fournit un ou plusieurs utilisateurs dans le système d'authentification est connu comme un "fournisseur d'utilisateur". Symfony2 est livré en standard avec les deux fournisseurs d'utilisateurs les plus courants: celui qui charge les utilisateurs à partir d'un fichier de configuration et celui qui charge les utilisateurs d'une table de la BDD.</p>
<p>Ci-dessus, nous avons utilisé le premier cas: les utilisateurs spécifiés dans un fichier de configuration.</p>
<pre class="prettyprint linenums lang-yaml"><ol class="linenums"><li class="L0"><span class="kwd">providers:</span></li><li class="L1"><span class="pln">    </span><span class="kwd">in_memory:</span></li><li class="L2"><span class="pln">        </span><span class="kwd">users:</span></li><li class="L3"><span class="pln">            </span><span class="kwd">admin: </span><span class="pln">{ </span><span class="kwd">password: </span><span class="pln">adminpass, </span><span class="kwd">roles: </span><span class="str">'ROLE_ADMIN'</span><span class="pln"> }</span></li></ol></pre>
<p>Mais vous voudrez généralement stocker les utilisateurs dans une table de la BDD. Pour ce faire, nous allons ajouter une nouvelle table <strong>user</strong> dans notre BDD.</p>
<p>D'abord nous allons créer l'ORM pour cette nouvelle table:</p>
<pre class="prettyprint linenums lang-yaml"><ol class="linenums"><li class="L0"><span class="com"># src/Ens/JobeetBundle/Resources/config/doctrine/User.orm.yml</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="pln">Ens\JobeetBundle\Entity\</span><span class="kwd">User:</span></li><li class="L3"><span class="pln">  </span><span class="kwd">type: </span><span class="pln">entity</span></li><li class="L4"><span class="pln">  </span><span class="kwd">table: </span><span class="pln">user</span></li><li class="L5"><span class="pln">  </span><span class="kwd">id:</span></li><li class="L6"><span class="pln">    </span><span class="kwd">id:</span></li><li class="L7"><span class="pln">      </span><span class="kwd">type: </span><span class="pln">integer</span></li><li class="L8"><span class="pln">      </span><span class="kwd">generator: </span><span class="pln">{ </span><span class="kwd">strategy: </span><span class="pln">AUTO }</span></li><li class="L9"><span class="pln">  </span><span class="kwd">fields:</span></li><li class="L0"><span class="pln">    </span><span class="kwd">username:</span></li><li class="L1"><span class="pln">      </span><span class="kwd">type: </span><span class="pln">string</span></li><li class="L2"><span class="pln">      </span><span class="kwd">length: </span><span class="pln">255</span></li><li class="L3"><span class="pln">    </span><span class="kwd">password:</span></li><li class="L4"><span class="pln">      </span><span class="kwd">type: </span><span class="pln">string</span></li><li class="L5"><span class="pln">      </span><span class="kwd">length: </span><span class="pln">255</span></li></ol></pre>
<p>Maintenant, exécutez la commande <strong>doctrine:generate:entities</strong> pour créer la nouvelle entité <strong>User</strong>:</p>
<pre>php app/console doctrine:generate:entities EnsJobeetBundle</pre>
<p>Et mettez à jour la BDD:</p>
<pre>php app/console doctrine:schema:update --force</pre>
<p>La seule exigence pour votre nouvelle classe <strong>User</strong> est qu'elle implémente l'interface <strong>UserInterface</strong>. Cela signifie que votre concept d'un "utilisateur" peut être n'importe quoi, tant qu'il implémente cette interface. Ouvrez le fichier <strong>User.php</strong> et modifiez-le comme suit:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">// src Ens/JobeetBundle/Entity/User.php</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="kwd">namespace</span><span class="pln"> </span><span class="typ">Ens</span><span class="pln">\JobeetBundle\Entity</span><span class="pun">;</span></li><li class="L3"><span class="pln"> </span></li><li class="L4"><span class="kwd">use</span><span class="pln"> </span><span class="typ">Symfony</span><span class="pln">\Component\Security\Core\User\UserInterface</span><span class="pun">;</span></li><li class="L5"><span class="kwd">use</span><span class="pln"> </span><span class="typ">Doctrine</span><span class="pln">\ORM\Mapping </span><span class="kwd">as</span><span class="pln"> ORM</span><span class="pun">;</span></li><li class="L6"><span class="pln"> </span></li><li class="L7"><span class="kwd">class</span><span class="pln"> </span><span class="typ">User</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">UserInterface</span></li><li class="L8"><span class="pun">{</span></li><li class="L9"><span class="pln">    </span><span class="kwd">private</span><span class="pln"> $id</span><span class="pun">;</span></li><li class="L0"><span class="pln"> </span></li><li class="L1"><span class="pln">    </span><span class="kwd">private</span><span class="pln"> $username</span><span class="pun">;</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pln">    </span><span class="kwd">private</span><span class="pln"> $password</span><span class="pun">;</span></li><li class="L4"><span class="pln"> </span></li><li class="L5"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> getId</span><span class="pun">()</span></li><li class="L6"><span class="pln">    </span><span class="pun">{</span></li><li class="L7"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">id</span><span class="pun">;</span></li><li class="L8"><span class="pln">    </span><span class="pun">}</span></li><li class="L9"><span class="pln"> </span></li><li class="L0"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> setUsername</span><span class="pun">(</span><span class="pln">$username</span><span class="pun">)</span></li><li class="L1"><span class="pln">    </span><span class="pun">{</span></li><li class="L2"><span class="pln">        $this</span><span class="pun">-&gt;</span><span class="pln">username </span><span class="pun">=</span><span class="pln"> $username</span><span class="pun">;</span></li><li class="L3"><span class="pln">    </span><span class="pun">}</span></li><li class="L4"><span class="pln"> </span></li><li class="L5"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> getUsername</span><span class="pun">()</span></li><li class="L6"><span class="pln">    </span><span class="pun">{</span></li><li class="L7"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">username</span><span class="pun">;</span></li><li class="L8"><span class="pln">    </span><span class="pun">}</span></li><li class="L9"><span class="pln"> </span></li><li class="L0"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> setPassword</span><span class="pun">(</span><span class="pln">$password</span><span class="pun">)</span></li><li class="L1"><span class="pln">    </span><span class="pun">{</span></li><li class="L2"><span class="pln">        $this</span><span class="pun">-&gt;</span><span class="pln">password </span><span class="pun">=</span><span class="pln"> $password</span><span class="pun">;</span></li><li class="L3"><span class="pln">    </span><span class="pun">}</span></li><li class="L4"><span class="pln"> </span></li><li class="L5"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> getPassword</span><span class="pun">()</span></li><li class="L6"><span class="pln">    </span><span class="pun">{</span></li><li class="L7"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">password</span><span class="pun">;</span></li><li class="L8"><span class="pln">    </span><span class="pun">}</span></li><li class="L9"><span class="pln"> </span></li><li class="L0"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> getRoles</span><span class="pun">()</span></li><li class="L1"><span class="pln">    </span><span class="pun">{</span></li><li class="L2"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> array</span><span class="pun">(</span><span class="str">'ROLE_ADMIN'</span><span class="pun">);</span></li><li class="L3"><span class="pln">    </span><span class="pun">}</span></li><li class="L4"><span class="pln"> </span></li><li class="L5"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> getSalt</span><span class="pun">()</span></li><li class="L6"><span class="pln">    </span><span class="pun">{</span></li><li class="L7"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></li><li class="L8"><span class="pln">    </span><span class="pun">}</span></li><li class="L9"><span class="pln"> </span></li><li class="L0"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> eraseCredentials</span><span class="pun">()</span></li><li class="L1"><span class="pln">    </span><span class="pun">{</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pln">    </span><span class="pun">}</span></li><li class="L4"><span class="pln"> </span></li><li class="L5"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> equals</span><span class="pun">(</span><span class="typ">UserInterface</span><span class="pln"> $user</span><span class="pun">)</span></li><li class="L6"><span class="pln">    </span><span class="pun">{</span></li><li class="L7"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> $user</span><span class="pun">-&gt;</span><span class="pln">getUsername</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">getUsername</span><span class="pun">();</span></li><li class="L8"><span class="pln">    </span><span class="pun">}</span></li><li class="L9"><span class="pun">}</span></li></ol></pre>
<p>Pour l'entité générée, nous avons ajouté les méthodes requises par la classe <strong>UserInterface</strong>: <strong>GetRoles</strong>, <strong>getSalt</strong>, <strong>eraseCredentials</strong> et <strong>equals</strong>.</p>
<p>Ensuite, configurez un fournisseur d'entité utilisateur, et faites-le pointer vers votre classe <strong>User</strong>:</p>
<pre class="prettyprint linenums lang-yaml"><ol class="linenums"><li class="L0"><span class="com"># app/config/security.yml</span></li><li class="L1"><span class="com"># ...</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pln">    </span><span class="kwd">providers:</span></li><li class="L4"><span class="pln">        </span><span class="kwd">main:</span></li><li class="L5"><span class="pln">            </span><span class="kwd">entity: </span><span class="pln">{ </span><span class="kwd">class: </span><span class="pln">Ens\JobeetBundle\Entity\User, </span><span class="kwd">property: </span><span class="pln">username }</span></li><li class="L6"><span class="pln"> </span></li><li class="L7"><span class="pln">    </span><span class="kwd">encoders:</span></li><li class="L8"><span class="pln">        Ens\JobeetBundle\Entity\</span><span class="kwd">User: </span><span class="pln">sha512</span></li></ol></pre>
<p>Nous avons également changé le chiffrage pour notre nouvelle classe <strong>User</strong> afin d'utiliser l'algorithme <strong>sha512</strong> pour hasher les mots de passe.</p>
<p>Maintenant, tout est mis en place, mais nous avons besoin de créer notre premier utilisateur. Pour ce faire, nous allons créer une nouvelle commande de Symfony:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">// src/Ens/JobeetBundle/Command/JobeetUsersCommand.php</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="kwd">namespace</span><span class="pln"> </span><span class="typ">Ens</span><span class="pln">\JobeetBundle\Command</span><span class="pun">;</span></li><li class="L3"><span class="pln"> </span></li><li class="L4"><span class="kwd">use</span><span class="pln"> </span><span class="typ">Symfony</span><span class="pln">\Bundle\FrameworkBundle\Command\ContainerAwareCommand</span><span class="pun">;</span></li><li class="L5"><span class="kwd">use</span><span class="pln"> </span><span class="typ">Symfony</span><span class="pln">\Component\Console\Input\InputArgument</span><span class="pun">;</span></li><li class="L6"><span class="kwd">use</span><span class="pln"> </span><span class="typ">Symfony</span><span class="pln">\Component\Console\Input\InputInterface</span><span class="pun">;</span></li><li class="L7"><span class="kwd">use</span><span class="pln"> </span><span class="typ">Symfony</span><span class="pln">\Component\Console\Input\InputOption</span><span class="pun">;</span></li><li class="L8"><span class="kwd">use</span><span class="pln"> </span><span class="typ">Symfony</span><span class="pln">\Component\Console\Output\OutputInterface</span><span class="pun">;</span></li><li class="L9"><span class="kwd">use</span><span class="pln"> </span><span class="typ">Ens</span><span class="pln">\JobeetBundle\Entity\User</span><span class="pun">;</span></li><li class="L0"><span class="pln"> </span></li><li class="L1"><span class="kwd">class</span><span class="pln"> </span><span class="typ">JobeetUsersCommand</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">ContainerAwareCommand</span></li><li class="L2"><span class="pun">{</span></li><li class="L3"><span class="pln">    </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> configure</span><span class="pun">()</span></li><li class="L4"><span class="pln">    </span><span class="pun">{</span></li><li class="L5"><span class="pln">        $this</span></li><li class="L6"><span class="pln">            </span><span class="pun">-&gt;</span><span class="pln">setName</span><span class="pun">(</span><span class="str">'ens:jobeet:users'</span><span class="pun">)</span></li><li class="L7"><span class="pln">            </span><span class="pun">-&gt;</span><span class="pln">setDescription</span><span class="pun">(</span><span class="str">'Add Jobeet users'</span><span class="pun">)</span></li><li class="L8"><span class="pln">            </span><span class="pun">-&gt;</span><span class="pln">addArgument</span><span class="pun">(</span><span class="str">'username'</span><span class="pun">,</span><span class="pln"> </span><span class="typ">InputArgument</span><span class="pun">::</span><span class="pln">REQUIRED</span><span class="pun">,</span><span class="pln"> </span><span class="str">'The username'</span><span class="pun">)</span></li><li class="L9"><span class="pln">            </span><span class="pun">-&gt;</span><span class="pln">addArgument</span><span class="pun">(</span><span class="str">'password'</span><span class="pun">,</span><span class="pln"> </span><span class="typ">InputArgument</span><span class="pun">::</span><span class="pln">REQUIRED</span><span class="pun">,</span><span class="pln"> </span><span class="str">'The password'</span><span class="pun">)</span></li><li class="L0"><span class="pln">        </span><span class="pun">;</span></li><li class="L1"><span class="pln">    </span><span class="pun">}</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pln">    </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> execute</span><span class="pun">(</span><span class="typ">InputInterface</span><span class="pln"> $input</span><span class="pun">,</span><span class="pln"> </span><span class="typ">OutputInterface</span><span class="pln"> $output</span><span class="pun">)</span></li><li class="L4"><span class="pln">    </span><span class="pun">{</span></li><li class="L5"><span class="pln">        $username </span><span class="pun">=</span><span class="pln"> $input</span><span class="pun">-&gt;</span><span class="pln">getArgument</span><span class="pun">(</span><span class="str">'username'</span><span class="pun">);</span></li><li class="L6"><span class="pln">        $password </span><span class="pun">=</span><span class="pln"> $input</span><span class="pun">-&gt;</span><span class="pln">getArgument</span><span class="pun">(</span><span class="str">'password'</span><span class="pun">);</span></li><li class="L7"><span class="pln"> </span></li><li class="L8"><span class="pln">        $em </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">getContainer</span><span class="pun">()-&gt;</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'doctrine'</span><span class="pun">)-&gt;</span><span class="pln">getEntityManager</span><span class="pun">();</span></li><li class="L9"><span class="pln"> </span></li><li class="L0"><span class="pln">        $user </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">User</span><span class="pun">();</span></li><li class="L1"><span class="pln">        $user</span><span class="pun">-&gt;</span><span class="pln">setUsername</span><span class="pun">(</span><span class="pln">$username</span><span class="pun">);</span></li><li class="L2"><span class="pln">        </span><span class="com">// encode the password</span></li><li class="L3"><span class="pln">        $factory </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">getContainer</span><span class="pun">()-&gt;</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'security.encoder_factory'</span><span class="pun">);</span></li><li class="L4"><span class="pln">        $encoder </span><span class="pun">=</span><span class="pln"> $factory</span><span class="pun">-&gt;</span><span class="pln">getEncoder</span><span class="pun">(</span><span class="pln">$user</span><span class="pun">);</span></li><li class="L5"><span class="pln">        $encodedPassword </span><span class="pun">=</span><span class="pln"> $encoder</span><span class="pun">-&gt;</span><span class="pln">encodePassword</span><span class="pun">(</span><span class="pln">$password</span><span class="pun">,</span><span class="pln"> $user</span><span class="pun">-&gt;</span><span class="pln">getSalt</span><span class="pun">());</span></li><li class="L6"><span class="pln">        $user</span><span class="pun">-&gt;</span><span class="pln">setPassword</span><span class="pun">(</span><span class="pln">$encodedPassword</span><span class="pun">);</span></li><li class="L7"><span class="pln">        $em</span><span class="pun">-&gt;</span><span class="pln">persist</span><span class="pun">(</span><span class="pln">$user</span><span class="pun">);</span></li><li class="L8"><span class="pln">        $em</span><span class="pun">-&gt;</span><span class="pln">flush</span><span class="pun">();</span></li><li class="L9"><span class="pln"> </span></li><li class="L0"><span class="pln">        $output</span><span class="pun">-&gt;</span><span class="pln">writeln</span><span class="pun">(</span><span class="pln">sprintf</span><span class="pun">(</span><span class="str">'Added %s user with password %s'</span><span class="pun">,</span><span class="pln"> $username</span><span class="pun">,</span><span class="pln"> $password</span><span class="pun">));</span></li><li class="L1"><span class="pln">    </span><span class="pun">}</span></li><li class="L2"><span class="pun">}</span></li></ol></pre>
<p>Pour ajouter votre premier utilisateur exécutez:</p>
<pre>php app/console ens:jobeet:users admin admin</pre>
<p>Cela va créer l'utilisateur <strong>admin</strong> avec le mot de passe <strong>admin</strong>. Vous pouvez l'utiliser pour vous connecter à l'admininistration.</p>
<br>
<h2>Déconnexion</h2>
<p>La déconnexion est gérée automatiquement par le pare-feu. Tout ce que vous avez à faire est d'activer le paramètre <strong>logout</strong>:</p>
<pre class="prettyprint linenums lang-yaml"><ol class="linenums"><li class="L0"><span class="com"># app/config/security.yml</span></li><li class="L1"><span class="kwd">security:</span></li><li class="L2"><span class="pln">    </span><span class="kwd">firewalls:</span></li><li class="L3"><span class="pln">        </span><span class="kwd">secured_area:</span></li><li class="L4"><span class="pln">            </span><span class="com"># ...</span></li><li class="L5"><span class="pln">            </span><span class="kwd">logout:</span></li><li class="L6"><span class="pln">                </span><span class="kwd">path: </span><span class="pln">  /logout</span></li><li class="L7"><span class="pln">                </span><span class="kwd">target: </span><span class="pln">/</span></li><li class="L8"><span class="pln">    </span><span class="com"># ...</span></li></ol></pre>
<p>Une fois que cela est configuré dans votre pare-feu, l'envoi d'un utilisateur vers <strong>/logout</strong> (ou le paramètre <strong>path</strong> que vous avez configuré), déconnectera l'utilisateur en cours. L'utilisateur sera alors envoyé à la page d'accueil (la valeur définie par le paramètre <strong>target</strong>).</p>
<p>Vous n'aurez pas besoin de mettre en œuvre un contrôleur pour l'URL <strong>/logout</strong> puisque le pare-feu s'occupe de tout. Vous pouvez, cependant, vouloir créer une route de sorte que vous pouvez l'utiliser pour générer l'URL:</p>
<pre class="prettyprint linenums lang-yaml"><ol class="linenums"><li class="L0"><span class="com"># src/Ens/JobeetBundle/Resources/config/routing.yml</span></li><li class="L1"><span class="com"># ...</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="kwd">logout:</span></li><li class="L4"><span class="pln">    </span><span class="kwd">pattern: </span><span class="pln">  /logout</span></li><li class="L5"><span class="pln"> </span></li><li class="L6"><span class="com"># ...</span></li></ol></pre>
<p>Tout ce qui reste à faire est d'ajouter le lien de déconnexion à notre administration. Pour ce faire, nous allons remplacer le <strong>user_block.html.twig</strong> de <strong>SonataAdminBundle</strong>. Créez le fichier <strong>user_block.html.twig</strong> dans le répertoire <strong>app/Resources/SonataAdminBundle/views/Core/</strong>:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">&lt;!-- app/Resources/SonataAdminBundle/views/Core/user_block.html.twig --&gt;</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="pln">{% block user_block %}</span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('logout') }}"</span><span class="tag">&gt;</span><span class="pln">Logout</span><span class="tag">&lt;/a&gt;</span><span class="pln">{% endblock %}</span></li></ol></pre>
<p>Maintenant, si vous essayez d'entrer dans l'administration, il vous sera demandé un nom d'utilisateur et un mot de passe, puis, le lien de déconnexion sera affiché dans le coin supérieur droit.</p>
<br>
<h2>La session utilisateur</h2>
<p>Symfony2 fournit un objet de session que vous pouvez utiliser pour stocker des informations sur l'utilisateur entre les requêtes. Par défaut, Symfony2 stocke les attributs dans un cookie par l'intermédiaire des sessions PHP natives.</p>
<p>Vous pouvez stocker et récupérer des informations à partir de la session facilement depuis le contrôleur:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="pln">$session </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">getRequest</span><span class="pun">()-&gt;</span><span class="pln">getSession</span><span class="pun">();</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="com">// store an attribute for reuse during a later user request</span></li><li class="L3"><span class="pln">$session</span><span class="pun">-&gt;</span><span class="kwd">set</span><span class="pun">(</span><span class="str">'foo'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'bar'</span><span class="pun">);</span></li><li class="L4"><span class="pln"> </span></li><li class="L5"><span class="com">// in another controller for another request</span></li><li class="L6"><span class="pln">$foo </span><span class="pun">=</span><span class="pln"> $session</span><span class="pun">-&gt;</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'foo'</span><span class="pun">);</span></li></ol></pre>
<p>Malheureusement, les scénarios de Jobeet n'ont aucune exigence qui comprend le stockage d'informations dans la session utilisateur. Nous allons donc ajouter une nouvelle exigence: pour faciliter la navigation dans l'offre, les trois dernières offres vues par l'utilisateur doivent être affichées dans le menu avec des liens pour revenir à la page des offres par la suite.</p>
<p>Lorsqu'un utilisateur accède à la page d'une offre, l'objet de l'offre affichée doit être ajouté dans l'historique de l'utilisateur et stocké dans la session:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">// src/Ens/JobeetBundle/Controller/JobController.php</span></li><li class="L1"><span class="com">// ...</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> showAction</span><span class="pun">(</span><span class="pln">$id</span><span class="pun">)</span></li><li class="L4"><span class="pun">{</span></li><li class="L5"><span class="pln">    $em </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">getDoctrine</span><span class="pun">()-&gt;</span><span class="pln">getEntityManager</span><span class="pun">();</span></li><li class="L6"><span class="pln"> </span></li><li class="L7"><span class="pln">    $entity </span><span class="pun">=</span><span class="pln"> $em</span><span class="pun">-&gt;</span><span class="pln">getRepository</span><span class="pun">(</span><span class="str">'EnsJobeetBundle:Job'</span><span class="pun">)-&gt;</span><span class="pln">getActiveJob</span><span class="pun">(</span><span class="pln">$id</span><span class="pun">);</span></li><li class="L8"><span class="pln"> </span></li><li class="L9"><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">$entity</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class="L0"><span class="pln">        </span><span class="kwd">throw</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">createNotFoundException</span><span class="pun">(</span><span class="str">'Unable to find Job entity.'</span><span class="pun">);</span></li><li class="L1"><span class="pln">    </span><span class="pun">}</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pln">    $session </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">getRequest</span><span class="pun">()-&gt;</span><span class="pln">getSession</span><span class="pun">();</span></li><li class="L4"><span class="pln"> </span></li><li class="L5"><span class="pln">    </span><span class="com">// fetch jobs already stored in the job history</span></li><li class="L6"><span class="pln">    $jobs </span><span class="pun">=</span><span class="pln"> $session</span><span class="pun">-&gt;</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'job_history'</span><span class="pun">,</span><span class="pln"> array</span><span class="pun">());</span></li><li class="L7"><span class="pln"> </span></li><li class="L8"><span class="pln">    </span><span class="com">// store the job as an array so we can put it in the session and avoid entity serialize errors</span></li><li class="L9"><span class="pln">    $job </span><span class="pun">=</span><span class="pln"> array</span><span class="pun">(</span><span class="str">'id'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> $entity</span><span class="pun">-&gt;</span><span class="pln">getId</span><span class="pun">(),</span><span class="pln"> </span><span class="str">'position'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln">$entity</span><span class="pun">-&gt;</span><span class="pln">getPosition</span><span class="pun">(),</span><span class="pln"> </span><span class="str">'company'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> $entity</span><span class="pun">-&gt;</span><span class="pln">getCompany</span><span class="pun">(),</span><span class="pln"> </span><span class="str">'companyslug'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> $entity</span><span class="pun">-&gt;</span><span class="pln">getCompanySlug</span><span class="pun">(),</span><span class="pln"> </span><span class="str">'locationslug'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> $entity</span><span class="pun">-&gt;</span><span class="pln">getLocationSlug</span><span class="pun">(),</span><span class="pln"> </span><span class="str">'positionslug'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> $entity</span><span class="pun">-&gt;</span><span class="pln">getPositionSlug</span><span class="pun">());</span></li><li class="L0"><span class="pln"> </span></li><li class="L1"><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">in_array</span><span class="pun">(</span><span class="pln">$job</span><span class="pun">,</span><span class="pln"> $jobs</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></li><li class="L2"><span class="pln">        </span><span class="com">// add the current job at the beginning of the array</span></li><li class="L3"><span class="pln">        array_unshift</span><span class="pun">(</span><span class="pln">$jobs</span><span class="pun">,</span><span class="pln"> $job</span><span class="pun">);</span></li><li class="L4"><span class="pln"> </span></li><li class="L5"><span class="pln">        </span><span class="com">// store the new job history back into the session</span></li><li class="L6"><span class="pln">        $session</span><span class="pun">-&gt;</span><span class="kwd">set</span><span class="pun">(</span><span class="str">'job_history'</span><span class="pun">,</span><span class="pln"> array_slice</span><span class="pun">(</span><span class="pln">$jobs</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">));</span></li><li class="L7"><span class="pln">    </span><span class="pun">}</span></li><li class="L8"><span class="pln"> </span></li><li class="L9"><span class="pln">    $deleteForm </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">createDeleteForm</span><span class="pun">(</span><span class="pln">$id</span><span class="pun">);</span></li><li class="L0"><span class="pln"> </span></li><li class="L1"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">render</span><span class="pun">(</span><span class="str">'EnsJobeetBundle:Job:show.html.twig'</span><span class="pun">,</span><span class="pln"> array</span><span class="pun">(</span></li><li class="L2"><span class="pln">        </span><span class="str">'entity'</span><span class="pln">      </span><span class="pun">=&gt;</span><span class="pln"> $entity</span><span class="pun">,</span></li><li class="L3"><span class="pln">        </span><span class="str">'delete_form'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> $deleteForm</span><span class="pun">-&gt;</span><span class="pln">createView</span><span class="pun">(),</span></li><li class="L4"><span class="pln">    </span><span class="pun">));</span></li><li class="L5"><span class="pun">}</span></li></ol></pre>
<p>Dans le layout, ajoutez le code suivant avant la div <strong>#content</strong>:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">&lt;!-- src/End/JobeetBundle/Resources/views/layout.html.twig --&gt;</span></li><li class="L1"><span class="com">&lt;!-- ... --&gt;</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"job_history"</span><span class="tag">&gt;</span></li><li class="L4"><span class="pln">    Recent viewed jobs:</span></li><li class="L5"><span class="pln">    </span><span class="tag">&lt;ul&gt;</span></li><li class="L6"><span class="pln">        {% for job in app.session.get('job_history') %}</span></li><li class="L7"><span class="pln">            </span><span class="tag">&lt;li&gt;</span></li><li class="L8"><span class="pln">                </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('ens_job_show', { 'id': job.id, 'company': job.companyslug, 'location': job.locationslug, 'position': job.positionslug }) }}"</span><span class="tag">&gt;</span><span class="pln">{{ job.position }} - {{ job.company }}</span><span class="tag">&lt;/a&gt;</span></li><li class="L9"><span class="pln">            </span><span class="tag">&lt;/li&gt;</span></li><li class="L0"><span class="pln">        {% endfor %}</span></li><li class="L1"><span class="pln">    </span><span class="tag">&lt;/ul&gt;</span></li><li class="L2"><span class="tag">&lt;/div&gt;</span></li><li class="L3"><span class="pln"> </span></li><li class="L4"><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"content"</span><span class="tag">&gt;</span></li><li class="L5"><span class="pln"> </span></li><li class="L6"><span class="com">&lt;!-- ... --&gt;</span></li></ol></pre>
<br>
<h2>Les messages flash</h2>
<p>Les messages flash sont des petits messages que vous pouvez stocker sur la session de l'utilisateur pendant exactement une requête supplémentaire. Cette fonction est utile lors du traitement d'un formulaire: vous souhaitez rediriger et afficher un message spécial sur la requête suivante. Nous avons déjà utilisé des messages flash dans notre projet lorsque nous publions une offre:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">// src/Ens/JobeetBundle/Controller/JobController.php</span></li><li class="L1"><span class="com">// ...</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> publishAction</span><span class="pun">(</span><span class="pln">$token</span><span class="pun">)</span></li><li class="L4"><span class="pun">{</span></li><li class="L5"><span class="pln">    </span><span class="com">// ...</span></li><li class="L6"><span class="pln"> </span></li><li class="L7"><span class="pln">    $this</span><span class="pun">-&gt;</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'session'</span><span class="pun">)-&gt;</span><span class="pln">setFlash</span><span class="pun">(</span><span class="str">'notice'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Your job is now online for 30 days.'</span><span class="pun">);</span></li><li class="L8"><span class="pln"> </span></li><li class="L9"><span class="pln">    </span><span class="com">// ...</span></li><li class="L0"><span class="pun">}</span></li></ol></pre>
<p>Le premier argument de la fonction <strong>setFlash</strong> est l'identifiant du flash et le second est le message à afficher. Vous pouvez définir les flashes que vous voulez, mais <strong>notice</strong> et <strong>error</strong> sont les deux plus communs.</p>
<p>Pour afficher les messages flash à l'utilisateur, vous devez les inclure dans le template. Nous l'avons fait dans le template <strong>layout.html.twig</strong>:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">&lt;!-- src/Ens/JobeetBundle/Resources/views/layout.html.twig --&gt;</span></li><li class="L1"><span class="com">&lt;!-- ... --&gt;</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pln">{% if app.session.hasFlash('notice') %}</span></li><li class="L4"><span class="pln">    </span><span class="tag">&lt;div&gt;</span></li><li class="L5"><span class="pln">        {{ app.session.flash('notice') }}</span></li><li class="L6"><span class="pln">    </span><span class="tag">&lt;/div&gt;</span></li><li class="L7"><span class="pln">{% endif %}</span></li><li class="L8"><span class="pln"> </span></li><li class="L9"><span class="com">&lt;!-- ... --&gt;</span></li></ol></pre>
<br>
<p class="clearfix noprint">
	<a href="le-paquet-admin.html" class="btn btn-success pull-left">Chapitre précédent</a>
	<a href="flux-de-donnees.html" class="btn btn-success pull-right">Chapitre suivant</a>
</p>														<p class="link_source noprint"><a href="http://www.ens.ro/2012/08/09/symfony2-jobeet-day-13-security/" target="_blank">» Lire l'article original</a></p>
																					<br>
													</section>
					</div>
				</div>
				<hr />
				<footer>
					<!--<p class="tcenter">Tutoriel original par <a href="http://www.ens.ro/2012/03/21/jobeet-tutorial-with-symfony2/" target="_blank">Dragos Holban</a> - Traduit par <a href="https://plus.google.com/109236735134093009460?rel=author" target="_blank">Jonathan Thuau</a> - Le tuto sur <a href="https://github.com/thujohn/Jobeet" target="_blank">github</a></p>-->
				</footer>
			</div>
		</div>
	</div>
<script src="assets/js/jquery-1.8.2.min.js"></script>
<script src="assets/js/bootstrap.js"></script>
<script src="assets/js/prettify.js"></script>
<script src="assets/js/lang-yaml.js"></script>
<script src="assets/js/shadowbox.js"></script>
<script type="text/javascript">
<!--
jQuery(document).ready(function(){
	Shadowbox.init();
	prettyPrint();
	jQuery('.bs-docs-sidenav').affix({
		offset: {
			top: 150,
			bottom: 270
		}
	});
	jQuery('a[href*=#]').click(function (e) {
		var hash = jQuery(this).attr('href');
		e.preventDefault();
		var dest = 0;
		if (jQuery(this.hash).offset().top > (jQuery(document).height() - jQuery(window).height())){
			dest = jQuery(document).height() - jQuery(window).height();
		}else{
			dest = jQuery(this.hash).offset().top;
		}
		jQuery('html,body').animate({scrollTop:dest}, 1000, 'swing');
	});
});
-->
</script>
</body>
</html>