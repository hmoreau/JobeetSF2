<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Tuto Jobeet Symfony2 FR :: Démarrage du projet</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link rel="stylesheet" type="text/css" href="assets/css/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="assets/css/bootstrap-responsive.css" />
<link rel="stylesheet" type="text/css" href="assets/css/style.css" />
<link rel="stylesheet" type="text/css" href="assets/css/docs.css" />
<link rel="stylesheet" type="text/css" href="assets/css/prettify.css" />
<link rel="stylesheet" type="text/css" href="assets/css/shadowbox.css" />
<link rel="stylesheet" type="text/css" href="assets/css/print.css" media="print" />
<link rel="shortcut icon" href="assets/img/favicon.ico">
<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

</head>

<body>
	<a href="https://github.com/thujohn/Jobeet" target="_blank" id="gogithub"><img src="assets/img/github.gif" alt="" /></a>
	<div class="navbar navbar-inverse hide-on-desktop show-on-tablets show-on-mobile noprint">
		<div class="navbar-inner noprint">
			<div class="container">
				<button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="brand" href="./">Jobeet FR</a>
				<div class="nav-collapse collapse">
					<ul class="nav">
						<li class="sommaire"><a href="sommaire.html"><i class="icon-chevron-right"></i>Sommaire</a></li><li class="demarrage-du-projet"><a href="demarrage-du-projet.html"><i class="icon-chevron-right"></i><strong>[01]</strong> Démarrage du projet</a></li><li class="le-projet"><a href="le-projet.html"><i class="icon-chevron-right"></i><strong>[02]</strong> Le projet</a></li><li class="le-modele-de-donnees"><a href="le-modele-de-donnees.html"><i class="icon-chevron-right"></i><strong>[03]</strong> Le Modèle de Données</a></li><li class="le-controleur-et-la-vue"><a href="le-controleur-et-la-vue.html"><i class="icon-chevron-right"></i><strong>[04]</strong> Le Contrôleur et la Vue</a></li><li class="le-routage"><a href="le-routage.html"><i class="icon-chevron-right"></i><strong>[05]</strong> Le Routage</a></li><li class="aller-plus-loin-avec-le-modele"><a href="aller-plus-loin-avec-le-modele.html"><i class="icon-chevron-right"></i><strong>[06]</strong> Aller plus loin avec le Modèle</a></li><li class="jouons-avec-la-page-categorie"><a href="jouons-avec-la-page-categorie.html"><i class="icon-chevron-right"></i><strong>[07]</strong> Jouons avec les catégories</a></li><li class="les-tests-unitaires"><a href="les-tests-unitaires.html"><i class="icon-chevron-right"></i><strong>[08]</strong> Les tests unitaires</a></li><li class="les-tests-fonctionnels"><a href="les-tests-fonctionnels.html"><i class="icon-chevron-right"></i><strong>[09]</strong> Les tests fonctionnels</a></li><li class="les-formulaires"><a href="les-formulaires.html"><i class="icon-chevron-right"></i><strong>[10]</strong> Les formulaires</a></li><li class="testez-vos-formulaires"><a href="testez-vos-formulaires.html"><i class="icon-chevron-right"></i><strong>[11]</strong> Testez vos formulaires</a></li><li class="le-paquet-admin"><a href="le-paquet-admin.html"><i class="icon-chevron-right"></i><strong>[12]</strong> Le paquet Admin</a></li><li class="securite"><a href="securite.html"><i class="icon-chevron-right"></i><strong>[13]</strong> Sécurité</a></li><li class="active"><a href="flux-de-donnees.html"><i class="icon-chevron-right"></i><strong>[14]</strong> Flux de données</a></li><li class="services-web"><a href="services-web.html"><i class="icon-chevron-right"></i><strong>[15]</strong> Services Web</a></li><li class="l-envoi-d-email"><a href="l-envoi-d-email.html"><i class="icon-chevron-right"></i><strong>[16]</strong> L'envoi d'email</a></li><li class="la-recherche"><a href="la-recherche.html"><i class="icon-chevron-right"></i><strong>[17]</strong> La recherche</a></li><li class="ajax"><a href="ajax.html"><i class="icon-chevron-right"></i><strong>[18]</strong> AJAX</a></li><li class="internationalisation-et-regionalisation"><a href="internationalisation-et-regionalisation.html"><i class="icon-chevron-right"></i><strong>[19]</strong> Internationalisation et régionalisation</a></li>
					</ul>
				</div>
			</div>
		</div>
	</div>
	<div id="container">
		<div id="bootstrap-docs">
			<header class="jumbotron subhead hide-on-tablets hide-on-mobile" id="overview">
				<div class="container">
					<h1><a href="./">Jobeet FR</a></h1>
					<p class="lead">Le tutoriel pour Symfony2 en français</p>
				</div>
			</header>
			<div class="container">
				<div class="row">
										<div class="span12">
											<section class="justify">
                                            <a href="flux-de-donnees.html" class="pull-right btn btn-success hide-on-tablets hide-on-mobile noprint">Vue normale</a><div class="page-header clearfix"><h1 class="pull-left">Flux de données</h1></div>
							<p>Si vous êtes à la recherche d'un emploi, vous aurez probablement besoin d'être informé dès qu'un nouveau poste est disponible. Parce qu'il n'est pas très pratique de consulter le site web toutes les deux heures, nous allons ajouter plusieurs flux d'offres pour que nos utilisateurs Jobeet se tiennent à jour.</p>
<br>
<h2>Les formats de template</h2>
<p>Les templates sont un moyen générique pour rendre le contenu dans n'importe quel format. Bien que dans la plupart des cas vous utilisez des templates pour afficher le contenu HTML, un template peut tout aussi bien générer JavaScript, CSS, XML ou tout autre format.</p>
<p>Par exemple, la même "ressource" est souvent affichée dans plusieurs formats. Pour afficher une page au format XML, il suffit d'inclure le format dans le nom du template:</p>
<ul class="unstyled">
	<li>- Nom du template XML: <strong>AcmeArticleBundle:Article:index.xml.twig</strong></li>
	<li>- Nom de fichier du template XML: <strong>index.xml.twig</strong></li>
</ul>
<p>En réalité, ce n'est rien de plus qu'une convention de nommage et le template n'est actuellement pas affiché différemment en fonction de son format.</p>
<p>Dans de nombreux cas, vous voudrez peut-être permettre à un seul contrôleur de rendre plusieurs formats différents en fonction du "format demandé". Pour cette raison, un motif commun est de faire ce qui suit:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> indexAction</span><span class="pun">()</span></li><li class="L1"><span class="pun">{</span></li><li class="L2"><span class="pln">    $format </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">getRequest</span><span class="pun">()-&gt;</span><span class="pln">getRequestFormat</span><span class="pun">();</span></li><li class="L3"><span class="pln"> </span></li><li class="L4"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">render</span><span class="pun">(</span><span class="str">'AcmeBlogBundle:Blog:index.'</span><span class="pun">.</span><span class="pln">$format</span><span class="pun">.</span><span class="str">'.twig'</span><span class="pun">);</span></li><li class="L5"><span class="pun">}</span></li></ol></pre>
<p>La méthode <strong>getRequestFormat</strong> de l'objet <strong>Request</strong> est par défaut au format <strong>html</strong>, mais peut renvoyer n'importe quel autre format basé sur le format demandé par l'utilisateur. Le format de la demande est le plus souvent géré par le routage, où une route peut être configurée de sorte que <strong>/contact</strong> définit le format <strong>html</strong> alors que <strong>/contact.xml</strong> définit le format <strong>xml</strong>.</p>
<p>Pour créer des liens qui incluent le paramètre de format, incluez une clé <strong>_format</strong> dans le paramètre:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('article_show', {'id': 123, '_format': 'pdf'}) }}"</span><span class="tag">&gt;</span></li><li class="L1"><span class="pln">    PDF Version</span></li><li class="L2"><span class="tag">&lt;/a&gt;</span></li></ol></pre>
<h2>RSS</h2>
<h5>FLUX DES DERNIÈRES OFFRES</h5>
<p>Supporter différents formats est aussi facile que créer différents templates. Pour créer un flux Atom des dernières offres, créez un template <strong>index.atom.twig</strong>:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">&lt;!-- src/Ens/JobeetBundle/Resources/views/Job/index.atom.twig --&gt;</span></li><li class="L1"><span class="pun">&lt;?</span><span class="pln">xml version</span><span class="pun">=</span><span class="str">"1.0"</span><span class="pln"> encoding</span><span class="pun">=</span><span class="str">"utf-8"</span><span class="pun">?&gt;</span></li><li class="L2"><span class="tag">&lt;feed</span><span class="pln"> </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2005/Atom"</span><span class="tag">&gt;</span></li><li class="L3"><span class="pln">  </span><span class="tag">&lt;title&gt;</span><span class="pln">Jobeet</span><span class="tag">&lt;/title&gt;</span></li><li class="L4"><span class="pln">  </span><span class="tag">&lt;subtitle&gt;</span><span class="pln">Latest Jobs</span><span class="tag">&lt;/subtitle&gt;</span></li><li class="L5"><span class="pln">  </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">""</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"self"</span><span class="tag">/&gt;</span></li><li class="L6"><span class="pln">  </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">""</span><span class="tag">/&gt;</span></li><li class="L7"><span class="pln">  </span><span class="tag">&lt;updated&gt;&lt;/updated&gt;</span></li><li class="L8"><span class="pln">  </span><span class="tag">&lt;author&gt;&lt;name&gt;</span><span class="pln">Jobeet</span><span class="tag">&lt;/name&gt;&lt;/author&gt;</span></li><li class="L9"><span class="pln">  </span><span class="tag">&lt;id&gt;</span><span class="pln">Unique Id</span><span class="tag">&lt;/id&gt;</span></li><li class="L0"><span class="pln"> </span></li><li class="L1"><span class="pln">  </span><span class="tag">&lt;entry&gt;</span></li><li class="L2"><span class="pln">    </span><span class="tag">&lt;title&gt;</span><span class="pln">Job title</span><span class="tag">&lt;/title&gt;</span></li><li class="L3"><span class="pln">    </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">""</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L4"><span class="pln">    </span><span class="tag">&lt;id&gt;</span><span class="pln">Unique id</span><span class="tag">&lt;/id&gt;</span></li><li class="L5"><span class="pln">    </span><span class="tag">&lt;updated&gt;&lt;/updated&gt;</span></li><li class="L6"><span class="pln">    </span><span class="tag">&lt;summary&gt;</span><span class="pln">Job description</span><span class="tag">&lt;/summary&gt;</span></li><li class="L7"><span class="pln">    </span><span class="tag">&lt;author&gt;&lt;name&gt;</span><span class="pln">Company</span><span class="tag">&lt;/name&gt;&lt;/author&gt;</span></li><li class="L8"><span class="pln">  </span><span class="tag">&lt;/entry&gt;</span></li><li class="L9"><span class="tag">&lt;/feed&gt;</span></li></ol></pre>
<p>Dans le pied de page de Jobeet, mettez à jour le lien vers le flux:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">&lt;!-- src/Ens/JobeetBundle/Resources/views/layout.html.twig --&gt;</span></li><li class="L1"><span class="com">&lt;!-- ... --&gt;</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="tag">&lt;li&gt;&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('ens_job', {'_format': 'atom'}) }}"</span><span class="tag">&gt;</span><span class="pln">Full feed</span><span class="tag">&lt;/a&gt;&lt;/li&gt;</span></li><li class="L4"><span class="pln"> </span></li><li class="L5"><span class="com">&lt;!-- ... --&gt;</span></li></ol></pre>
<p>Ajoutez une balise <strong>&lt;link&gt;</strong> dans la section <strong>&lt;head&gt;</strong> du layout pour permettre la découverte automatique par le navigateur de notre flux:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">&lt;!-- src/Ens/JobeetBundle/Resources/views/layout.html.twig --&gt;</span></li><li class="L1"><span class="com">&lt;!-- ... --&gt;</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"alternate"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"application/atom+xml"</span><span class="pln"> </span><span class="atn">title</span><span class="pun">=</span><span class="atv">"Latest Jobs"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ url('ens_job', {'_format': 'atom'}) }}"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L4"><span class="pln"> </span></li><li class="L5"><span class="com">&lt;!-- ... --&gt;</span></li></ol></pre>
<p>Dans <strong>JobController</strong>, modifiez <strong>indexAction</strong> pour afficher le modèle en fonction de <strong>_format</strong>:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">// src/Ens/JobeetBundle/Controller/JobController.php</span></li><li class="L1"><span class="com">// ...</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pln">$format </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">getRequest</span><span class="pun">()-&gt;</span><span class="pln">getRequestFormat</span><span class="pun">();</span></li><li class="L4"><span class="pln"> </span></li><li class="L5"><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">render</span><span class="pun">(</span><span class="str">'EnsJobeetBundle:Job:index.'</span><span class="pun">.</span><span class="pln">$format</span><span class="pun">.</span><span class="str">'.twig'</span><span class="pun">,</span><span class="pln"> array</span><span class="pun">(</span></li><li class="L6"><span class="pln">    </span><span class="str">'categories'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> $categories</span></li><li class="L7"><span class="pun">));</span></li><li class="L8"><span class="pln"> </span></li><li class="L9"><span class="com">// ...</span></li></ol></pre>
<p>Remplacez l'en-tête du template Atom avec le code suivant:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">&lt;!-- src/Ens/JobeetBundle/Resources/views/Job/index.atom.twig --&gt;</span></li><li class="L1"><span class="com">&lt;!-- ... --&gt;</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pln">  </span><span class="tag">&lt;title&gt;</span><span class="pln">Jobeet</span><span class="tag">&lt;/title&gt;</span></li><li class="L4"><span class="pln">  </span><span class="tag">&lt;subtitle&gt;</span><span class="pln">Latest Jobs</span><span class="tag">&lt;/subtitle&gt;</span></li><li class="L5"><span class="pln">  </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ url('ens_job', {'_format': 'atom'}) }}"</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"self"</span><span class="tag">/&gt;</span></li><li class="L6"><span class="pln">  </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ url('EnsJobeetBundle_homepage') }}"</span><span class="tag">/&gt;</span></li><li class="L7"><span class="pln">  </span><span class="tag">&lt;updated&gt;</span><span class="pln">{{ lastUpdated }}</span><span class="tag">&lt;/updated&gt;</span></li><li class="L8"><span class="pln">  </span><span class="tag">&lt;author&gt;&lt;name&gt;</span><span class="pln">Jobeet</span><span class="tag">&lt;/name&gt;&lt;/author&gt;</span></li><li class="L9"><span class="pln">  </span><span class="tag">&lt;id&gt;</span><span class="pln">{{ feedId }}</span><span class="tag">&lt;/id&gt;</span></li><li class="L0"><span class="pln"> </span></li><li class="L1"><span class="com">&lt;!-- ... --&gt;</span></li></ol></pre>
<p>Dans JobController, nous devons envoyer les paramètres <strong>LastUpdated</strong> et <strong>feedId</strong> au template:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">// src/Ens/JobeetBundle/Controller/JobController.php</span></li><li class="L1"><span class="com">// ...</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">render</span><span class="pun">(</span><span class="str">'EnsJobeetBundle:Job:index.'</span><span class="pun">.</span><span class="pln">$format</span><span class="pun">.</span><span class="str">'.twig'</span><span class="pun">,</span><span class="pln"> array</span><span class="pun">(</span></li><li class="L4"><span class="pln">    </span><span class="str">'categories'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> $categories</span><span class="pun">,</span></li><li class="L5"><span class="pln">    </span><span class="str">'lastUpdated'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> $em</span><span class="pun">-&gt;</span><span class="pln">getRepository</span><span class="pun">(</span><span class="str">'EnsJobeetBundle:Job'</span><span class="pun">)-&gt;</span><span class="pln">getLatestPost</span><span class="pun">()-&gt;</span><span class="pln">getCreatedAt</span><span class="pun">()-&gt;</span><span class="pln">format</span><span class="pun">(</span><span class="pln">DATE_ATOM</span><span class="pun">),</span></li><li class="L6"><span class="pln">    </span><span class="str">'feedId'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> sha1</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'router'</span><span class="pun">)-&gt;</span><span class="pln">generate</span><span class="pun">(</span><span class="str">'ens_job'</span><span class="pun">,</span><span class="pln"> array</span><span class="pun">(</span><span class="str">'_format'</span><span class="pun">=&gt;</span><span class="pln"> </span><span class="str">'atom'</span><span class="pun">),</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">)),</span></li><li class="L7"><span class="pun">));</span></li><li class="L8"><span class="pln"> </span></li><li class="L9"><span class="com">// ...</span></li></ol></pre>
<p>Pour obtenir la date du dernier article, nous devons créer la méthode <strong>getLatestPost()</strong> dans <strong>JobRepository</strong>:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">// src/Ens/JobeetBundle/Repository/JobRepository.php</span></li><li class="L1"><span class="com">// ...</span></li><li class="L2"><span class="pln">&nbsp;</span></li><li class="L3"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> getLatestPost</span><span class="pun">()</span></li><li class="L4"><span class="pun">{</span></li><li class="L5"><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;$query </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">createQueryBuilder</span><span class="pun">(</span><span class="str">'j'</span><span class="pun">)</span></li><li class="L6"><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="pun">-&gt;</span><span class="kwd">where</span><span class="pun">(</span><span class="str">'j.expires_at &gt; :date'</span><span class="pun">)</span></li><li class="L7"><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="pun">-&gt;</span><span class="pln">setParameter</span><span class="pun">(</span><span class="str">'date'</span><span class="pun">,</span><span class="pln"> date</span><span class="pun">(</span><span class="str">'Y-m-d H:i:s'</span><span class="pun">,</span><span class="pln"> time</span><span class="pun">()))</span></li><li class="L8"><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="pun">-&gt;</span><span class="pln">andWhere</span><span class="pun">(</span><span class="str">'j.is_activated = :activated'</span><span class="pun">)</span></li><li class="L9"><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="pun">-&gt;</span><span class="pln">setParameter</span><span class="pun">(</span><span class="str">'activated'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span></li><li class="L0"><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="pun">-&gt;</span><span class="pln">orderBy</span><span class="pun">(</span><span class="str">'j.expires_at'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'DESC'</span><span class="pun">)</span></li><li class="L1"><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="pun">-&gt;</span><span class="pln">setMaxResults</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></li><li class="L2"><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="pun">-&gt;</span><span class="pln">getQuery</span><span class="pun">();</span></li><li class="L3"><span class="pln">&nbsp;</span></li><li class="L4"><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span></li><li class="L5"><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$job </span><span class="pun">=</span><span class="pln"> $query</span><span class="pun">-&gt;</span><span class="pln">getSingleResult</span><span class="pun">();</span></li><li class="L6"><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="pln">\Doctrine\Orm\NoResultException $e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class="L7"><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$job </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></li><li class="L8"><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="pun">}</span></li><li class="L9"><span class="pln">&nbsp;</span></li><li class="L0"><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="kwd">return</span><span class="pln"> $job</span><span class="pun">;</span></li><li class="L1"><span class="pun">}</span></li><li class="L2"><span class="pln">&nbsp;</span></li><li class="L3"><span class="com">// ...</span></li></ol></pre>
<p>Les entrées du flux peuvent être générées avec le code suivant:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">&lt;!-- src/Ens/JobeetBundle/Resources/views/Job/index.atom.twig --&gt;</span></li><li class="L1"><span class="com">&lt;!-- ... --&gt;</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pln">{% for category in categories %}</span></li><li class="L4"><span class="pln">  {% for entity in category.activejobs %}</span></li><li class="L5"><span class="pln">    </span><span class="tag">&lt;entry&gt;</span></li><li class="L6"><span class="pln">      </span><span class="tag">&lt;title&gt;</span><span class="pln">{{ entity.position }} ({{ entity.location }})</span><span class="tag">&lt;/title&gt;</span></li><li class="L7"><span class="pln">      </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ url('ens_job_show', { 'id': entity.id, 'company': entity.companyslug, 'location': entity.locationslug, 'position': entity.positionslug }) }}"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L8"><span class="pln">      </span><span class="tag">&lt;id&gt;</span><span class="pln">{{ entity.id }}</span><span class="tag">&lt;/id&gt;</span></li><li class="L9"><span class="pln">      </span><span class="tag">&lt;updated&gt;</span><span class="pln">{{ entity.createdAt.format(constant('DATE_ATOM')) }}</span><span class="tag">&lt;/updated&gt;</span></li><li class="L0"><span class="pln">      </span><span class="tag">&lt;summary</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"xhtml"</span><span class="tag">&gt;</span></li><li class="L1"><span class="pln">        </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://www.w3.org/1999/xhtml"</span><span class="tag">&gt;</span></li><li class="L2"><span class="pln">          {% if entity.logo %}</span></li><li class="L3"><span class="pln">            </span><span class="tag">&lt;div&gt;</span></li><li class="L4"><span class="pln">              </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ entity.url }}"</span><span class="tag">&gt;</span></li><li class="L5"><span class="pln">                </span><span class="tag">&lt;img</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"http://{{ app.request.host }}/uploads/jobs/{{ entity.logo }}"</span><span class="pln"> </span><span class="atn">alt</span><span class="pun">=</span><span class="atv">"{{ entity.company }} logo"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L6"><span class="pln">              </span><span class="tag">&lt;/a&gt;</span></li><li class="L7"><span class="pln">            </span><span class="tag">&lt;/div&gt;</span></li><li class="L8"><span class="pln">          {% endif %}</span></li><li class="L9"><span class="pln">          </span><span class="tag">&lt;div&gt;</span></li><li class="L0"><span class="pln">            {{ entity.description|nl2br }}</span></li><li class="L1"><span class="pln">          </span><span class="tag">&lt;/div&gt;</span></li><li class="L2"><span class="pln">          </span><span class="tag">&lt;h4&gt;</span><span class="pln">How to apply?</span><span class="tag">&lt;/h4&gt;</span></li><li class="L3"><span class="pln">          </span><span class="tag">&lt;p&gt;</span><span class="pln">{{ entity.howtoapply }}</span><span class="tag">&lt;/p&gt;</span></li><li class="L4"><span class="pln">        </span><span class="tag">&lt;/div&gt;</span></li><li class="L5"><span class="pln">      </span><span class="tag">&lt;/summary&gt;</span></li><li class="L6"><span class="pln">      </span><span class="tag">&lt;author&gt;&lt;name&gt;</span><span class="pln">{{ entity.company }}</span><span class="tag">&lt;/name&gt;&lt;/author&gt;</span></li><li class="L7"><span class="pln">    </span><span class="tag">&lt;/entry&gt;</span></li><li class="L8"><span class="pln">  {% endfor %}</span></li><li class="L9"><span class="pln">{% endfor %}</span></li><li class="L0"><span class="pln"> </span></li><li class="L1"><span class="com">&lt;!-- ... --&gt;</span></li></ol></pre>
<h5>DERNIÈRES OFFRES DANS UN FLUX DE CATÉGORIE</h5>
<p>L'un des objectifs de Jobeet est d'aider les gens à trouver des offres plus ciblées. Nous devons donc fournir un flux pour chaque catégorie.</p>
<p>Tout d'abord, nous allons mettre à jour les liens vers les flux de la catégorie dans les templates:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">&lt;!-- src/Ens/JobeetBundle/Resources/views/Job/index.html.twig --&gt;</span></li><li class="L1"><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"feed"</span><span class="tag">&gt;</span></li><li class="L2"><span class="pln">  </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('EnsJobeetBundle_category', { 'slug': category.slug, '_format': 'atom' }) }}"</span><span class="tag">&gt;</span><span class="pln">Feed</span><span class="tag">&lt;/a&gt;</span></li><li class="L3"><span class="tag">&lt;/div&gt;</span></li><li class="L4"><span class="pln"> </span></li><li class="L5"><span class="com">&lt;!-- src/Ens/JobeetBundle/Resources/views/Category/show.html.twig --&gt;</span></li><li class="L6"><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"feed"</span><span class="tag">&gt;</span></li><li class="L7"><span class="pln">  </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('EnsJobeetBundle_category', { 'slug': category.slug, '_format': 'atom' }) }}"</span><span class="tag">&gt;</span><span class="pln">Feed</span><span class="tag">&lt;/a&gt;</span></li><li class="L8"><span class="tag">&lt;/div&gt;</span></li></ol></pre>
<p>Mettez à jour <strong>showAction</strong> de <strong>CategoryController</strong> pour afficher le template correspondant:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">// src/Ens/JobeetBundle/Controller/CategoryController.php</span></li><li class="L1"><span class="com">// ...</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pln">$format </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">getRequest</span><span class="pun">()-&gt;</span><span class="pln">getRequestFormat</span><span class="pun">();</span></li><li class="L4"><span class="pln"> </span></li><li class="L5"><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">render</span><span class="pun">(</span><span class="str">'EnsJobeetBundle:Category:show.'</span><span class="pun">.</span><span class="pln">$format</span><span class="pun">.</span><span class="str">'.twig'</span><span class="pun">,</span><span class="pln"> array</span><span class="pun">(</span></li><li class="L6"><span class="pln">    </span><span class="str">'category'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> $category</span><span class="pun">,</span></li><li class="L7"><span class="pln">    </span><span class="str">'last_page'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> $last_page</span><span class="pun">,</span></li><li class="L8"><span class="pln">    </span><span class="str">'previous_page'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> $previous_page</span><span class="pun">,</span></li><li class="L9"><span class="pln">    </span><span class="str">'current_page'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> $page</span><span class="pun">,</span></li><li class="L0"><span class="pln">    </span><span class="str">'next_page'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> $next_page</span><span class="pun">,</span></li><li class="L1"><span class="pln">    </span><span class="str">'total_jobs'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> $total_jobs</span><span class="pun">,</span></li><li class="L2"><span class="pln">    </span><span class="str">'feedId'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> sha1</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'router'</span><span class="pun">)-&gt;</span><span class="pln">generate</span><span class="pun">(</span><span class="str">'EnsJobeetBundle_category'</span><span class="pun">,</span><span class="pln"> array</span><span class="pun">(</span><span class="str">'slug'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln">  $category</span><span class="pun">-&gt;</span><span class="pln">getSlug</span><span class="pun">(),</span><span class="pln"> </span><span class="str">'_format'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="str">'atom'</span><span class="pun">),</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">)),</span></li><li class="L3"><span class="pun">));</span></li><li class="L4"><span class="pln"> </span></li><li class="L5"><span class="com">// ...</span></li></ol></pre>
<p>Finalement, créez le template <strong>show.atom.twig</strong>:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">&lt;!-- src/Ens/JobeetBundle/Resources/views/Category/show.atom.twig --&gt;</span></li><li class="L1"><span class="pun">&lt;?</span><span class="pln">xml version</span><span class="pun">=</span><span class="str">"1.0"</span><span class="pln"> encoding</span><span class="pun">=</span><span class="str">"utf-8"</span><span class="pun">?&gt;</span></li><li class="L2"><span class="tag">&lt;feed</span><span class="pln"> </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2005/Atom"</span><span class="tag">&gt;</span></li><li class="L3"><span class="pln">  </span><span class="tag">&lt;title&gt;</span><span class="pln">Jobeet ({{ category.name }})</span><span class="tag">&lt;/title&gt;</span></li><li class="L4"><span class="pln">  </span><span class="tag">&lt;subtitle&gt;</span><span class="pln">Latest Jobs</span><span class="tag">&lt;/subtitle&gt;</span></li><li class="L5"><span class="pln">  </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ url('EnsJobeetBundle_category', { 'slug': category.slug, '_format': 'atom' }) }}"</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"self"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L6"><span class="pln">  </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ url('EnsJobeetBundle_category', { 'slug': category.slug }) }}"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L7"><span class="pln">  </span><span class="tag">&lt;updated&gt;</span><span class="pln">{{ category.activejobs[0].createdAt.format(constant('DATE_ATOM')) }}</span><span class="tag">&lt;/updated&gt;</span></li><li class="L8"><span class="pln">  </span><span class="tag">&lt;author&gt;&lt;name&gt;</span><span class="pln">Jobeet</span><span class="tag">&lt;/name&gt;&lt;/author&gt;</span></li><li class="L9"><span class="pln">  </span><span class="tag">&lt;id&gt;</span><span class="pln">{{ feedId }}</span><span class="tag">&lt;/id&gt;</span></li><li class="L0"><span class="pln"> </span></li><li class="L1"><span class="pln">  {% for entity in category.activejobs %}</span></li><li class="L2"><span class="pln">    </span><span class="tag">&lt;entry&gt;</span></li><li class="L3"><span class="pln">      </span><span class="tag">&lt;title&gt;</span><span class="pln">{{ entity.position }} ({{ entity.location }})</span><span class="tag">&lt;/title&gt;</span></li><li class="L4"><span class="pln">      </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ url('ens_job_show', { 'id': entity.id, 'company': entity.companyslug, 'location': entity.locationslug, 'position': entity.positionslug }) }}"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L5"><span class="pln">      </span><span class="tag">&lt;id&gt;</span><span class="pln">{{ entity.id }}</span><span class="tag">&lt;/id&gt;</span></li><li class="L6"><span class="pln">      </span><span class="tag">&lt;updated&gt;</span><span class="pln">{{ entity.createdAt.format(constant('DATE_ATOM')) }}</span><span class="tag">&lt;/updated&gt;</span></li><li class="L7"><span class="pln">      </span><span class="tag">&lt;summary</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"xhtml"</span><span class="tag">&gt;</span></li><li class="L8"><span class="pln">        </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://www.w3.org/1999/xhtml"</span><span class="tag">&gt;</span></li><li class="L9"><span class="pln">          {% if entity.logo %}</span></li><li class="L0"><span class="pln">            </span><span class="tag">&lt;div&gt;</span></li><li class="L1"><span class="pln">              </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ entity.url }}"</span><span class="tag">&gt;</span></li><li class="L2"><span class="pln">                </span><span class="tag">&lt;img</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"http://{{ app.request.host }}/uploads/jobs/{{ entity.logo }}"</span><span class="pln"> </span><span class="atn">alt</span><span class="pun">=</span><span class="atv">"{{ entity.company }} logo"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L3"><span class="pln">              </span><span class="tag">&lt;/a&gt;</span></li><li class="L4"><span class="pln">            </span><span class="tag">&lt;/div&gt;</span></li><li class="L5"><span class="pln">          {% endif %}</span></li><li class="L6"><span class="pln">          </span><span class="tag">&lt;div&gt;</span></li><li class="L7"><span class="pln">            {{ entity.description|nl2br }}</span></li><li class="L8"><span class="pln">          </span><span class="tag">&lt;/div&gt;</span></li><li class="L9"><span class="pln">          </span><span class="tag">&lt;h4&gt;</span><span class="pln">How to apply?</span><span class="tag">&lt;/h4&gt;</span></li><li class="L0"><span class="pln">          </span><span class="tag">&lt;p&gt;</span><span class="pln">{{ entity.howtoapply }}</span><span class="tag">&lt;/p&gt;</span></li><li class="L1"><span class="pln">        </span><span class="tag">&lt;/div&gt;</span></li><li class="L2"><span class="pln">      </span><span class="tag">&lt;/summary&gt;</span></li><li class="L3"><span class="pln">      </span><span class="tag">&lt;author&gt;&lt;name&gt;</span><span class="pln">{{ entity.company }}</span><span class="tag">&lt;/name&gt;&lt;/author&gt;</span></li><li class="L4"><span class="pln">    </span><span class="tag">&lt;/entry&gt;</span></li><li class="L5"><span class="pln">  {% endfor %}</span></li><li class="L6"><span class="tag">&lt;/feed&gt;</span></li></ol></pre>
<br>
<p class="clearfix noprint">
	<a href="securite.html" class="btn btn-success pull-left">Chapitre précédent</a>
    <a href="services-web.html" class="btn btn-success pull-right">Chapitre suivant</a>
</p>														<p class="link_source noprint"><a href="http://www.ens.ro/2012/08/17/symfony2-jobeet-day-14-feeds/" target="_blank">» Lire l'article original</a></p>
																					<br>
													</section>
					</div>
				</div>
				<hr />
				<footer>
					<p class="tcenter">Tutoriel original par <a href="http://www.ens.ro/2012/03/21/jobeet-tutorial-with-symfony2/" target="_blank">Dragos Holban</a> - Traduit par <a href="https://plus.google.com/109236735134093009460?rel=author" target="_blank">Jonathan Thuau</a> - Le tuto sur <a href="https://github.com/thujohn/Jobeet" target="_blank">github</a></p>
				</footer>
			</div>
		</div>
	</div>
<script src="assets/js/jquery-1.8.2.min.js"></script>
<script src="assets/js/bootstrap.js"></script>
<script src="assets/js/prettify.js"></script>
<script src="assets/js/lang-yaml.js"></script>
<script src="assets/js/shadowbox.js"></script>
<script type="text/javascript">
<!--
jQuery(document).ready(function(){
	Shadowbox.init();
	prettyPrint();
	jQuery('.bs-docs-sidenav').affix({
		offset: {
			top: 150,
			bottom: 270
		}
	});
	jQuery('a[href*=#]').click(function (e) {
		var hash = jQuery(this).attr('href');
		e.preventDefault();
		var dest = 0;
		if (jQuery(this.hash).offset().top > (jQuery(document).height() - jQuery(window).height())){
			dest = jQuery(document).height() - jQuery(window).height();
		}else{
			dest = jQuery(this.hash).offset().top;
		}
		jQuery('html,body').animate({scrollTop:dest}, 1000, 'swing');
	});
});
-->
</script>
</body>
</html>