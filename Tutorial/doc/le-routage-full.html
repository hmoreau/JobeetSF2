<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Tuto Jobeet Symfony2 FR :: Démarrage du projet</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link rel="stylesheet" type="text/css" href="assets/css/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="assets/css/bootstrap-responsive.css" />
<link rel="stylesheet" type="text/css" href="assets/css/style.css" />
<link rel="stylesheet" type="text/css" href="assets/css/docs.css" />
<link rel="stylesheet" type="text/css" href="assets/css/prettify.css" />
<link rel="stylesheet" type="text/css" href="assets/css/shadowbox.css" />
<link rel="stylesheet" type="text/css" href="assets/css/print.css" media="print" />
<link rel="shortcut icon" href="assets/img/favicon.ico">
<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

</head>

<body>
	<a href="https://github.com/thujohn/Jobeet" target="_blank" id="gogithub"><img src="assets/img/github.gif" alt="" /></a>
	<div class="navbar navbar-inverse hide-on-desktop show-on-tablets show-on-mobile noprint">
		<div class="navbar-inner noprint">
			<div class="container">
				<button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="brand" href="./">Jobeet FR</a>
				<div class="nav-collapse collapse">
					<ul class="nav">
						<li class="sommaire"><a href="sommaire.html"><i class="icon-chevron-right"></i>Sommaire</a></li><li class="demarrage-du-projet"><a href="demarrage-du-projet.html"><i class="icon-chevron-right"></i><strong>[01]</strong> Démarrage du projet</a></li><li class="le-projet"><a href="le-projet.html"><i class="icon-chevron-right"></i><strong>[02]</strong> Le projet</a></li><li class="le-modele-de-donnees"><a href="le-modele-de-donnees.html"><i class="icon-chevron-right"></i><strong>[03]</strong> Le Modèle de Données</a></li><li class="le-controleur-et-la-vue"><a href="le-controleur-et-la-vue.html"><i class="icon-chevron-right"></i><strong>[04]</strong> Le Contrôleur et la Vue</a></li><li class="active"><a href="le-routage.html"><i class="icon-chevron-right"></i><strong>[05]</strong> Le Routage</a></li><li class="aller-plus-loin-avec-le-modele"><a href="aller-plus-loin-avec-le-modele.html"><i class="icon-chevron-right"></i><strong>[06]</strong> Aller plus loin avec le Modèle</a></li><li class="jouons-avec-la-page-categorie"><a href="jouons-avec-la-page-categorie.html"><i class="icon-chevron-right"></i><strong>[07]</strong> Jouons avec les catégories</a></li><li class="les-tests-unitaires"><a href="les-tests-unitaires.html"><i class="icon-chevron-right"></i><strong>[08]</strong> Les tests unitaires</a></li><li class="les-tests-fonctionnels"><a href="les-tests-fonctionnels.html"><i class="icon-chevron-right"></i><strong>[09]</strong> Les tests fonctionnels</a></li><li class="les-formulaires"><a href="les-formulaires.html"><i class="icon-chevron-right"></i><strong>[10]</strong> Les formulaires</a></li><li class="testez-vos-formulaires"><a href="testez-vos-formulaires.html"><i class="icon-chevron-right"></i><strong>[11]</strong> Testez vos formulaires</a></li><li class="le-paquet-admin"><a href="le-paquet-admin.html"><i class="icon-chevron-right"></i><strong>[12]</strong> Le paquet Admin</a></li><li class="securite"><a href="securite.html"><i class="icon-chevron-right"></i><strong>[13]</strong> Sécurité</a></li><li class="flux-de-donnees"><a href="flux-de-donnees.html"><i class="icon-chevron-right"></i><strong>[14]</strong> Flux de données</a></li><li class="services-web"><a href="services-web.html"><i class="icon-chevron-right"></i><strong>[15]</strong> Services Web</a></li><li class="l-envoi-d-email"><a href="l-envoi-d-email.html"><i class="icon-chevron-right"></i><strong>[16]</strong> L'envoi d'email</a></li><li class="la-recherche"><a href="la-recherche.html"><i class="icon-chevron-right"></i><strong>[17]</strong> La recherche</a></li><li class="ajax"><a href="ajax.html"><i class="icon-chevron-right"></i><strong>[18]</strong> AJAX</a></li><li class="internationalisation-et-regionalisation"><a href="internationalisation-et-regionalisation.html"><i class="icon-chevron-right"></i><strong>[19]</strong> Internationalisation et régionalisation</a></li>
					</ul>
				</div>
			</div>
		</div>
	</div>
	<div id="container">
		<div id="bootstrap-docs">
			<header class="jumbotron subhead hide-on-tablets hide-on-mobile" id="overview">
				<div class="container">
					<h1><a href="./">Jobeet FR</a></h1>
					<p class="lead">Le tutoriel pour Symfony2 en français</p>
				</div>
			</header>
			<div class="container">
				<div class="row">
										<div class="span12">
											<section class="justify">
                                            <a href="le-routage.html" class="pull-right btn btn-success hide-on-tablets hide-on-mobile noprint">Vue normale</a><div class="page-header clearfix"><h1 class="pull-left">Le Routage</h1><div class="pull-left" id="gocomments"></div>
							<h2>URLs</h2>
<p>Si vous cliquez sur une offre sur la page d'accueil Jobeet, l'URL ressemble à ceci: <strong>/job/1/show</strong>. Si vous avez déjà développé des sites web PHP, vous êtes probablement plus habitués à des URL comme <strong>/job.php?id=1</strong>. Comment Symfony les fait fonctionner? Comment Symfony détermine l'action à appeler à partir de cette URL? Pourquoi l'id de l'offre est-il récupéré avec le paramètre <strong>$id</strong> dans l'action? Ici, nous allons répondre à toutes ces questions.</p>
<p>Vous avez déjà vu le code suivant dans le template <strong>src/Ens/JobeetBundle/Resources/views/job/index.html.twig</strong>:</p>
<pre>{{ path('ens_job_show', { 'id': entity.id }) }}</pre>
<p>Celui-ci utilise la fonction de l'helper template <strong>path</strong> pour générer l'url pour l'offre qui a l'id 1. <strong>ens_job_show</strong> est le nom de la route utilisée, définie dans la configuration comme vous le verrez ci-dessous.</p>
<br>
<h2>Configuration du routage</h2>
<p>Dans Symfony2, la configuration du routage se fait habituellement dans le fichier <strong>app/config/routing.yml</strong>. Ceci importe la configuration du routage d'un paquet spécifique. Dans notre cas, le fichier <strong>src/Ens/JobeetBundle/Resources/config/routing.yml</strong> est importé:</p>
<pre class="prettyprint linenums lang-yaml"><ol class="linenums"><li class="L0"><span class="com"># app/config/routing.yml</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="kwd">EnsJobeetBundle:</span></li><li class="L3"><span class="pln">    </span><span class="kwd">resource: </span><span class="str">"@EnsJobeetBundle/Resources/config/routing.yml"</span></li><li class="L4"><span class="pln">    </span><span class="kwd">prefix: </span><span class="pln">  /</span></li></ol></pre>
<p>Maintenant, si vous regardez dans le fichier <strong>routing.yml</strong> de <strong>JobeetBundle</strong> vous verrez qu'il importe un autre fichier de routage, celui pour le contrôleur <strong>Job</strong> et définit une route appelée <strong>EnsJobeetBundle_homepage</strong> pour le modèle d'URL <strong>/hello/{name}</strong>:</p>
<pre class="prettyprint linenums lang-yaml"><ol class="linenums"><li class="L0"><span class="com"># src/Ens/JobeetBundle/Resources/config/routing.yml</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="kwd">EnsJobeetBundle_job:</span></li><li class="L3"><span class="pln">    </span><span class="kwd">resource: </span><span class="str">"@EnsJobeetBundle/Resources/config/routing/job.yml"</span></li><li class="L4"><span class="pln">    </span><span class="kwd">prefix: </span><span class="pln">/job</span></li><li class="L5"><span class="pln"> </span></li><li class="L6"><span class="kwd">EnsJobeetBundle_homepage:</span></li><li class="L7"><span class="pln">    </span><span class="kwd">pattern: </span><span class="pln"> /hello/{name}</span></li><li class="L8"><span class="pln">    </span><span class="kwd">defaults: </span><span class="pln">{ </span><span class="kwd">_controller: </span><span class="pln">EnsJobeetBundle</span><span class="pun">:</span><span class="pln">Default</span><span class="pun">:</span><span class="pln">index }</span></li></ol></pre>
<pre class="prettyprint linenums lang-yaml"><ol class="linenums"><li class="L0"><span class="com"># src/Ens/JobeetBundle/Resources/config/routing/job.yml</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="kwd">ens_job:</span></li><li class="L3"><span class="pln">    </span><span class="kwd">pattern: </span><span class="pln"> /</span></li><li class="L4"><span class="pln">    </span><span class="kwd">defaults: </span><span class="pln">{ </span><span class="kwd">_controller: </span><span class="str">"EnsJobeetBundle:Job:index"</span><span class="pln"> }</span></li><li class="L5"><span class="pln"> </span></li><li class="L6"><span class="kwd">ens_job_show:</span></li><li class="L7"><span class="pln">    </span><span class="kwd">pattern: </span><span class="pln"> /{id}/show</span></li><li class="L8"><span class="pln">    </span><span class="kwd">defaults: </span><span class="pln">{ </span><span class="kwd">_controller: </span><span class="str">"EnsJobeetBundle:Job:show"</span><span class="pln"> }</span></li><li class="L9"><span class="pln"> </span></li><li class="L0"><span class="kwd">ens_job_new:</span></li><li class="L1"><span class="pln">    </span><span class="kwd">pattern: </span><span class="pln"> /new</span></li><li class="L2"><span class="pln">    </span><span class="kwd">defaults: </span><span class="pln">{ </span><span class="kwd">_controller: </span><span class="str">"EnsJobeetBundle:Job:new"</span><span class="pln"> }</span></li><li class="L3"><span class="pln"> </span></li><li class="L4"><span class="kwd">ens_job_create:</span></li><li class="L5"><span class="pln">    </span><span class="kwd">pattern: </span><span class="pln"> /create</span></li><li class="L6"><span class="pln">    </span><span class="kwd">defaults: </span><span class="pln">{ </span><span class="kwd">_controller: </span><span class="str">"EnsJobeetBundle:Job:create"</span><span class="pln"> }</span></li><li class="L7"><span class="pln">    </span><span class="kwd">requirements: </span><span class="pln">{ </span><span class="kwd">_method: </span><span class="pln">post }</span></li><li class="L8"><span class="pln"> </span></li><li class="L9"><span class="kwd">ens_job_edit:</span></li><li class="L0"><span class="pln">    </span><span class="kwd">pattern: </span><span class="pln"> /{id}/edit</span></li><li class="L1"><span class="pln">    </span><span class="kwd">defaults: </span><span class="pln">{ </span><span class="kwd">_controller: </span><span class="str">"EnsJobeetBundle:Job:edit"</span><span class="pln"> }</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="kwd">ens_job_update:</span></li><li class="L4"><span class="pln">    </span><span class="kwd">pattern: </span><span class="pln"> /{id}/update</span></li><li class="L5"><span class="pln">    </span><span class="kwd">defaults: </span><span class="pln">{ </span><span class="kwd">_controller: </span><span class="str">"EnsJobeetBundle:Job:update"</span><span class="pln"> }</span></li><li class="L6"><span class="pln">    </span><span class="kwd">requirements: </span><span class="pln">{ </span><span class="kwd">_method: </span><span class="pln">post }</span></li><li class="L7"><span class="pln"> </span></li><li class="L8"><span class="kwd">ens_job_delete:</span></li><li class="L9"><span class="pln">    </span><span class="kwd">pattern: </span><span class="pln"> /{id}/delete</span></li><li class="L0"><span class="pln">    </span><span class="kwd">defaults: </span><span class="pln">{ </span><span class="kwd">_controller: </span><span class="str">"EnsJobeetBundle:Job:delete"</span><span class="pln"> }</span></li><li class="L1"><span class="pln">    </span><span class="kwd">requirements: </span><span class="pln">{ </span><span class="kwd">_method: </span><span class="pln">post }</span></li></ol></pre>
<p>Voyons de plus près la route <strong>ens_job_show</strong>. Le modèle défini par <strong>ens_job_show</strong> agit comme <strong>/*/show</strong> où le joker est l'<strong>id</strong>. Pour l'URL <strong>/1/show</strong>, la variable <strong>id</strong> obtient une valeur de 1, qui est disponible pour vous permettre de l'utiliser dans votre contrôleur. Le paramètre <strong>_controller</strong> est une entrée spéciale qui dit à Symfony quel contrôleur/action doit être exécuté quand une URL correspond à cette route. Dans notre cas, il doit exécuter <strong>showAction</strong> de <strong>JobController</strong> dans <strong>EnsJobeetBundle</strong>.</p>
<p>Les paramètres de route (par exemple, <strong>{id}</strong>) sont particulièrement importants parce que chacun est mis à disposition en tant qu'argument à la méthode du contrôleur:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> showAction</span><span class="pun">(</span><span class="pln">$id</span><span class="pun">)</span></li><li class="L1"><span class="pun">{</span></li><li class="L2"><span class="pln">    </span><span class="com">// ...</span></li><li class="L3"><span class="pun">}</span></li></ol></pre>
<br>
<h2>Configuration du routage en environnement dev</h2>
<p>L'environnement de dev charge le fichier <strong>app/config/routing_dev.yml</strong> qui contient les routes utilisées par la <strong>Web Debug Toolbar</strong>, entre autres. Ce fichier charge, à la fin, le fichier de configuration principal <strong>routing.yml</strong>.</p>
<p>Si vous allez à <a href="http://jobeet.local/app_dev.php" target="_blank">http://jobeet.local/app_dev.php</a>, vous verrez la page par défaut de Symfony. Nous allons changer cela pour qu'à l'avenir l'environnement de dev affiche les mêmes pages que celui de production. Ouvrez votre <strong>app/config/routing_dev.yml</strong> et enlevez les 3 premières routes qui sont relatives au paquet de démonstration de Symfony. Maintenant, le fichier <strong>routing_dev.yml</strong> devrait ressembler à ceci:</p>
<pre class="prettyprint linenums lang-yaml"><ol class="linenums"><li class="L0"><span class="com"># app/config/routing_dev.yml</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="kwd">_assetic:</span></li><li class="L3"><span class="pln">    </span><span class="kwd">resource: </span><span class="pln">.</span></li><li class="L4"><span class="pln">    </span><span class="kwd">type: </span><span class="pln">    assetic</span></li><li class="L5"><span class="pln"> </span></li><li class="L6"><span class="kwd">_wdt:</span></li><li class="L7"><span class="pln">    </span><span class="kwd">resource: </span><span class="str">"@WebProfilerBundle/Resources/config/routing/wdt.xml"</span></li><li class="L8"><span class="pln">    </span><span class="kwd">prefix: </span><span class="pln">  /_wdt</span></li><li class="L9"><span class="pln"> </span></li><li class="L0"><span class="kwd">_profiler:</span></li><li class="L1"><span class="pln">    </span><span class="kwd">resource: </span><span class="str">"@WebProfilerBundle/Resources/config/routing/profiler.xml"</span></li><li class="L2"><span class="pln">    </span><span class="kwd">prefix: </span><span class="pln">  /_profiler</span></li><li class="L3"><span class="pln"> </span></li><li class="L4"><span class="kwd">_configurator:</span></li><li class="L5"><span class="pln">    </span><span class="kwd">resource: </span><span class="str">"@SensioDistributionBundle/Resources/config/routing/webconfigurator.xml"</span></li><li class="L6"><span class="pln">    </span><span class="kwd">prefix: </span><span class="pln">  /_configurator</span></li><li class="L7"><span class="pln"> </span></li><li class="L8"><span class="kwd">_main:</span></li><li class="L9"><span class="pln">    </span><span class="kwd">resource: </span><span class="pln">routing.yml</span></li></ol></pre>
<p>N'oubliez pas de vider le cache après cette modification.</p>
<pre>php app/console cache:clear --env=prod
php app/console cache:clear --env=dev
</pre>
<br>
<h2>Personnalisation des routes</h2>
<p>Pour l'instant, lorsque vous demandez l'URL <strong>/</strong> dans un navigateur, vous obtenez une erreur 404. C'est parce que cette URL ne correspond à aucune des routes définies. Nous avons une route <strong>EnsJobeetBundle_homepage</strong> qui correspond à l'URL <strong>/hello/jobeet</strong> et nous envoie à l'action <strong>index</strong> de <strong>DefaultController</strong>. Nous allons la changer pour correspondre à l'URL <strong>/</strong> et appeler l'action <strong>index</strong> de <strong>JobController</strong>. Pour faire le changement, modifiez comme ci-dessous:</p>
<pre class="prettyprint linenums lang-yaml"><ol class="linenums"><li class="L0"><span class="com"># src/Ens/JobeetBundle/Resources/config/routing.yml</span></li><li class="L1"><span class="com"># ...</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="kwd">EnsJobeetBundle_homepage:</span></li><li class="L4"><span class="pln">    </span><span class="kwd">pattern: </span><span class="pln"> /</span></li><li class="L5"><span class="pln">    </span><span class="kwd">defaults: </span><span class="pln">{ </span><span class="kwd">_controller: </span><span class="pln">EnsJobeetBundle</span><span class="pun">:</span><span class="pln">Job</span><span class="pun">:</span><span class="pln">index }</span></li></ol></pre>
<p>Maintenant, si vous effacez le cache et allez à <a href="http://jobeet.local" target="_blank">http://jobeet.local</a>, vous verrez la page d'accueil Job. Nous pouvons maintenant modifier le lien du logo Jobeet dans le layout pour utiliser la route <strong>EnsJobeetBundle_homepage</strong>:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">&lt;!-- src/Ens/JobeetBundle/Resources/views/layout.html.twig --&gt;</span></li><li class="L1"><span class="com">&lt;!-- ... --&gt;</span></li><li class="L2"><span class="tag">&lt;h1&gt;&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('EnsJobeetBundle_homepage') }}"</span><span class="tag">&gt;</span></li><li class="L3"><span class="pln">  </span><span class="tag">&lt;img</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"{{ asset('bundles/ensjobeet/images/logo.jpg') }}"</span><span class="pln"> </span><span class="atn">alt</span><span class="pun">=</span><span class="atv">"Jobeet Job Board"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L4"><span class="tag">&lt;/a&gt;&lt;/h1&gt;</span></li><li class="L5"><span class="com">&lt;!-- ... --&gt;</span></li></ol></pre>
<p>Pour quelque chose d'un peu plus compliqué, nous allons changer l'URL d'une offre avec quelque chose de plus significatif:</p>
<pre>/job/sensio-labs/paris-france/1/web-developer</pre>
<p>Sans rien savoir de Jobeet, et sans regarder la page, vous pouvez comprendre à partir de l'URL que Sensio Labs est à la recherche d'un Développeur Web pour travailler à Paris, France.</p>
<p>Le schéma ci-dessous correspond à une telle URL:</p>
<pre>/job/{company}/{location}/{id}/{position}</pre>
<p>Modifiez la route <strong>ens_job_show</strong> à partir du fichier <strong>job.yml</strong>:</p>
<pre class="prettyprint linenums lang-yaml"><ol class="linenums"><li class="L0"><span class="com"># src/Ens/JobeetBundle/Resources/config/routing/job.yml</span></li><li class="L1"><span class="com"># ...</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="kwd">ens_job_show:</span></li><li class="L4"><span class="pln">    </span><span class="kwd">pattern: </span><span class="pln"> /{company}/{location}/{id}/{position}</span></li><li class="L5"><span class="pln">    </span><span class="kwd">defaults: </span><span class="pln">{ </span><span class="kwd">_controller: </span><span class="str">"EnsJobeetBundle:Job:show"</span><span class="pln"> }</span></li></ol></pre>
<p>Maintenant, nous avons besoin de passer tous les paramètres de la route modifiée pour que cela fonctionne:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">&lt;!-- src/Ens/JobeetBundle/Resources/views/Job/index.html.twig --&gt;</span></li><li class="L1"><span class="com">&lt;!-- ... --&gt;</span></li><li class="L2"><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('ens_job_show', { 'id': entity.id, 'company': entity.company, 'location': entity.location, 'position': entity.position }) }}"</span><span class="tag">&gt;</span></li><li class="L3"><span class="pln">  {{ entity.position }}</span></li><li class="L4"><span class="tag">&lt;/a&gt;</span></li><li class="L5"><span class="com">&lt;!-- ... --&gt;</span></li></ol></pre>
<p>Si vous regardez les URLs générées, elles ne sont pas encore tout à fait comme nous voulons qu'elles soient:</p>
<pre>http://jobeet.local/job/Sensio Labs/Paris, France/1/Web Developer</pre>
<p>Nous avons besoin de "remodeler" les valeurs de chaque colonne en remplaçant tous les caractères non ASCII par un tiret (-). Ouvrez le fichier <strong>Job.php</strong> et ajoutez les méthodes suivantes à la classe:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">// src/Ens/JobeetBundle/Entity/Job.php</span></li><li class="L1"><span class="com">// ...</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="kwd">use</span><span class="pln"> </span><span class="typ">Ens</span><span class="pln">\JobeetBundle\Utils\Jobeet </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">Jobeet</span><span class="pun">;</span></li><li class="L4"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Job</span></li><li class="L5"><span class="pun">{</span></li><li class="L6"><span class="pln">    </span><span class="com">// ...</span></li><li class="L7"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> getCompanySlug</span><span class="pun">()</span></li><li class="L8"><span class="pln">    </span><span class="pun">{</span></li><li class="L9"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Jobeet</span><span class="pun">::</span><span class="pln">slugify</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">getCompany</span><span class="pun">());</span></li><li class="L0"><span class="pln">    </span><span class="pun">}</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> getPositionSlug</span><span class="pun">()</span></li><li class="L3"><span class="pln">    </span><span class="pun">{</span></li><li class="L4"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Jobeet</span><span class="pun">::</span><span class="pln">slugify</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">getPosition</span><span class="pun">());</span></li><li class="L5"><span class="pln">    </span><span class="pun">}</span></li><li class="L6"><span class="pln"> </span></li><li class="L7"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> getLocationSlug</span><span class="pun">()</span></li><li class="L8"><span class="pln">    </span><span class="pun">{</span></li><li class="L9"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Jobeet</span><span class="pun">::</span><span class="pln">slugify</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">getLocation</span><span class="pun">());</span></li><li class="L0"><span class="pln">    </span><span class="pun">}</span></li><li class="L1"><span class="pun">}</span></li></ol></pre>
<p>Ensuite, créez le fichier <strong>src/Ens/JobeetBundle/Utils/Jobeet.php</strong> et ajoutez la méthode <strong>slugify()</strong>:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">// src/Ens/JobeetBundle/Utils/Jobeet.php</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="kwd">namespace</span><span class="pln"> </span><span class="typ">Ens</span><span class="pln">\JobeetBundle\Utils</span><span class="pun">;</span></li><li class="L3"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Jobeet</span></li><li class="L4"><span class="pun">{</span></li><li class="L5"><span class="pln">    </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> slugify</span><span class="pun">(</span><span class="pln">$text</span><span class="pun">)</span></li><li class="L6"><span class="pln">    </span><span class="pun">{</span></li><li class="L7"><span class="pln">        </span><span class="com">// replace all non letters or digits by -</span></li><li class="L8"><span class="pln">        $text </span><span class="pun">=</span><span class="pln"> preg_replace</span><span class="pun">(</span><span class="str">'/\W+/'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'-'</span><span class="pun">,</span><span class="pln"> $text</span><span class="pun">);</span></li><li class="L9"><span class="pln"> </span></li><li class="L0"><span class="pln">        </span><span class="com">// trim and lowercase</span></li><li class="L1"><span class="pln">        $text </span><span class="pun">=</span><span class="pln"> strtolower</span><span class="pun">(</span><span class="pln">trim</span><span class="pun">(</span><span class="pln">$text</span><span class="pun">,</span><span class="pln"> </span><span class="str">'-'</span><span class="pun">));</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> $text</span><span class="pun">;</span></li><li class="L4"><span class="pln">    </span><span class="pun">}</span></li><li class="L5"><span class="pun">}</span></li></ol></pre>
<p>Nous avons défini trois nouveaux <a href="http://fr.wikipedia.org/wiki/M%C3%A9thode_(informatique)" target="_blank">accesseurs</a> "virtuels": <strong>getCompanySlug()</strong>, <strong>getPositionSlug()</strong>, et <strong>getLocationSlug()</strong>. Ils retournent la valeur correspondant à leur colonne après avoir appliqué la méthode <strong>slugify()</strong>. Maintenant, vous pouvez remplacer les noms réels des colonnes par les virtuels dans le modèle:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">&lt;!-- src/Ens/JobeetBundle/Resources/views/Job/index.html.twig --&gt;</span></li><li class="L1"><span class="com">&lt;!-- ... --&gt;</span></li><li class="L2"><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('ens_job_show', { 'id': entity.id, 'company': entity.companySlug, 'location': entity.locationSlug, 'position': entity.positionSlug}) }}"</span><span class="tag">&gt;</span></li><li class="L3"><span class="pln">  {{ entity.position }}</span></li><li class="L4"><span class="tag">&lt;/a&gt;</span></li><li class="L5"><span class="com">&lt;!-- ... --&gt;</span></li></ol></pre>
<p>Vous aurez maintenant l'URL attendue:</p>
<pre>http://jobeet.local/app_dev.php/job/sensio-labs/paris-france/1/web-developer</pre>
<br>
<h2>Les conditions dans les routes</h2>
<p>Le système de routage a une fonction de validation intégrée. Chaque modèle de variable peut être validé par une expression régulière définie en utilisant l'entrée <strong>requirements</strong> d'une définition de route:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com"># src/Ens/JobeetBundle/Resources/config/routing/job.yml</span></li><li class="L1"><span class="com"># ...</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pln">ens_job_show</span><span class="pun">:</span></li><li class="L4"><span class="pln">    pattern</span><span class="pun">:</span><span class="pln">  </span><span class="str">/{company}/</span><span class="pun">{</span><span class="pln">location</span><span class="pun">}/{</span><span class="pln">id</span><span class="pun">}/{</span><span class="pln">position</span><span class="pun">}</span></li><li class="L5"><span class="pln">    defaults</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> _controller</span><span class="pun">:</span><span class="pln"> </span><span class="str">"EnsJobeetBundle:Job:show"</span><span class="pln"> </span><span class="pun">}</span></li><li class="L6"><span class="pln">    requirements</span><span class="pun">:</span></li><li class="L7"><span class="pln">        id</span><span class="pun">:</span><span class="pln">  \d</span><span class="pun">+</span></li></ol></pre>
<p>L'entrée <strong>requirements</strong> ci-dessus oblige l'<strong>id</strong> à être une valeur numérique. Sinon, la route ne fonctionne pas.</p>
<br>
<h2>Débugage des routes</h2>
<p>Bien que l'ajout et la personnalisation de routes soit parlant, il est utile de pouvoir visualiser et obtenir des informations détaillées sur vos routes. Un excellent moyen de voir toutes les routes dans votre application se fait via la commande <strong>router:debug</strong>. Exécutez la commande en la lançant à partir de la racine de votre projet:</p>
<pre>php app/console router:debug</pre>
<p>La commande permet d'afficher une liste utile de toutes les routes configurées dans votre application. Vous pouvez également obtenir des renseignements très précis sur une seul route en incluant le nom de la route après la commande:</p>
<pre>php app/console router:debug ens_job_show</pre>
<br>
<h2>Réflexions finales</h2>
<p>Pour en savoir plus sur le système de routage Symfony2, lisez le chapitre <a href="http://symfony.com/doc/current/book/routing.html" target="_blank">Routing</a> de la documentation officielle.</p>
<br>
<p class="clearfix noprint">
	<a href="le-controleur-et-la-vue.html" class="btn btn-success pull-left">Chapitre précédent</a>
	<a href="aller-plus-loin-avec-le-modele.html" class="btn btn-success pull-right">Chapitre suivant</a>
</p>														<p class="link_source noprint"><a href="http://www.ens.ro/2012/04/03/symfony2-jobeet-day-5-the-routing/" target="_blank">» Lire l'article original</a></p>
																					<br>
													</section>
					</div>
				</div>
				<hr />
				<footer>
					<p class="tcenter">Tutoriel original par <a href="http://www.ens.ro/2012/03/21/jobeet-tutorial-with-symfony2/" target="_blank">Dragos Holban</a> - Traduit par <a href="https://plus.google.com/109236735134093009460?rel=author" target="_blank">Jonathan Thuau</a> - Le tuto sur <a href="https://github.com/thujohn/Jobeet" target="_blank">github</a></p>
				</footer>
			</div>
		</div>
	</div>
<script src="assets/js/jquery-1.8.2.min.js"></script>
<script src="assets/js/bootstrap.js"></script>
<script src="assets/js/prettify.js"></script>
<script src="assets/js/lang-yaml.js"></script>
<script src="assets/js/shadowbox.js"></script>
<script type="text/javascript">
<!--
jQuery(document).ready(function(){
	Shadowbox.init();
	prettyPrint();
	jQuery('.bs-docs-sidenav').affix({
		offset: {
			top: 150,
			bottom: 270
		}
	});
	jQuery('a[href*=#]').click(function (e) {
		var hash = jQuery(this).attr('href');
		e.preventDefault();
		var dest = 0;
		if (jQuery(this.hash).offset().top > (jQuery(document).height() - jQuery(window).height())){
			dest = jQuery(document).height() - jQuery(window).height();
		}else{
			dest = jQuery(this.hash).offset().top;
		}
		jQuery('html,body').animate({scrollTop:dest}, 1000, 'swing');
	});
});
-->
</script>
</body>
</html>