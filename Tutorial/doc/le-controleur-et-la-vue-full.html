<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Tuto Jobeet Symfony2 FR :: Démarrage du projet</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link rel="stylesheet" type="text/css" href="assets/css/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="assets/css/bootstrap-responsive.css" />
<link rel="stylesheet" type="text/css" href="assets/css/style.css" />
<link rel="stylesheet" type="text/css" href="assets/css/docs.css" />
<link rel="stylesheet" type="text/css" href="assets/css/prettify.css" />
<link rel="stylesheet" type="text/css" href="assets/css/shadowbox.css" />
<link rel="stylesheet" type="text/css" href="assets/css/print.css" media="print" />
<link rel="shortcut icon" href="assets/img/favicon.ico">
<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

</head>

<body>
	<!--<a href="https://github.com/thujohn/Jobeet" target="_blank" id="gogithub"><img src="assets/img/github.gif" alt="" /></a>-->
	<div class="navbar navbar-inverse hide-on-desktop show-on-tablets show-on-mobile noprint">
		<div class="navbar-inner noprint">
			<div class="container">
				<button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="brand" href="./">Jobeet FR</a>
				<div class="nav-collapse collapse">
					<ul class="nav">
						<li class="sommaire"><a href="sommaire.html"><i class="icon-chevron-right"></i>Sommaire</a></li><li class="demarrage-du-projet"><a href="demarrage-du-projet.html"><i class="icon-chevron-right"></i><strong>[01]</strong> Démarrage du projet</a></li><li class="le-projet"><a href="le-projet.html"><i class="icon-chevron-right"></i><strong>[02]</strong> Le projet</a></li><li class="le-modele-de-donnees"><a href="le-modele-de-donnees.html"><i class="icon-chevron-right"></i><strong>[03]</strong> Le Modèle de Données</a></li><li class="active"><a href="le-controleur-et-la-vue.html"><i class="icon-chevron-right"></i><strong>[04]</strong> Le Contrôleur et la Vue</a></li><li class="le-routage"><a href="le-routage.html"><i class="icon-chevron-right"></i><strong>[05]</strong> Le Routage</a></li><li class="aller-plus-loin-avec-le-modele"><a href="aller-plus-loin-avec-le-modele.html"><i class="icon-chevron-right"></i><strong>[06]</strong> Aller plus loin avec le Modèle</a></li><li class="jouons-avec-la-page-categorie"><a href="jouons-avec-la-page-categorie.html"><i class="icon-chevron-right"></i><strong>[07]</strong> Jouons avec les catégories</a></li><li class="les-tests-unitaires"><a href="les-tests-unitaires.html"><i class="icon-chevron-right"></i><strong>[08]</strong> Les tests unitaires</a></li><li class="les-tests-fonctionnels"><a href="les-tests-fonctionnels.html"><i class="icon-chevron-right"></i><strong>[09]</strong> Les tests fonctionnels</a></li><li class="les-formulaires"><a href="les-formulaires.html"><i class="icon-chevron-right"></i><strong>[10]</strong> Les formulaires</a></li><li class="testez-vos-formulaires"><a href="testez-vos-formulaires.html"><i class="icon-chevron-right"></i><strong>[11]</strong> Testez vos formulaires</a></li><li class="le-paquet-admin"><a href="le-paquet-admin.html"><i class="icon-chevron-right"></i><strong>[12]</strong> Le paquet Admin</a></li><li class="securite"><a href="securite.html"><i class="icon-chevron-right"></i><strong>[13]</strong> Sécurité</a></li><li class="flux-de-donnees"><a href="flux-de-donnees.html"><i class="icon-chevron-right"></i><strong>[14]</strong> Flux de données</a></li>
					</ul>
				</div>
			</div>
		</div>
	</div>
	<div id="container">
		<div id="bootstrap-docs">
			<header class="jumbotron subhead hide-on-tablets hide-on-mobile" id="overview">
				<div class="container">
					<h1><a href="./">Jobeet FR</a></h1>
					<p class="lead">Le tutoriel pour Symfony2 en français</p>
				</div>
			</header>
			<div class="container">
				<div class="row">
										<div class="span12">
											<section class="justify">
                                            <a href="le-controleur-et-la-vue.html" class="pull-right btn btn-success hide-on-tablets hide-on-mobile noprint">Vue normale</a>																					<div class="page-header clearfix"><h1 class="pull-left">Le Contrôleur et la Vue</h1></div>
							<p>Dans ce chapitre, nous allons personnaliser le contrôleur <strong>Job</strong> que nous avons créé. Il possède déjà la plupart du code nous avons besoin pour Jobeet:</p>
<ul class="unstyled">
	<li>- Une page pour <strong>lister</strong> toutes les offres</li>
	<li>- Une page pour <strong>créer</strong> une nouvelle offre</li>
	<li>- Une page pour <strong>mettre à jour</strong> une offre existante</li>
	<li>- Une page pour <strong>supprimer</strong> une offre</li>
</ul>
<p>Bien que le code soit prêt à être utilisé tel quel, nous devons modifier les modèles pour correspondre à notre maquette Jobeet.</p>
<br>
<h2>L'architecture MVC (Modèle Vue Contrôleur)</h2>
<p>Pour le développement web, la solution la plus courante pour organiser le code de nos jours est le <a href="http://fr.wikipedia.org/wiki/Mod%C3%A8le-Vue-Contr%C3%B4leur" target="_blank">modèle de conception MVC</a>. En bref, le modèle de conception MVC définit un moyen d'organiser votre code en fonction de sa nature. Ce modèle sépare le code en <strong>trois couches</strong>:</p>
<ul class="unstyled">
	<li>- La couche Modèle (<strong>Model</strong>) définit la logique métier (la BDD appartenant à cette couche). Vous savez déjà que Symfony2 stocke toutes les classes et les fichiers relatifs au modèle dans le répertoire de vos paquets <strong>Entity/</strong>.</li>
	<li>- La Vue (<strong>View</strong>) est ce avec quoi l'utilisateur interagit (un moteur de template fait partie de cette couche). Dans Symfony2, la couche Vue est principalement faite de templates <a href="http://twig.sensiolabs.org/" target="_blank">Twig</a>. Ils sont stockés dans plusieurs répertoires <strong>Resources/views/</strong> comme nous le verrons plus loin.</li>
	<li>- Le Contrôleur (<strong>Controller</strong>) est un morceau de code qui appelle le modèle pour obtenir certaines données qu'il passe à la Vue pour le rendre au Client. Lorsque nous avons installé Symfony au début de ce tutoriel, nous avons vu que toutes les demandes sont gérées par des contrôleurs frontaux (<strong>app.php</strong> et <strong>app_dev.php</strong>). Ces contrôleurs frontaux délèguent le réel travail à des <strong>actions</strong>.</li>
</ul>
<br>
<h2>La mise en page</h2>
<p>Si vous regardez de plus près la maquette, vous remarquerez que beaucoup de pages se ressemblent. Vous savez déjà que la duplication de code est mauvais, si nous parlons de code HTML ou PHP, nous avons donc besoin de trouver un moyen d'empêcher ces éléments communs de se dupliquer.</p>
<p>Une façon de résoudre le problème est de définir une en-tête et un pied de page et de les inclure dans chaque modèle. Une meilleure solution est d'utiliser un autre modèle pour résoudre ce problème: le <a href="http://fr.wikipedia.org/wiki/D%C3%A9corateur_(patron_de_conception)" target="_blank">modèle décorateur</a>. Le modèle décorateur résout le problème dans l'autre sens: le template est décoré après que le contenu soit rendu par un template global, appelé <strong>layout</strong>.</p>
<p>Contrairement à Symfony 1.x, Symfony2 n'a pas de layout par défaut, mais nous allons en créer un et l'utiliser pour décorer nos pages d'application.</p>
<p>Créez un nouveau fichier <strong>layout.html.twig</strong> dans le répertoire <strong>src/Ens/JobeetBundle/Resources/views/</strong> et ajoutez le code suivant:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="dec">&lt;!DOCTYPE html&gt;</span></li><li class="L1"><span class="tag">&lt;html&gt;</span></li><li class="L2"><span class="pln">  </span><span class="tag">&lt;head&gt;</span></li><li class="L3"><span class="pln">    </span><span class="tag">&lt;title&gt;</span></li><li class="L4"><span class="pln">      {% block title %}</span></li><li class="L5"><span class="pln">        Jobeet - Your best job board</span></li><li class="L6"><span class="pln">      {% endblock %}</span></li><li class="L7"><span class="pln">    </span><span class="tag">&lt;/title&gt;</span></li><li class="L8"><span class="pln">    </span><span class="tag">&lt;meta</span><span class="pln"> </span><span class="atn">http-equiv</span><span class="pun">=</span><span class="atv">"Content-Type"</span><span class="pln"> </span><span class="atn">content</span><span class="pun">=</span><span class="atv">"text/html; charset=utf-8"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L9"><span class="pln">    {% block stylesheets %}</span></li><li class="L0"><span class="pln">      </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"stylesheet"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ asset('bundles/ensjobeet/css/main.css') }}"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text/css"</span><span class="pln"> </span><span class="atn">media</span><span class="pun">=</span><span class="atv">"all"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L1"><span class="pln">    {% endblock %}</span></li><li class="L2"><span class="pln">    {% block javascripts %}</span></li><li class="L3"><span class="pln">    {% endblock %}</span></li><li class="L4"><span class="pln">    </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"shortcut icon"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ asset('bundles/ensjobeet/images/favicon.ico') }}"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L5"><span class="pln">  </span><span class="tag">&lt;/head&gt;</span></li><li class="L6"><span class="pln">  </span><span class="tag">&lt;body&gt;</span></li><li class="L7"><span class="pln">    </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"container"</span><span class="tag">&gt;</span></li><li class="L8"><span class="pln">      </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"header"</span><span class="tag">&gt;</span></li><li class="L9"><span class="pln">        </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"content"</span><span class="tag">&gt;</span></li><li class="L0"><span class="pln">          </span><span class="tag">&lt;h1&gt;&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('ens_job') }}"</span><span class="tag">&gt;</span></li><li class="L1"><span class="pln">            </span><span class="tag">&lt;img</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"{{ asset('bundles/ensjobeet/images/logo.jpg') }}"</span><span class="pln"> </span><span class="atn">alt</span><span class="pun">=</span><span class="atv">"Jobeet Job Board"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L2"><span class="pln">          </span><span class="tag">&lt;/a&gt;&lt;/h1&gt;</span></li><li class="L3"><span class="pln"> </span></li><li class="L4"><span class="pln">          </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"sub_header"</span><span class="tag">&gt;</span></li><li class="L5"><span class="pln">            </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"post"</span><span class="tag">&gt;</span></li><li class="L6"><span class="pln">              </span><span class="tag">&lt;h2&gt;</span><span class="pln">Ask for people</span><span class="tag">&lt;/h2&gt;</span></li><li class="L7"><span class="pln">              </span><span class="tag">&lt;div&gt;</span></li><li class="L8"><span class="pln">                </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('ens_job') }}"</span><span class="tag">&gt;</span><span class="pln">Post a Job</span><span class="tag">&lt;/a&gt;</span></li><li class="L9"><span class="pln">              </span><span class="tag">&lt;/div&gt;</span></li><li class="L0"><span class="pln">            </span><span class="tag">&lt;/div&gt;</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="pln">            </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"search"</span><span class="tag">&gt;</span></li><li class="L3"><span class="pln">              </span><span class="tag">&lt;h2&gt;</span><span class="pln">Ask for a job</span><span class="tag">&lt;/h2&gt;</span></li><li class="L4"><span class="pln">              </span><span class="tag">&lt;form</span><span class="pln"> </span><span class="atn">action</span><span class="pun">=</span><span class="atv">""</span><span class="pln"> </span><span class="atn">method</span><span class="pun">=</span><span class="atv">"get"</span><span class="tag">&gt;</span></li><li class="L5"><span class="pln">                </span><span class="tag">&lt;input</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text"</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"keywords"</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"search_keywords"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L6"><span class="pln">                </span><span class="tag">&lt;input</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"submit"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"search"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L7"><span class="pln">                </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"help"</span><span class="tag">&gt;</span></li><li class="L8"><span class="pln">                  Enter some keywords (city, country, position, ...)</span></li><li class="L9"><span class="pln">                </span><span class="tag">&lt;/div&gt;</span></li><li class="L0"><span class="pln">              </span><span class="tag">&lt;/form&gt;</span></li><li class="L1"><span class="pln">            </span><span class="tag">&lt;/div&gt;</span></li><li class="L2"><span class="pln">          </span><span class="tag">&lt;/div&gt;</span></li><li class="L3"><span class="pln">        </span><span class="tag">&lt;/div&gt;</span></li><li class="L4"><span class="pln">      </span><span class="tag">&lt;/div&gt;</span></li><li class="L5"><span class="pln"> </span></li><li class="L6"><span class="pln">      </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"content"</span><span class="tag">&gt;</span></li><li class="L7"><span class="pln">        {% if app.session.hasFlash('notice') %}</span></li><li class="L8"><span class="pln">          </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"flash_notice"</span><span class="tag">&gt;</span></li><li class="L9"><span class="pln">            {{ app.session.flash('notice') }}</span></li><li class="L0"><span class="pln">          </span><span class="tag">&lt;/div&gt;</span></li><li class="L1"><span class="pln">        {% endif %}</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pln">        {% if app.session.hasFlash('error') %}</span></li><li class="L4"><span class="pln">          </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"flash_error"</span><span class="tag">&gt;</span></li><li class="L5"><span class="pln">            {{ app.session.flash('error') }}</span></li><li class="L6"><span class="pln">          </span><span class="tag">&lt;/div&gt;</span></li><li class="L7"><span class="pln">        {% endif %}</span></li><li class="L8"><span class="pln"> </span></li><li class="L9"><span class="pln">        </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"content"</span><span class="tag">&gt;</span></li><li class="L0"><span class="pln">            {% block content %}</span></li><li class="L1"><span class="pln">            {% endblock %}</span></li><li class="L2"><span class="pln">        </span><span class="tag">&lt;/div&gt;</span></li><li class="L3"><span class="pln">      </span><span class="tag">&lt;/div&gt;</span></li><li class="L4"><span class="pln"> </span></li><li class="L5"><span class="pln">      </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"footer"</span><span class="tag">&gt;</span></li><li class="L6"><span class="pln">        </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"content"</span><span class="tag">&gt;</span></li><li class="L7"><span class="pln">          </span><span class="tag">&lt;span</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"symfony"</span><span class="tag">&gt;</span></li><li class="L8"><span class="pln">            </span><span class="tag">&lt;img</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"{{ asset('bundles/ensjobeet/images/jobeet-mini.png') }}"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L9"><span class="pln">            powered by </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"http://www.symfony.com/"</span><span class="tag">&gt;</span></li><li class="L0"><span class="pln">              </span><span class="tag">&lt;img</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"{{ asset('bundles/ensjobeet/images/symfony.gif') }}"</span><span class="pln"> </span><span class="atn">alt</span><span class="pun">=</span><span class="atv">"symfony framework"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L1"><span class="pln">            </span><span class="tag">&lt;/a&gt;</span></li><li class="L2"><span class="pln">          </span><span class="tag">&lt;/span&gt;</span></li><li class="L3"><span class="pln">          </span><span class="tag">&lt;ul&gt;</span></li><li class="L4"><span class="pln">            </span><span class="tag">&lt;li&gt;&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">""</span><span class="tag">&gt;</span><span class="pln">About Jobeet</span><span class="tag">&lt;/a&gt;&lt;/li&gt;</span></li><li class="L5"><span class="pln">            </span><span class="tag">&lt;li</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"feed"</span><span class="tag">&gt;&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">""</span><span class="tag">&gt;</span><span class="pln">Full feed</span><span class="tag">&lt;/a&gt;&lt;/li&gt;</span></li><li class="L6"><span class="pln">            </span><span class="tag">&lt;li&gt;&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">""</span><span class="tag">&gt;</span><span class="pln">Jobeet API</span><span class="tag">&lt;/a&gt;&lt;/li&gt;</span></li><li class="L7"><span class="pln">            </span><span class="tag">&lt;li</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"last"</span><span class="tag">&gt;&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">""</span><span class="tag">&gt;</span><span class="pln">Affiliates</span><span class="tag">&lt;/a&gt;&lt;/li&gt;</span></li><li class="L8"><span class="pln">          </span><span class="tag">&lt;/ul&gt;</span></li><li class="L9"><span class="pln">        </span><span class="tag">&lt;/div&gt;</span></li><li class="L0"><span class="pln">      </span><span class="tag">&lt;/div&gt;</span></li><li class="L1"><span class="pln">    </span><span class="tag">&lt;/div&gt;</span></li><li class="L2"><span class="pln">  </span><span class="tag">&lt;/body&gt;</span></li><li class="L3"><span class="tag">&lt;/html&gt;</span></li></ol></pre>
<br>
<h2>Blocs Twig</h2>
<p>Avec Twig, le moteur de template par défaut de Symfony2, vous pouvez définir des <strong>blocs</strong> comme nous l'avons fait ci-dessus. Un bloc Twig peut avoir un contenu par défaut (voir le bloc de titre par exemple) qui peut être remplacé ou étendu dans le template enfant comme vous le verrez dans un instant.</p>
<p>Maintenant, pour faire usage du nouveau layout que nous avons créé, nous avons besoin de modifier tous les modèles d'offres (edit, index, new et show à partir de <strong>src/Ens/JobeetBundle/Resources/views/job/</strong>) afin d'étendre le template parent (layout) et pour remplacer le <strong>bloc de contenu</strong>, nous avons défini:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="pun">{%</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="str">'EnsJobeetBundle::layout.html.twig'</span><span class="pln"> </span><span class="pun">%}</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="pun">{%</span><span class="pln"> block content </span><span class="pun">%}</span></li><li class="L3"><span class="pln">  </span><span class="pun">&lt;!--</span><span class="pln"> original </span><span class="kwd">template</span><span class="pln"> code goes here </span><span class="pun">--&gt;</span></li><li class="L4"><span class="pun">{%</span><span class="pln"> endblock </span><span class="pun">%}</span></li></ol></pre>
<br>
<h2>Les feuilles de style, images, et javascripts</h2>
<p>Comme ce tutoriel n'est pas sur le webdesign, nous avons déjà préparé toutes les ressources que nous utiliserons pour Jobeet: <a href="download/jobeet-images.zip">téléchargez l'archive des images</a> et mettez-les dans le répertoire <strong>src/Ens/JobeetBundle/Resources/public/images/</strong> ; <a href="download/jobeet-css.zip">téléchargez l'archive des feuilles de style</a> et mettez-les dans le répertoire <strong>src/Ens/JobeetBundle/Resources/public/css/</strong>.</p>
<p>Maintenant, exécutez la commande <strong>php app/console assets:install web</strong> pour dire à Symfony de les rendre accessibles au public.</p>
<p>Si vous regardez dans le dossier <strong>css</strong>, vous remarquerez que nous avons 4 fichiers css: <strong>admin.css</strong>, <strong>job.css</strong>, <strong>jobs.css</strong> et <strong>main.css</strong>. Le <strong>main.css</strong> est nécessaire dans toutes les pages Jobeet que nous avons inclus dans le layout, dans <strong>le bloc Twig des feuilles de style</strong>. Les autres fichiers css sont plus spécifiques et nous n'en n'avons besoin que dans certaines pages.</p>
<p>Pour ajouter un nouveau fichier CSS dans un template nous allons remplacer le bloc de feuilles de style, mais appeler le parent avant d'ajouter le nouveau fichier CSS (afin que nous ayons le fichier main.css et les fichiers CSS supplémentaires dont nous avons besoin).</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">&lt;!-- src/Ens/JobeetBundle/Resources/views/Job/index.html.twig --&gt;</span></li><li class="L1"><span class="pln">{% extends 'EnsJobeetBundle::layout.html.twig' %}</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pln">{% block stylesheets %}</span></li><li class="L4"><span class="pln">  {{ parent() }}</span></li><li class="L5"><span class="pln">  </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"stylesheet"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ asset('bundles/ensjobeet/css/jobs.css') }}"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text/css"</span><span class="pln"> </span><span class="atn">media</span><span class="pun">=</span><span class="atv">"all"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L6"><span class="pln">{% endblock %}</span></li><li class="L7"><span class="pln"> </span></li><li class="L8"><span class="com">&lt;!-- the rest of the code --&gt;</span></li></ol></pre>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">&lt;!-- src/Ens/JobeetBundle/Resources/views/Job/show.html.twig --&gt;</span></li><li class="L1"><span class="pln">{% extends 'EnsJobeetBundle::layout.html.twig' %}</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pln">{% block stylesheets %}</span></li><li class="L4"><span class="pln">  {{ parent() }}</span></li><li class="L5"><span class="pln">  </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"stylesheet"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ asset('bundles/ensjobeet/css/job.css') }}"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text/css"</span><span class="pln"> </span><span class="atn">media</span><span class="pun">=</span><span class="atv">"all"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L6"><span class="pln">{% endblock %}</span></li><li class="L7"><span class="pln"> </span></li><li class="L8"><span class="com">&lt;!-- the rest of the code --&gt;</span></li></ol></pre>
<br>
<h2>L'action de la page d'accueil des offres</h2>
<p>Chaque action est représentée par une méthode d'une classe. Pour la page d'accueil des offres, la classe est <strong>JobController</strong> et la méthode est <strong>indexAction()</strong>. Elle récupère toutes les offres d'emploi de la BDD:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> indexAction</span><span class="pun">()</span></li><li class="L1"><span class="pun">{</span></li><li class="L2"><span class="pln">    $em </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">getDoctrine</span><span class="pun">()-&gt;</span><span class="pln">getEntityManager</span><span class="pun">();</span></li><li class="L3"><span class="pln"> </span></li><li class="L4"><span class="pln">    $entities </span><span class="pun">=</span><span class="pln"> $em</span><span class="pun">-&gt;</span><span class="pln">getRepository</span><span class="pun">(</span><span class="str">'EnsJobeetBundle:Job'</span><span class="pun">)-&gt;</span><span class="pln">findAll</span><span class="pun">();</span></li><li class="L5"><span class="pln"> </span></li><li class="L6"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">render</span><span class="pun">(</span><span class="str">'EnsJobeetBundle:Job:index.html.twig'</span><span class="pun">,</span><span class="pln"> array</span><span class="pun">(</span></li><li class="L7"><span class="pln">        </span><span class="str">'entities'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> $entities</span></li><li class="L8"><span class="pln">    </span><span class="pun">));</span></li><li class="L9"><span class="pun">}</span></li></ol></pre>
<p>Nous allons examiner de plus près le code: la méthode <strong>indexAction()</strong> obtient l'<strong>objet de gestion de l'entité Doctrine</strong>, qui est responsable de la gestion du processus de la persistance et de la recherche des objets vers et à partir de la BDD, et puis le <strong>dépôt</strong>, qui permettra de créer une requête pour récupérer toutes les offres. Elle renvoie un Doctrine ArrayCollection d'objets <strong>Job</strong> qui sont passés au template (la Vue).</p>
<br>
<h2>Le template de la page d'accueil des offres</h2>
<p>Le template <strong>index.html.twig</strong> génère un tableau HTML pour toutes les offres. Voici le code du template actuel:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">&lt;!-- src/Ens/JobeetBundle/Resources/views/Job/index.html.twig --&gt;</span></li><li class="L1"><span class="pln">{% extends 'EnsJobeetBundle::layout.html.twig' %}</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pln">{% block stylesheets %}</span></li><li class="L4"><span class="pln">  {{ parent() }}</span></li><li class="L5"><span class="pln">  </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"stylesheet"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ asset('bundles/ensjobeet/css/jobs.css') }}"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text/css"</span><span class="pln"> </span><span class="atn">media</span><span class="pun">=</span><span class="atv">"all"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L6"><span class="pln">{% endblock %}</span></li><li class="L7"><span class="pln"> </span></li><li class="L8"><span class="pln">{% block content %}</span></li><li class="L9"><span class="pln">    </span><span class="tag">&lt;h1&gt;</span><span class="pln">Job list</span><span class="tag">&lt;/h1&gt;</span></li><li class="L0"><span class="pln"> </span></li><li class="L1"><span class="pln">    </span><span class="tag">&lt;table</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"records_list"</span><span class="tag">&gt;</span></li><li class="L2"><span class="pln">        </span><span class="tag">&lt;thead&gt;</span></li><li class="L3"><span class="pln">            </span><span class="tag">&lt;tr&gt;</span></li><li class="L4"><span class="pln">                </span><span class="tag">&lt;th&gt;</span><span class="pln">Id</span><span class="tag">&lt;/th&gt;</span></li><li class="L5"><span class="pln">                </span><span class="tag">&lt;th&gt;</span><span class="pln">Type</span><span class="tag">&lt;/th&gt;</span></li><li class="L6"><span class="pln">                </span><span class="tag">&lt;th&gt;</span><span class="pln">Company</span><span class="tag">&lt;/th&gt;</span></li><li class="L7"><span class="pln">                </span><span class="tag">&lt;th&gt;</span><span class="pln">Logo</span><span class="tag">&lt;/th&gt;</span></li><li class="L8"><span class="pln">                </span><span class="tag">&lt;th&gt;</span><span class="pln">Url</span><span class="tag">&lt;/th&gt;</span></li><li class="L9"><span class="pln">                </span><span class="tag">&lt;th&gt;</span><span class="pln">Position</span><span class="tag">&lt;/th&gt;</span></li><li class="L0"><span class="pln">                </span><span class="tag">&lt;th&gt;</span><span class="pln">Location</span><span class="tag">&lt;/th&gt;</span></li><li class="L1"><span class="pln">                </span><span class="tag">&lt;th&gt;</span><span class="pln">Description</span><span class="tag">&lt;/th&gt;</span></li><li class="L2"><span class="pln">                </span><span class="tag">&lt;th&gt;</span><span class="pln">How_to_apply</span><span class="tag">&lt;/th&gt;</span></li><li class="L3"><span class="pln">                </span><span class="tag">&lt;th&gt;</span><span class="pln">Token</span><span class="tag">&lt;/th&gt;</span></li><li class="L4"><span class="pln">                </span><span class="tag">&lt;th&gt;</span><span class="pln">Is_public</span><span class="tag">&lt;/th&gt;</span></li><li class="L5"><span class="pln">                </span><span class="tag">&lt;th&gt;</span><span class="pln">Is_activated</span><span class="tag">&lt;/th&gt;</span></li><li class="L6"><span class="pln">                </span><span class="tag">&lt;th&gt;</span><span class="pln">Email</span><span class="tag">&lt;/th&gt;</span></li><li class="L7"><span class="pln">                </span><span class="tag">&lt;th&gt;</span><span class="pln">Expires_at</span><span class="tag">&lt;/th&gt;</span></li><li class="L8"><span class="pln">                </span><span class="tag">&lt;th&gt;</span><span class="pln">Created_at</span><span class="tag">&lt;/th&gt;</span></li><li class="L9"><span class="pln">                </span><span class="tag">&lt;th&gt;</span><span class="pln">Updated_at</span><span class="tag">&lt;/th&gt;</span></li><li class="L0"><span class="pln">                </span><span class="tag">&lt;th&gt;</span><span class="pln">Actions</span><span class="tag">&lt;/th&gt;</span></li><li class="L1"><span class="pln">            </span><span class="tag">&lt;/tr&gt;</span></li><li class="L2"><span class="pln">        </span><span class="tag">&lt;/thead&gt;</span></li><li class="L3"><span class="pln">        </span><span class="tag">&lt;tbody&gt;</span></li><li class="L4"><span class="pln">        {% for entity in entities %}</span></li><li class="L5"><span class="pln">            </span><span class="tag">&lt;tr&gt;</span></li><li class="L6"><span class="pln">                </span><span class="tag">&lt;td&gt;&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('ens_job_show', { 'id': entity.id }) }}"</span><span class="tag">&gt;</span><span class="pln">{{ entity.id }}</span><span class="tag">&lt;/a&gt;&lt;/td&gt;</span></li><li class="L7"><span class="pln">                </span><span class="tag">&lt;td&gt;</span><span class="pln">{{ entity.type }}</span><span class="tag">&lt;/td&gt;</span></li><li class="L8"><span class="pln">                </span><span class="tag">&lt;td&gt;</span><span class="pln">{{ entity.company }}</span><span class="tag">&lt;/td&gt;</span></li><li class="L9"><span class="pln">                </span><span class="tag">&lt;td&gt;</span><span class="pln">{{ entity.logo }}</span><span class="tag">&lt;/td&gt;</span></li><li class="L0"><span class="pln">                </span><span class="tag">&lt;td&gt;</span><span class="pln">{{ entity.url }}</span><span class="tag">&lt;/td&gt;</span></li><li class="L1"><span class="pln">                </span><span class="tag">&lt;td&gt;</span><span class="pln">{{ entity.position }}</span><span class="tag">&lt;/td&gt;</span></li><li class="L2"><span class="pln">                </span><span class="tag">&lt;td&gt;</span><span class="pln">{{ entity.location }}</span><span class="tag">&lt;/td&gt;</span></li><li class="L3"><span class="pln">                </span><span class="tag">&lt;td&gt;</span><span class="pln">{{ entity.description }}</span><span class="tag">&lt;/td&gt;</span></li><li class="L4"><span class="pln">                </span><span class="tag">&lt;td&gt;</span><span class="pln">{{ entity.howtoapply }}</span><span class="tag">&lt;/td&gt;</span></li><li class="L5"><span class="pln">                </span><span class="tag">&lt;td&gt;</span><span class="pln">{{ entity.token }}</span><span class="tag">&lt;/td&gt;</span></li><li class="L6"><span class="pln">                </span><span class="tag">&lt;td&gt;</span><span class="pln">{{ entity.ispublic }}</span><span class="tag">&lt;/td&gt;</span></li><li class="L7"><span class="pln">                </span><span class="tag">&lt;td&gt;</span><span class="pln">{{ entity.isactivated }}</span><span class="tag">&lt;/td&gt;</span></li><li class="L8"><span class="pln">                </span><span class="tag">&lt;td&gt;</span><span class="pln">{{ entity.email }}</span><span class="tag">&lt;/td&gt;</span></li><li class="L9"><span class="pln">                </span><span class="tag">&lt;td&gt;</span><span class="pln">{% if entity.expiresat %}{{ entity.expiresat|date('Y-m-d H:i:s') }}{% endif%}</span><span class="tag">&lt;/td&gt;</span></li><li class="L0"><span class="pln">                </span><span class="tag">&lt;td&gt;</span><span class="pln">{% if entity.createdat %}{{ entity.createdat|date('Y-m-d H:i:s') }}{% endif%}</span><span class="tag">&lt;/td&gt;</span></li><li class="L1"><span class="pln">                </span><span class="tag">&lt;td&gt;</span><span class="pln">{% if entity.updatedat %}{{ entity.updatedat|date('Y-m-d H:i:s') }}{% endif%}</span><span class="tag">&lt;/td&gt;</span></li><li class="L2"><span class="pln">                </span><span class="tag">&lt;td&gt;</span></li><li class="L3"><span class="pln">                    </span><span class="tag">&lt;ul&gt;</span></li><li class="L4"><span class="pln">                        </span><span class="tag">&lt;li&gt;</span></li><li class="L5"><span class="pln">                            </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('ens_job_show', { 'id': entity.id }) }}"</span><span class="tag">&gt;</span><span class="pln">show</span><span class="tag">&lt;/a&gt;</span></li><li class="L6"><span class="pln">                        </span><span class="tag">&lt;/li&gt;</span></li><li class="L7"><span class="pln">                        </span><span class="tag">&lt;li&gt;</span></li><li class="L8"><span class="pln">                            </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('ens_job_edit', { 'id': entity.id }) }}"</span><span class="tag">&gt;</span><span class="pln">edit</span><span class="tag">&lt;/a&gt;</span></li><li class="L9"><span class="pln">                        </span><span class="tag">&lt;/li&gt;</span></li><li class="L0"><span class="pln">                    </span><span class="tag">&lt;/ul&gt;</span></li><li class="L1"><span class="pln">                </span><span class="tag">&lt;/td&gt;</span></li><li class="L2"><span class="pln">            </span><span class="tag">&lt;/tr&gt;</span></li><li class="L3"><span class="pln">        {% endfor %}</span></li><li class="L4"><span class="pln">        </span><span class="tag">&lt;/tbody&gt;</span></li><li class="L5"><span class="pln">    </span><span class="tag">&lt;/table&gt;</span></li><li class="L6"><span class="pln"> </span></li><li class="L7"><span class="pln">    </span><span class="tag">&lt;ul&gt;</span></li><li class="L8"><span class="pln">        </span><span class="tag">&lt;li&gt;</span></li><li class="L9"><span class="pln">            </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('ens_job_new') }}"</span><span class="tag">&gt;</span></li><li class="L0"><span class="pln">                Create a new entry</span></li><li class="L1"><span class="pln">            </span><span class="tag">&lt;/a&gt;</span></li><li class="L2"><span class="pln">        </span><span class="tag">&lt;/li&gt;</span></li><li class="L3"><span class="pln">    </span><span class="tag">&lt;/ul&gt;</span></li><li class="L4"><span class="pln">{% endblock %}</span></li></ol></pre>
<p>Nous allons nettoyer tout ça un peu pour n'afficher qu'un sous-ensemble des colonnes disponibles. Remplacez le <strong>contenu du bloc Twig</strong> avec celui ci-dessous:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="pun">{%</span><span class="pln"> block content </span><span class="pun">%}</span></li><li class="L1"><span class="pln">    </span><span class="pun">&lt;</span><span class="pln">div id</span><span class="pun">=</span><span class="str">"jobs"</span><span class="pun">&gt;</span></li><li class="L2"><span class="pln">      </span><span class="pun">&lt;</span><span class="pln">table </span><span class="kwd">class</span><span class="pun">=</span><span class="str">"jobs"</span><span class="pun">&gt;</span></li><li class="L3"><span class="pln">        </span><span class="pun">{%</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> entity </span><span class="kwd">in</span><span class="pln"> entities </span><span class="pun">%}</span></li><li class="L4"><span class="pln">          </span><span class="pun">&lt;</span><span class="pln">tr </span><span class="kwd">class</span><span class="pun">=</span><span class="str">"{{ cycle(['even', 'odd'], loop.index) }}"</span><span class="pun">&gt;</span></li><li class="L5"><span class="pln">            </span><span class="pun">&lt;</span><span class="pln">td </span><span class="kwd">class</span><span class="pun">=</span><span class="str">"location"</span><span class="pun">&gt;{{</span><span class="pln"> entity</span><span class="pun">.</span><span class="pln">location </span><span class="pun">}}&lt;/</span><span class="pln">td</span><span class="pun">&gt;</span></li><li class="L6"><span class="pln">            </span><span class="pun">&lt;</span><span class="pln">td </span><span class="kwd">class</span><span class="pun">=</span><span class="str">"position"</span><span class="pun">&gt;</span></li><li class="L7"><span class="pln">              </span><span class="pun">&lt;</span><span class="pln">a href</span><span class="pun">=</span><span class="str">"{{ path('ens_job_show', { 'id': entity.id }) }}"</span><span class="pun">&gt;</span></li><li class="L8"><span class="pln">                </span><span class="pun">{{</span><span class="pln"> entity</span><span class="pun">.</span><span class="pln">position </span><span class="pun">}}</span></li><li class="L9"><span class="pln">              </span><span class="pun">&lt;</span><span class="str">/a&gt;</span></li><li class="L0"><span class="str">            &lt;/</span><span class="pln">td</span><span class="pun">&gt;</span></li><li class="L1"><span class="pln">            </span><span class="pun">&lt;</span><span class="pln">td </span><span class="kwd">class</span><span class="pun">=</span><span class="str">"company"</span><span class="pun">&gt;{{</span><span class="pln"> entity</span><span class="pun">.</span><span class="pln">company </span><span class="pun">}}&lt;/</span><span class="pln">td</span><span class="pun">&gt;</span></li><li class="L2"><span class="pln">          </span><span class="pun">&lt;</span><span class="str">/tr&gt;</span></li><li class="L3"><span class="str">        {% endfor %}</span></li><li class="L4"><span class="str">      &lt;/</span><span class="pln">table</span><span class="pun">&gt;</span></li><li class="L5"><span class="pln">    </span><span class="pun">&lt;/</span><span class="pln">div</span><span class="pun">&gt;</span></li><li class="L6"><span class="pun">{%</span><span class="pln"> endblock </span><span class="pun">%}</span></li></ol></pre>
<p class="tcenter"><a href="assets/img/jobeet_4-1.png" rel="shadowbox"><img src="assets/img/jobeet_4-1.png" alt="" class="img-polaroid"></a></p>
<br>
<h2>Le template d'une offre</h2>
<p>Maintenant, nous allons personnaliser le template de la page d'offre. Ouvrez le fichier <strong>show.html.twig</strong> et remplacez son contenu par le suivant:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">&lt;!-- src/Ens/JobeetBundle/Resources/views/Job/show.html.twig --&gt;</span></li><li class="L1"><span class="pln">{% extends 'EnsJobeetBundle::layout.html.twig' %}</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pln">{% block title %}</span></li><li class="L4"><span class="pln">    {{ entity.company }} is looking for a {{ entity.position }}</span></li><li class="L5"><span class="pln">{% endblock %}</span></li><li class="L6"><span class="pln"> </span></li><li class="L7"><span class="pln">{% block stylesheets %}</span></li><li class="L8"><span class="pln">    {{ parent() }}</span></li><li class="L9"><span class="pln">    </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"stylesheet"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ asset('bundles/ensjobeet/css/job.css') }}"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text/css"</span><span class="pln"> </span><span class="atn">media</span><span class="pun">=</span><span class="atv">"all"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L0"><span class="pln">{% endblock %}</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="pln">{% block content %}</span></li><li class="L3"><span class="pln">    </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"job"</span><span class="tag">&gt;</span></li><li class="L4"><span class="pln">      </span><span class="tag">&lt;h1&gt;</span><span class="pln">{{ entity.company }}</span><span class="tag">&lt;/h1&gt;</span></li><li class="L5"><span class="pln">      </span><span class="tag">&lt;h2&gt;</span><span class="pln">{{ entity.location }}</span><span class="tag">&lt;/h2&gt;</span></li><li class="L6"><span class="pln">      </span><span class="tag">&lt;h3&gt;</span></li><li class="L7"><span class="pln">        {{ entity.position }}</span></li><li class="L8"><span class="pln">        </span><span class="tag">&lt;small&gt;</span><span class="pln"> - {{ entity.type }}</span><span class="tag">&lt;/small&gt;</span></li><li class="L9"><span class="pln">      </span><span class="tag">&lt;/h3&gt;</span></li><li class="L0"><span class="pln"> </span></li><li class="L1"><span class="pln">      {% if entity.logo %}</span></li><li class="L2"><span class="pln">        </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"logo"</span><span class="tag">&gt;</span></li><li class="L3"><span class="pln">          </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ entity.url }}"</span><span class="tag">&gt;</span></li><li class="L4"><span class="pln">            </span><span class="tag">&lt;img</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"/uploads/jobs/{{ entity.logo }}"</span></li><li class="L5"><span class="pln">              </span><span class="atn">alt</span><span class="pun">=</span><span class="atv">"{{ entity.company }} logo"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L6"><span class="pln">          </span><span class="tag">&lt;/a&gt;</span></li><li class="L7"><span class="pln">        </span><span class="tag">&lt;/div&gt;</span></li><li class="L8"><span class="pln">      {% endif %}</span></li><li class="L9"><span class="pln"> </span></li><li class="L0"><span class="pln">      </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"description"</span><span class="tag">&gt;</span></li><li class="L1"><span class="pln">        {{ entity.description|nl2br }}</span></li><li class="L2"><span class="pln">      </span><span class="tag">&lt;/div&gt;</span></li><li class="L3"><span class="pln"> </span></li><li class="L4"><span class="pln">      </span><span class="tag">&lt;h4&gt;</span><span class="pln">How to apply?</span><span class="tag">&lt;/h4&gt;</span></li><li class="L5"><span class="pln"> </span></li><li class="L6"><span class="pln">      </span><span class="tag">&lt;p</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"how_to_apply"</span><span class="tag">&gt;</span><span class="pln">{{ entity.howtoapply }}</span><span class="tag">&lt;/p&gt;</span></li><li class="L7"><span class="pln"> </span></li><li class="L8"><span class="pln">      </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"meta"</span><span class="tag">&gt;</span></li><li class="L9"><span class="pln">        </span><span class="tag">&lt;small&gt;</span><span class="pln">posted on {{ entity.createdat|date('m/d/Y') }}</span><span class="tag">&lt;/small&gt;</span></li><li class="L0"><span class="pln">      </span><span class="tag">&lt;/div&gt;</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="pln">      </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">style</span><span class="pun">=</span><span class="atv">"</span><span class="pln">padding</span><span class="pun">:</span><span class="pln"> </span><span class="lit">20px</span><span class="pln"> </span><span class="lit">0</span><span class="atv">"</span><span class="tag">&gt;</span></li><li class="L3"><span class="pln">        </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('ens_job_edit', { 'id': entity.id }) }}"</span><span class="tag">&gt;</span></li><li class="L4"><span class="pln">          Edit</span></li><li class="L5"><span class="pln">        </span><span class="tag">&lt;/a&gt;</span></li><li class="L6"><span class="pln">      </span><span class="tag">&lt;/div&gt;</span></li><li class="L7"><span class="pln">    </span><span class="tag">&lt;/div&gt;</span></li><li class="L8"><span class="pln">{% endblock %}</span></li></ol></pre>
<p class="tcenter"><a href="assets/img/jobeet_4-2.png" rel="shadowbox"><img src="assets/img/jobeet_4-2.png" alt="" class="img-polaroid"></a></p>
<br>
<h2>L'action de la page des offres</h2>
<p>La page des offres est générée par l'action show, définie dans <strong>showAction()</strong> de <strong>JobController</strong>:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> showAction</span><span class="pun">(</span><span class="pln">$id</span><span class="pun">)</span></li><li class="L1"><span class="pun">{</span></li><li class="L2"><span class="pln">    $em </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">getDoctrine</span><span class="pun">()-&gt;</span><span class="pln">getEntityManager</span><span class="pun">();</span></li><li class="L3"><span class="pln"> </span></li><li class="L4"><span class="pln">    $entity </span><span class="pun">=</span><span class="pln"> $em</span><span class="pun">-&gt;</span><span class="pln">getRepository</span><span class="pun">(</span><span class="str">'EnsJobeetBundle:Job'</span><span class="pun">)-&gt;</span><span class="pln">find</span><span class="pun">(</span><span class="pln">$id</span><span class="pun">);</span></li><li class="L5"><span class="pln"> </span></li><li class="L6"><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">$entity</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class="L7"><span class="pln">        </span><span class="kwd">throw</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">createNotFoundException</span><span class="pun">(</span><span class="str">'Unable to find Job entity.'</span><span class="pun">);</span></li><li class="L8"><span class="pln">    </span><span class="pun">}</span></li><li class="L9"><span class="pln"> </span></li><li class="L0"><span class="pln">    $deleteForm </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">createDeleteForm</span><span class="pun">(</span><span class="pln">$id</span><span class="pun">);</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">render</span><span class="pun">(</span><span class="str">'EnsJobeetBundle:Job:show.html.twig'</span><span class="pun">,</span><span class="pln"> array</span><span class="pun">(</span></li><li class="L3"><span class="pln">        </span><span class="str">'entity'</span><span class="pln">      </span><span class="pun">=&gt;</span><span class="pln"> $entity</span><span class="pun">,</span></li><li class="L4"><span class="pln">        </span><span class="str">'delete_form'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> $deleteForm</span><span class="pun">-&gt;</span><span class="pln">createView</span><span class="pun">(),</span></li><li class="L5"><span class="pln"> </span></li><li class="L6"><span class="pln">    </span><span class="pun">));</span></li><li class="L7"><span class="pun">}</span></li></ol></pre>
<p>Comme dans l'action <strong>index</strong>, le dépôt <strong>EnsJobeetBundle:job</strong> est utilisée pour récupérer une offre, cette fois en utilisant la méthode <strong>find()</strong>. Le paramètre de cette méthode est l'identifiant unique d'une offre, sa clé primaire. La section suivante explique pourquoi le paramètre <strong>$id</strong> de la fonction <strong>actionShow()</strong> contient la clé primaire de l'offre.</p>
<p>Si l'offre n'existe pas dans la BDD, nous voudrons renvoyer l'utilisateur vers une page d'erreur 404, ce que fait exactement <strong>throw $this-&gt;createNotFoundException()</strong>.</p>
<p>En ce qui concerne les exceptions, la page affichée à l'utilisateur est différente dans l'environnement <strong>prod</strong> et dans l'environnement <strong>dev</strong>:</p>
<p class="tcenter"><a href="assets/img/jobeet_4-3.png" rel="shadowbox"><img src="assets/img/jobeet_4-3.png" alt="" class="img-polaroid"></a></p>
<p class="tcenter"><a href="assets/img/jobeet_4-4.png" rel="shadowbox"><img src="assets/img/jobeet_4-4.png" alt="" class="img-polaroid"></a></p>
<br>
<p class="clearfix noprint">
	<a href="le-modele-de-donnees.html" class="btn btn-success pull-left">Chapitre précédent</a>
	<a href="le-routage.html" class="btn btn-success pull-right">Chapitre suivant</a>
</p>														<p class="link_source noprint"><a href="http://www.ens.ro/2012/03/31/symfony2-jobeet-day-4-the-controller-and-the-view/" target="_blank">» Lire l'article original</a></p>
																					<br>
													</section>
					</div>
				</div>
				<hr />
				<footer>
					<!--<p class="tcenter">Tutoriel original par <a href="http://www.ens.ro/2012/03/21/jobeet-tutorial-with-symfony2/" target="_blank">Dragos Holban</a> - Traduit par <a href="https://plus.google.com/109236735134093009460?rel=author" target="_blank">Jonathan Thuau</a> - Le tuto sur <a href="https://github.com/thujohn/Jobeet" target="_blank">github</a></p>-->
				</footer>
			</div>
		</div>
	</div>
<script src="assets/js/jquery-1.8.2.min.js"></script>
<script src="assets/js/bootstrap.js"></script>
<script src="assets/js/prettify.js"></script>
<script src="assets/js/lang-yaml.js"></script>
<script src="assets/js/shadowbox.js"></script>
<script type="text/javascript">
<!--
jQuery(document).ready(function(){
	Shadowbox.init();
	prettyPrint();
	jQuery('.bs-docs-sidenav').affix({
		offset: {
			top: 150,
			bottom: 270
		}
	});
	jQuery('a[href*=#]').click(function (e) {
		var hash = jQuery(this).attr('href');
		e.preventDefault();
		var dest = 0;
		if (jQuery(this.hash).offset().top > (jQuery(document).height() - jQuery(window).height())){
			dest = jQuery(document).height() - jQuery(window).height();
		}else{
			dest = jQuery(this.hash).offset().top;
		}
		jQuery('html,body').animate({scrollTop:dest}, 1000, 'swing');
	});
});
-->
</script>
</body>
</html>