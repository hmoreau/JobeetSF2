<div class="page-header clearfix"><h1 class="pull-left">Jouons avec la page Catégorie</h1></div>
							<p>Dans ce chapitre, nous allons faire la page de catégorie, comme il est décrit dans les scénarios du deuxième chapitre: "<em>L'utilisateur voit une liste de toutes les offres d'emploi de la catégorie triées par date et paginée avec 20 emplois par page</em>".</p>
<br>
<h2>La route Category</h2>
<p>Tout d'abord, nous devons ajouter une route pour utiliser des URL propres pour la page de catégorie. Ajoutez ce code au début du fichier de configuration:</p>
<pre class="prettyprint linenums lang-yaml"><ol class="linenums"><li class="L0"><span class="com"># src/Ens/JobeetBundle/Resources/config/routing.yml</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="kwd">EnsJobeetBundle_category:</span></li><li class="L3"><span class="pln">    </span><span class="kwd">pattern: </span><span class="pln"> /category/{slug}</span></li><li class="L4"><span class="pln">    </span><span class="kwd">defaults: </span><span class="pln">{ </span><span class="kwd">_controller: </span><span class="pln">EnsJobeetBundle</span><span class="pun">:</span><span class="pln">Category</span><span class="pun">:</span><span class="pln">show }</span></li></ol></pre>
<p>Pour obtenir le jeton (slug) d'une catégorie, nous devons ajouter la méthode <strong>getSlug()</strong> à notre classe <strong>Category</strong>:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">// src/Ens/JobeetBundle/Entity/Category.php</span></li><li class="L1"><span class="com">// ...</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="kwd">use</span><span class="pln"> </span><span class="typ">Ens</span><span class="pln">\JobeetBundle\Utils\Jobeet</span><span class="pun">;</span></li><li class="L4"><span class="pln"> </span></li><li class="L5"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Category</span></li><li class="L6"><span class="pun">{</span></li><li class="L7"><span class="pln">  </span><span class="com">// ...</span></li><li class="L8"><span class="pln"> </span></li><li class="L9"><span class="pln">  </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> getSlug</span><span class="pun">()</span></li><li class="L0"><span class="pln">  </span><span class="pun">{</span></li><li class="L1"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Jobeet</span><span class="pun">::</span><span class="pln">slugify</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">getName</span><span class="pun">());</span></li><li class="L2"><span class="pln">  </span><span class="pun">}</span></li><li class="L3"><span class="pln"> </span></li><li class="L4"><span class="pln">  </span><span class="com">// ...</span></li><li class="L5"><span class="pun">}</span></li></ol></pre>
<br>
<h2>Le lien de la catégorie</h2>
<p>Maintenant, modifiez le template <strong>index.html.twig</strong> du contrôleur <strong>Job</strong> et ajoutez le lien vers la page catégorie:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">&lt;!-- src/Ens/JobeetBundle/Resources/views/Job/index.html.twig --&gt;</span></li><li class="L1"><span class="com">&lt;!-- some HTML code --&gt;</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pln">            </span><span class="tag">&lt;h1&gt;&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('EnsJobeetBundle_category', { 'slug': category.slug }) }}"</span><span class="tag">&gt;</span><span class="pln">{{ category.name }}</span><span class="tag">&lt;/a&gt;&lt;/h1&gt;</span></li><li class="L4"><span class="pln"> </span></li><li class="L5"><span class="com">&lt;!-- some HTML code --&gt;</span></li><li class="L6"><span class="pln"> </span></li><li class="L7"><span class="pln">          </span><span class="tag">&lt;/table&gt;</span></li><li class="L8"><span class="pln"> </span></li><li class="L9"><span class="pln">          {% if category.morejobs %}</span></li><li class="L0"><span class="pln">            </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"more_jobs"</span><span class="tag">&gt;</span></li><li class="L1"><span class="pln">              and </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('EnsJobeetBundle_category', { 'slug': category.slug }) }}"</span><span class="tag">&gt;</span><span class="pln">{{ category.morejobs }}</span><span class="tag">&lt;/a&gt;</span></li><li class="L2"><span class="pln">              more...</span></li><li class="L3"><span class="pln">            </span><span class="tag">&lt;/div&gt;</span></li><li class="L4"><span class="pln">          {% endif %}</span></li><li class="L5"><span class="pln">        </span><span class="tag">&lt;/div&gt;</span></li><li class="L6"><span class="pln">      {% endfor %}</span></li><li class="L7"><span class="pln">    </span><span class="tag">&lt;/div&gt;</span></li><li class="L8"><span class="pln">{% endblock %}</span></li></ol></pre>
<p>Dans le template ci-dessus, nous avons utilisé <strong>category.morejobs</strong>, nous allons donc le définir:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">// src/Ens/JobeetBunlde/Entity/Category.php</span></li><li class="L1"><span class="com">// ...</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="kwd">private</span><span class="pln"> $more_jobs</span><span class="pun">;</span></li><li class="L4"><span class="pln"> </span></li><li class="L5"><span class="com">// ...</span></li><li class="L6"><span class="pln"> </span></li><li class="L7"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> setMoreJobs</span><span class="pun">(</span><span class="pln">$jobs</span><span class="pun">)</span></li><li class="L8"><span class="pun">{</span></li><li class="L9"><span class="pln">  $this</span><span class="pun">-&gt;</span><span class="pln">more_jobs </span><span class="pun">=</span><span class="pln"> $jobs </span><span class="pun">&gt;=</span><span class="pln">  </span><span class="lit">0</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> $jobs </span><span class="pun">:</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></li><li class="L0"><span class="pun">}</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> getMoreJobs</span><span class="pun">()</span></li><li class="L3"><span class="pun">{</span></li><li class="L4"><span class="pln">  </span><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">more_jobs</span><span class="pun">;</span></li><li class="L5"><span class="pun">}</span></li><li class="L6"><span class="pln"> </span></li><li class="L7"><span class="com">// ...</span></li></ol></pre>
<p>La propriété <strong>more_jobs</strong> prendra comme valeur le nombre d'offres actives pour la catégorie moins le nombre d'offres figurant sur la page d'accueil. Maintenant, dans <strong>JobController</strong>, nous avons besoin de définir la valeur <strong>more_jobs</strong> pour chaque catégorie:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">// src/Ens/JobeetBundle/Controller/JobController.php</span></li><li class="L1"><span class="com">// ...</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> indexAction</span><span class="pun">()</span></li><li class="L4"><span class="pun">{</span></li><li class="L5"><span class="pln">  $em </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">getDoctrine</span><span class="pun">()-&gt;</span><span class="pln">getEntityManager</span><span class="pun">();</span></li><li class="L6"><span class="pln"> </span></li><li class="L7"><span class="pln">  $categories </span><span class="pun">=</span><span class="pln"> $em</span><span class="pun">-&gt;</span><span class="pln">getRepository</span><span class="pun">(</span><span class="str">'EnsJobeetBundle:Category'</span><span class="pun">)-&gt;</span><span class="pln">getWithJobs</span><span class="pun">();</span></li><li class="L8"><span class="pln"> </span></li><li class="L9"><span class="pln">  </span><span class="kwd">foreach</span><span class="pun">(</span><span class="pln">$categories </span><span class="kwd">as</span><span class="pln"> $category</span><span class="pun">)</span></li><li class="L0"><span class="pln">  </span><span class="pun">{</span></li><li class="L1"><span class="pln">    $category</span><span class="pun">-&gt;</span><span class="pln">setActiveJobs</span><span class="pun">(</span><span class="pln">$em</span><span class="pun">-&gt;</span><span class="pln">getRepository</span><span class="pun">(</span><span class="str">'EnsJobeetBundle:Job'</span><span class="pun">)-&gt;</span><span class="pln">getActiveJobs</span><span class="pun">(</span><span class="pln">$category</span><span class="pun">-&gt;</span><span class="pln">getId</span><span class="pun">(),</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">container</span><span class="pun">-&gt;</span><span class="pln">getParameter</span><span class="pun">(</span><span class="str">'max_jobs_on_homepage'</span><span class="pun">)));</span></li><li class="L2"><span class="pln">    $category</span><span class="pun">-&gt;</span><span class="pln">setMoreJobs</span><span class="pun">(</span><span class="pln">$em</span><span class="pun">-&gt;</span><span class="pln">getRepository</span><span class="pun">(</span><span class="str">'EnsJobeetBundle:Job'</span><span class="pun">)-&gt;</span><span class="pln">countActiveJobs</span><span class="pun">(</span><span class="pln">$category</span><span class="pun">-&gt;</span><span class="pln">getId</span><span class="pun">())</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">container</span><span class="pun">-&gt;</span><span class="pln">getParameter</span><span class="pun">(</span><span class="str">'max_jobs_on_homepage'</span><span class="pun">));</span></li><li class="L3"><span class="pln">  </span><span class="pun">}</span></li><li class="L4"><span class="pln"> </span></li><li class="L5"><span class="pln">  </span><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">render</span><span class="pun">(</span><span class="str">'EnsJobeetBundle:Job:index.html.twig'</span><span class="pun">,</span><span class="pln"> array</span><span class="pun">(</span></li><li class="L6"><span class="pln">    </span><span class="str">'categories'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> $categories</span></li><li class="L7"><span class="pln">  </span><span class="pun">));</span></li><li class="L8"><span class="pun">}</span></li><li class="L9"><span class="com">// ...</span></li></ol></pre>
<p>La fonction <strong>countActiveJobs</strong> doit être ajoutée dans <strong>JobRepository</strong>:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">// src/Ens/JobeetBundle/Repository/JobRepository.php</span></li><li class="L1"><span class="com">// ...</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> countActiveJobs</span><span class="pun">(</span><span class="pln">$category_id </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span></li><li class="L4"><span class="pun">{</span></li><li class="L5"><span class="pln">  $qb </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">createQueryBuilder</span><span class="pun">(</span><span class="str">'j'</span><span class="pun">)</span></li><li class="L6"><span class="pln">    </span><span class="pun">-&gt;</span><span class="kwd">select</span><span class="pun">(</span><span class="str">'count(j.id)'</span><span class="pun">)</span></li><li class="L7"><span class="pln">    </span><span class="pun">-&gt;</span><span class="kwd">where</span><span class="pun">(</span><span class="str">'j.expires_at &gt; :date'</span><span class="pun">)</span></li><li class="L8"><span class="pln">    </span><span class="pun">-&gt;</span><span class="pln">setParameter</span><span class="pun">(</span><span class="str">'date'</span><span class="pun">,</span><span class="pln"> date</span><span class="pun">(</span><span class="str">'Y-m-d H:i:s'</span><span class="pun">,</span><span class="pln"> time</span><span class="pun">()));</span></li><li class="L9"><span class="pln"> </span></li><li class="L0"><span class="pln">  </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">$category_id</span><span class="pun">)</span></li><li class="L1"><span class="pln">  </span><span class="pun">{</span></li><li class="L2"><span class="pln">    $qb</span><span class="pun">-&gt;</span><span class="pln">andWhere</span><span class="pun">(</span><span class="str">'j.category = :category_id'</span><span class="pun">)</span></li><li class="L3"><span class="pln">    </span><span class="pun">-&gt;</span><span class="pln">setParameter</span><span class="pun">(</span><span class="str">'category_id'</span><span class="pun">,</span><span class="pln"> $category_id</span><span class="pun">);</span></li><li class="L4"><span class="pln">  </span><span class="pun">}</span></li><li class="L5"><span class="pln"> </span></li><li class="L6"><span class="pln">  $query </span><span class="pun">=</span><span class="pln"> $qb</span><span class="pun">-&gt;</span><span class="pln">getQuery</span><span class="pun">();</span></li><li class="L7"><span class="pln"> </span></li><li class="L8"><span class="pln">  </span><span class="kwd">return</span><span class="pln"> $query</span><span class="pun">-&gt;</span><span class="pln">getSingleScalarResult</span><span class="pun">();</span></li><li class="L9"><span class="pun">}</span></li><li class="L0"><span class="pln"> </span></li><li class="L1"><span class="com">// ...</span></li></ol></pre>
<p>Maintenant, vous devriez voir le résultat dans votre navigateur:</p>
<p class="tcenter"><a href="assets/img/jobeet_7-1.png" rel="shadowbox"><img src="assets/img/jobeet_7-1.png" alt="" class="img-polaroid"></a></p>
<br>
<h2>Création du contrôleur Category</h2>
<p>Il est maintenant temps de créer le contrôleur <strong>Category</strong>. Créez un nouveau fichier <strong>CategoryController.php</strong> dans votre répertoire <strong>Controller</strong>:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">// src/Ens/JobeetBundle/Controller/CategoryController.php</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="kwd">namespace</span><span class="pln"> </span><span class="typ">Ens</span><span class="pln">\JobeetBundle\Controller</span><span class="pun">;</span></li><li class="L3"><span class="kwd">use</span><span class="pln"> </span><span class="typ">Symfony</span><span class="pln">\Bundle\FrameworkBundle\Controller\Controller</span><span class="pun">;</span></li><li class="L4"><span class="kwd">use</span><span class="pln"> </span><span class="typ">Ens</span><span class="pln">\JobeetBundle\Entity\Category</span><span class="pun">;</span></li><li class="L5"><span class="pln"> </span></li><li class="L6"><span class="com">/**</span></li><li class="L7"><span class="com">* Category controller.</span></li><li class="L8"><span class="com">*</span></li><li class="L9"><span class="com">*/</span></li><li class="L0"><span class="kwd">class</span><span class="pln"> </span><span class="typ">CategoryController</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Controller</span></li><li class="L1"><span class="pun">{</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pun">}</span></li></ol></pre>
<p>Nous pourrions utiliser la commande <strong>doctrine:generate:crud</strong> comme nous l'avons fait pour <strong>JobController</strong>, mais nous n'aurons pas besoin de 90% du code généré, donc nous pouvons juste créer un nouveau contrôleur à partir de zéro.</p>
<br>
<h2>Mettre à jour la Base De Données</h2>
<p>Nous avons besoin d'ajouter une colonne <strong>slug</strong> dans la table <strong>category</strong> et une entrée <strong>lifecycleCallbacks</strong> pour définir la valeur de cette colonne:</p>
<pre class="prettyprint linenums lang-yaml"><ol class="linenums"><li class="L0"><span class="com"># src/Ens/JobeetBundle/Resources/config/doctrine/Category.orm.yml</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="pln">Ens\JobeetBundle\Entity\</span><span class="kwd">Category:</span></li><li class="L3"><span class="pln">  </span><span class="kwd">type: </span><span class="pln">entity</span></li><li class="L4"><span class="pln">  </span><span class="kwd">repositoryClass: </span><span class="pln">Ens\JobeetBundle\Repository\CategoryRepository</span></li><li class="L5"><span class="pln">  </span><span class="kwd">table: </span><span class="pln">category</span></li><li class="L6"><span class="pln">  </span><span class="kwd">id:</span></li><li class="L7"><span class="pln">    </span><span class="kwd">id:</span></li><li class="L8"><span class="pln">      </span><span class="kwd">type: </span><span class="pln">integer</span></li><li class="L9"><span class="pln">      </span><span class="kwd">generator: </span><span class="pln">{ </span><span class="kwd">strategy: </span><span class="pln">AUTO }</span></li><li class="L0"><span class="pln">  </span><span class="kwd">fields:</span></li><li class="L1"><span class="pln">    </span><span class="kwd">name:</span></li><li class="L2"><span class="pln">      </span><span class="kwd">type: </span><span class="pln">string</span></li><li class="L3"><span class="pln">      </span><span class="kwd">length: </span><span class="pln">255</span></li><li class="L4"><span class="pln">      </span><span class="kwd">unique: </span><span class="pln">true</span></li><li class="L5"><span class="pln">    </span><span class="kwd">slug:</span></li><li class="L6"><span class="pln">      </span><span class="kwd">type: </span><span class="pln">string</span></li><li class="L7"><span class="pln">      </span><span class="kwd">length: </span><span class="pln">255</span></li><li class="L8"><span class="pln">      </span><span class="kwd">unique: </span><span class="pln">true</span></li><li class="L9"><span class="pln">  </span><span class="kwd">oneToMany:</span></li><li class="L0"><span class="pln">    </span><span class="kwd">jobs:</span></li><li class="L1"><span class="pln">      </span><span class="kwd">targetEntity: </span><span class="pln">Job</span></li><li class="L2"><span class="pln">      </span><span class="kwd">mappedBy: </span><span class="pln">category</span></li><li class="L3"><span class="pln">    </span><span class="kwd">category_affiliates:</span></li><li class="L4"><span class="pln">      </span><span class="kwd">targetEntity: </span><span class="pln">CategoryAffiliate</span></li><li class="L5"><span class="pln">      </span><span class="kwd">mappedBy: </span><span class="pln">category</span></li><li class="L6"><span class="pln">  </span><span class="kwd">lifecycleCallbacks:</span></li><li class="L7"><span class="pln">    </span><span class="kwd">prePersist: </span><span class="pln">[ setSlugValue ]</span></li><li class="L8"><span class="pln">    </span><span class="kwd">preUpdate: </span><span class="pln">[ setSlugValue ]</span></li></ol></pre>
<p>Retirez de l'entité <strong>Category</strong> (<strong>src/Ens/JobeetBundle/Entity/category.php</strong>) la méthode <strong>getSlug</strong> que nous avons créé précédemment et exécutez la commande Doctrine pour mettre à jour la classe d'entité <strong>Category</strong>:</p>
<pre>php app/console doctrine:generate:entities EnsJobeetBundle</pre>
<p>Maintenant vous devriez avoir ce qui suit ajouté à <strong>Category.php</strong>:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">// srr/Ens/JobeetBundle/Entity/Category.php</span></li><li class="L1"><span class="com">// ...</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="com">/**</span></li><li class="L4"><span class="com">* @var string $slug</span></li><li class="L5"><span class="com">*/</span></li><li class="L6"><span class="kwd">private</span><span class="pln"> $slug</span><span class="pun">;</span></li><li class="L7"><span class="pln"> </span></li><li class="L8"><span class="com">/**</span></li><li class="L9"><span class="com">* Set slug</span></li><li class="L0"><span class="com">*</span></li><li class="L1"><span class="com">* @param string $slug</span></li><li class="L2"><span class="com">*/</span></li><li class="L3"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> setSlug</span><span class="pun">(</span><span class="pln">$slug</span><span class="pun">)</span></li><li class="L4"><span class="pun">{</span></li><li class="L5"><span class="pln">    $this</span><span class="pun">-&gt;</span><span class="pln">slug </span><span class="pun">=</span><span class="pln"> $slug</span><span class="pun">;</span></li><li class="L6"><span class="pun">}</span></li><li class="L7"><span class="com">/**</span></li><li class="L8"><span class="com">* Get slug</span></li><li class="L9"><span class="com">*</span></li><li class="L0"><span class="com">* @return string</span></li><li class="L1"><span class="com">*/</span></li><li class="L2"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> getSlug</span><span class="pun">()</span></li><li class="L3"><span class="pun">{</span></li><li class="L4"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">slug</span><span class="pun">;</span></li><li class="L5"><span class="pun">}</span></li><li class="L6"><span class="com">/**</span></li><li class="L7"><span class="com">* @ORM\prePersist</span></li><li class="L8"><span class="com">*/</span></li><li class="L9"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> setSlugValue</span><span class="pun">()</span></li><li class="L0"><span class="pun">{</span></li><li class="L1"><span class="pln">    </span><span class="com">// Add your code here</span></li><li class="L2"><span class="pun">}</span></li></ol></pre>
<p>Changez la fonction <strong>setSlugValue</strong> avec ce qui suit:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> setSlugValue</span><span class="pun">()</span></li><li class="L1"><span class="pun">{</span></li><li class="L2"><span class="pln">    $this</span><span class="pun">-&gt;</span><span class="pln">slug </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Jobeet</span><span class="pun">::</span><span class="pln">slugify</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">getName</span><span class="pun">());</span></li><li class="L3"><span class="pun">}</span></li></ol></pre>
<p>Maintenant, nous devons supprimer la BDD et la recréer avec la nouvelle colonne de la table <strong>category</strong> et charger les fixtures:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="pln">php app</span><span class="pun">/</span><span class="pln">console doctrine</span><span class="pun">:</span><span class="pln">database</span><span class="pun">:</span><span class="pln">drop </span><span class="pun">--</span><span class="pln">force</span></li><li class="L1"><span class="pln">php app</span><span class="pun">/</span><span class="pln">console doctrine</span><span class="pun">:</span><span class="pln">database</span><span class="pun">:</span><span class="pln">create</span></li><li class="L2"><span class="pln">php app</span><span class="pun">/</span><span class="pln">console doctrine</span><span class="pun">:</span><span class="pln">schema</span><span class="pun">:</span><span class="pln">update </span><span class="pun">--</span><span class="pln">force</span></li><li class="L3"><span class="pln">php app</span><span class="pun">/</span><span class="pln">console doctrine</span><span class="pun">:</span><span class="pln">fixtures</span><span class="pun">:</span><span class="pln">load</span></li></ol></pre>
<br>
<h2>La page catégorie</h2>
<p>Tout est maintenant en place pour créer la méthode <strong>showAction()</strong>. Ajoutez le code suivant au fichier <strong>CategoryController.php</strong>:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">// src/Ens/JobeetBundle/Controller/CategoryController.php</span></li><li class="L1"><span class="com">// ...</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> showAction</span><span class="pun">(</span><span class="pln">$slug</span><span class="pun">)</span></li><li class="L4"><span class="pun">{</span></li><li class="L5"><span class="pln">    $em </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">getDoctrine</span><span class="pun">()-&gt;</span><span class="pln">getEntityManager</span><span class="pun">();</span></li><li class="L6"><span class="pln"> </span></li><li class="L7"><span class="pln">    $category </span><span class="pun">=</span><span class="pln"> $em</span><span class="pun">-&gt;</span><span class="pln">getRepository</span><span class="pun">(</span><span class="str">'EnsJobeetBundle:Category'</span><span class="pun">)-&gt;</span><span class="pln">findOneBySlug</span><span class="pun">(</span><span class="pln">$slug</span><span class="pun">);</span></li><li class="L8"><span class="pln"> </span></li><li class="L9"><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">$category</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class="L0"><span class="pln">        </span><span class="kwd">throw</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">createNotFoundException</span><span class="pun">(</span><span class="str">'Unable to find Category entity.'</span><span class="pun">);</span></li><li class="L1"><span class="pln">    </span><span class="pun">}</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pln">    $category</span><span class="pun">-&gt;</span><span class="pln">setActiveJobs</span><span class="pun">(</span><span class="pln">$em</span><span class="pun">-&gt;</span><span class="pln">getRepository</span><span class="pun">(</span><span class="str">'EnsJobeetBundle:Job'</span><span class="pun">)-&gt;</span><span class="pln">getActiveJobs</span><span class="pun">(</span><span class="pln">$category</span><span class="pun">-&gt;</span><span class="pln">getId</span><span class="pun">()));</span></li><li class="L4"><span class="pln"> </span></li><li class="L5"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">render</span><span class="pun">(</span><span class="str">'EnsJobeetBundle:Category:show.html.twig'</span><span class="pun">,</span><span class="pln"> array</span><span class="pun">(</span></li><li class="L6"><span class="pln">        </span><span class="str">'category'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> $category</span><span class="pun">,</span></li><li class="L7"><span class="pln">    </span><span class="pun">));</span></li><li class="L8"><span class="pun">}</span></li><li class="L9"><span class="pln"> </span></li><li class="L0"><span class="com">// ...</span></li></ol></pre>
<p>La dernière étape consiste à créer le template <strong>show.html.twig</strong>:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">&lt;!-- src/Ens/JobeetBundle/Resources/view/Category/show.html.twig --&gt;</span></li><li class="L1"><span class="pln">&nbsp;</span></li><li class="L2"><span class="pln">{% extends 'EnsJobeetBundle::layout.html.twig' %}</span></li><li class="L3"><span class="pln"> </span></li><li class="L4"><span class="pln">{% block title %}</span></li><li class="L5"><span class="pln">  Jobs in the {{ category.name }} category</span></li><li class="L6"><span class="pln">{% endblock %}</span></li><li class="L7"><span class="pln"> </span></li><li class="L8"><span class="pln">{% block stylesheets %}</span></li><li class="L9"><span class="pln">  {{ parent() }}</span></li><li class="L0"><span class="pln">  </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"stylesheet"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ asset('bundles/ensjobeet/css/jobs.css') }}"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text/css"</span><span class="pln"> </span><span class="atn">media</span><span class="pun">=</span><span class="atv">"all"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L1"><span class="pln">{% endblock %}</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pln">{% block content %}</span></li><li class="L4"><span class="pln">  </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"category"</span><span class="tag">&gt;</span></li><li class="L5"><span class="pln">    </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"feed"</span><span class="tag">&gt;</span></li><li class="L6"><span class="pln">      </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">""</span><span class="tag">&gt;</span><span class="pln">Feed</span><span class="tag">&lt;/a&gt;</span></li><li class="L7"><span class="pln">    </span><span class="tag">&lt;/div&gt;</span></li><li class="L8"><span class="pln">    </span><span class="tag">&lt;h1&gt;</span><span class="pln">{{ category.name }}</span><span class="tag">&lt;/h1&gt;</span></li><li class="L9"><span class="pln">  </span><span class="tag">&lt;/div&gt;</span></li><li class="L0"><span class="pln"> </span></li><li class="L1"><span class="pln">  </span><span class="tag">&lt;table</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"jobs"</span><span class="tag">&gt;</span></li><li class="L2"><span class="pln">    {% for entity in category.activejobs %}</span></li><li class="L3"><span class="pln">      </span><span class="tag">&lt;tr</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"{{ cycle(['even', 'odd'], loop.index) }}"</span><span class="tag">&gt;</span></li><li class="L4"><span class="pln">        </span><span class="tag">&lt;td</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"location"</span><span class="tag">&gt;</span><span class="pln">{{ entity.location }}</span><span class="tag">&lt;/td&gt;</span></li><li class="L5"><span class="pln">        </span><span class="tag">&lt;td</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"position"</span><span class="tag">&gt;</span></li><li class="L6"><span class="pln">          </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('ens_job_show', { 'id': entity.id, 'company': entity.companyslug, 'location': entity.locationslug, 'position': entity.positionslug }) }}"</span><span class="tag">&gt;</span></li><li class="L7"><span class="pln">            {{ entity.position }}</span></li><li class="L8"><span class="pln">          </span><span class="tag">&lt;/a&gt;</span></li><li class="L9"><span class="pln">        </span><span class="tag">&lt;/td&gt;</span></li><li class="L0"><span class="pln">        </span><span class="tag">&lt;td</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"company"</span><span class="tag">&gt;</span><span class="pln">{{ entity.company }}</span><span class="tag">&lt;/td&gt;</span></li><li class="L1"><span class="pln">      </span><span class="tag">&lt;/tr&gt;</span></li><li class="L2"><span class="pln">    {% endfor %}</span></li><li class="L3"><span class="pln">  </span><span class="tag">&lt;/table&gt;</span></li><li class="L4"><span class="pln">{% endblock %}</span></li></ol></pre>
<br>
<h2>Inclure d'autres templates Twig</h2>
<p>Notez que nous avons copié/collé la balise <strong>&lt;table&gt;</strong> qui crée une liste d'offres à partir du template des offres <strong>index.html.twig</strong>. C'est une mauvaise solution. Lorsque vous avez besoin de réutiliser une partie d'un template, vous devez créer un nouveau template Twig avec ce code et l'inclure où vous en avez besoin.</p>
<p>Créez le fichier <strong>list.html.twig</strong>:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">&lt;!-- src/Ens/JobeetBundle/Resources/views/Job/list.html.twig --&gt;</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="tag">&lt;table</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"jobs"</span><span class="tag">&gt;</span></li><li class="L3"><span class="pln">  {% for entity in jobs %}</span></li><li class="L4"><span class="pln">    </span><span class="tag">&lt;tr</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"{{ cycle(['even', 'odd'], loop.index) }}"</span><span class="tag">&gt;</span></li><li class="L5"><span class="pln">      </span><span class="tag">&lt;td</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"location"</span><span class="tag">&gt;</span><span class="pln">{{ entity.location }}</span><span class="tag">&lt;/td&gt;</span></li><li class="L6"><span class="pln">      </span><span class="tag">&lt;td</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"position"</span><span class="tag">&gt;</span></li><li class="L7"><span class="pln">        </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('ens_job_show', { 'id': entity.id, 'company': entity.companyslug, 'location': entity.locationslug, 'position': entity.positionslug }) }}"</span><span class="tag">&gt;</span></li><li class="L8"><span class="pln">          {{ entity.position }}</span></li><li class="L9"><span class="pln">        </span><span class="tag">&lt;/a&gt;</span></li><li class="L0"><span class="pln">      </span><span class="tag">&lt;/td&gt;</span></li><li class="L1"><span class="pln">      </span><span class="tag">&lt;td</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"company"</span><span class="tag">&gt;</span><span class="pln">{{ entity.company }}</span><span class="tag">&lt;/td&gt;</span></li><li class="L2"><span class="pln">    </span><span class="tag">&lt;/tr&gt;</span></li><li class="L3"><span class="pln">  {% endfor %}</span></li><li class="L4"><span class="tag">&lt;/table&gt;</span></li></ol></pre>
<p>Vous pouvez inclure un template à l'aide de la balise <strong>{% include%}</strong>. Remplacez le code HTML <strong>&lt;table&gt;</strong> dans les deux templates avec la balise <strong>include</strong>:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">&lt;!-- in src/Ens/JobeetBundle/Resources/view/Job/index.html.twig --&gt;</span></li><li class="L1"><span class="pln">{% include 'EnsJobeetBundle:Job:list.html.twig' with {'jobs': category.activejobs} %}</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="com">&lt;!-- in src/Ens/JobeetBundle/Resources/view/Category/show.html.twig --&gt;</span></li><li class="L4"><span class="pln">{% include 'EnsJobeetBundle:Job:list.html.twig' with {'jobs': category.activejobs} %}</span></li></ol></pre>
<br>
<h2>Pagination de listes</h2>
<p>Au moment où ce tutoriel est écrit, Symfony2 ne fournit pas de réels bons outils de pagination "out of the box". Afin de résoudre ce problème, nous allons utiliser l'ancienne méthode classique.</p>
<p>Tout d'abord, nous allons ajouter un paramètre <strong>page</strong> à la route <strong>EnsJobeetBundle_category</strong>. Le paramètre <strong>page</strong> aura une valeur par défaut de 1, donc il ne sera pas obligatoire:</p>
<pre class="prettyprint linenums lang-yaml"><ol class="linenums"><li class="L0"><span class="com"># src/Ens/JobeetBundle/Resources/config/routing.yml</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="kwd">EnsJobeetBundle_category:</span></li><li class="L3"><span class="pln">    </span><span class="kwd">pattern: </span><span class="pln">/category/{slug}/{page}</span></li><li class="L4"><span class="pln">    </span><span class="kwd">defaults: </span><span class="pln">{ </span><span class="kwd">_controller: </span><span class="pln">EnsJobeetBundle</span><span class="pun">:</span><span class="pln">Category</span><span class="pun">:</span><span class="pln">show, </span><span class="kwd">page: </span><span class="pln">1 }</span></li><li class="L5"><span class="pln"> </span></li><li class="L6"><span class="com"># ...</span></li></ol></pre>
<p>Le nombre d'offres sur chaque page sera défini comme un paramètre personnalisé dans le fichier <strong>app/config/config.yml</strong>:</p>
<pre class="prettyprint linenums lang-yaml"><ol class="linenums"><li class="L0"><span class="com"># app/config/config.yml</span></li><li class="L1"><span class="com"># ...</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="kwd">parameters:</span></li><li class="L4"><span class="pln">    </span><span class="kwd">max_jobs_on_homepage: </span><span class="pln">10</span></li><li class="L5"><span class="pln">    </span><span class="kwd">max_jobs_on_category: </span><span class="pln">20</span></li></ol></pre>
<p>Modifiez la méthode <strong>getActiveJobs</strong> de <strong>JobRepository</strong> afin d'inclure un paramètre <strong>$offset</strong> pour être utilisé par Doctrine lors de la récupération des offres:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">// src/Ens/JobeetBundle/Repository/JobRepository.php</span></li><li class="L1"><span class="com">// ...</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> getActiveJobs</span><span class="pun">(</span><span class="pln">$category_id </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> $max </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> $offset </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span></li><li class="L4"><span class="pun">{</span></li><li class="L5"><span class="pln">  $qb </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">createQueryBuilder</span><span class="pun">(</span><span class="str">'j'</span><span class="pun">)</span></li><li class="L6"><span class="pln">    </span><span class="pun">-&gt;</span><span class="kwd">where</span><span class="pun">(</span><span class="str">'j.expires_at &gt; :date'</span><span class="pun">)</span></li><li class="L7"><span class="pln">    </span><span class="pun">-&gt;</span><span class="pln">setParameter</span><span class="pun">(</span><span class="str">'date'</span><span class="pun">,</span><span class="pln"> date</span><span class="pun">(</span><span class="str">'Y-m-d H:i:s'</span><span class="pun">,</span><span class="pln"> time</span><span class="pun">()))</span></li><li class="L8"><span class="pln">    </span><span class="pun">-&gt;</span><span class="pln">orderBy</span><span class="pun">(</span><span class="str">'j.expires_at'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'DESC'</span><span class="pun">);</span></li><li class="L9"><span class="pln"> </span></li><li class="L0"><span class="pln">  </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">$max</span><span class="pun">)</span></li><li class="L1"><span class="pln">  </span><span class="pun">{</span></li><li class="L2"><span class="pln">    $qb</span><span class="pun">-&gt;</span><span class="pln">setMaxResults</span><span class="pun">(</span><span class="pln">$max</span><span class="pun">);</span></li><li class="L3"><span class="pln">  </span><span class="pun">}</span></li><li class="L4"><span class="pln"> </span></li><li class="L5"><span class="pln">  </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">$offset</span><span class="pun">)</span></li><li class="L6"><span class="pln">  </span><span class="pun">{</span></li><li class="L7"><span class="pln">    $qb</span><span class="pun">-&gt;</span><span class="pln">setFirstResult</span><span class="pun">(</span><span class="pln">$offset</span><span class="pun">);</span></li><li class="L8"><span class="pln">  </span><span class="pun">}</span></li><li class="L9"><span class="pln"> </span></li><li class="L0"><span class="pln">  </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">$category_id</span><span class="pun">)</span></li><li class="L1"><span class="pln">  </span><span class="pun">{</span></li><li class="L2"><span class="pln">    $qb</span><span class="pun">-&gt;</span><span class="pln">andWhere</span><span class="pun">(</span><span class="str">'j.category = :category_id'</span><span class="pun">)</span></li><li class="L3"><span class="pln">       </span><span class="pun">-&gt;</span><span class="pln">setParameter</span><span class="pun">(</span><span class="str">'category_id'</span><span class="pun">,</span><span class="pln"> $category_id</span><span class="pun">);</span></li><li class="L4"><span class="pln">  </span><span class="pun">}</span></li><li class="L5"><span class="pln"> </span></li><li class="L6"><span class="pln">  $query </span><span class="pun">=</span><span class="pln"> $qb</span><span class="pun">-&gt;</span><span class="pln">getQuery</span><span class="pun">();</span></li><li class="L7"><span class="pln"> </span></li><li class="L8"><span class="pln">  </span><span class="kwd">return</span><span class="pln"> $query</span><span class="pun">-&gt;</span><span class="pln">getResult</span><span class="pun">();</span></li><li class="L9"><span class="pun">}</span></li><li class="L0"><span class="pln"> </span></li><li class="L1"><span class="com">// ...</span></li></ol></pre>
<p>Modifiez l'action <strong>showAction</strong> de <strong>CategoryController</strong> avec ce qui suit:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">// src/Ens/JobeetBundle/Controller/CategoryController.php</span></li><li class="L1"><span class="com">// ...</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> showAction</span><span class="pun">(</span><span class="pln">$slug</span><span class="pun">,</span><span class="pln"> $page</span><span class="pun">)</span></li><li class="L4"><span class="pun">{</span></li><li class="L5"><span class="pln">  $em </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">getDoctrine</span><span class="pun">()-&gt;</span><span class="pln">getEntityManager</span><span class="pun">();</span></li><li class="L6"><span class="pln"> </span></li><li class="L7"><span class="pln">  $category </span><span class="pun">=</span><span class="pln"> $em</span><span class="pun">-&gt;</span><span class="pln">getRepository</span><span class="pun">(</span><span class="str">'EnsJobeetBundle:Category'</span><span class="pun">)-&gt;</span><span class="pln">findOneBySlug</span><span class="pun">(</span><span class="pln">$slug</span><span class="pun">);</span></li><li class="L8"><span class="pln"> </span></li><li class="L9"><span class="pln">  </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">$category</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class="L0"><span class="pln">    </span><span class="kwd">throw</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">createNotFoundException</span><span class="pun">(</span><span class="str">'Unable to find Category entity.'</span><span class="pun">);</span></li><li class="L1"><span class="pln">  </span><span class="pun">}</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pln">  $total_jobs </span><span class="pun">=</span><span class="pln"> $em</span><span class="pun">-&gt;</span><span class="pln">getRepository</span><span class="pun">(</span><span class="str">'EnsJobeetBundle:Job'</span><span class="pun">)-&gt;</span><span class="pln">countActiveJobs</span><span class="pun">(</span><span class="pln">$category</span><span class="pun">-&gt;</span><span class="pln">getId</span><span class="pun">());</span></li><li class="L4"><span class="pln">  $jobs_per_page </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">container</span><span class="pun">-&gt;</span><span class="pln">getParameter</span><span class="pun">(</span><span class="str">'max_jobs_on_category'</span><span class="pun">);</span></li><li class="L5"><span class="pln">  $last_page </span><span class="pun">=</span><span class="pln"> ceil</span><span class="pun">(</span><span class="pln">$total_jobs </span><span class="pun">/</span><span class="pln"> $jobs_per_page</span><span class="pun">);</span></li><li class="L6"><span class="pln">  $previous_page </span><span class="pun">=</span><span class="pln"> $page </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> $page </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span></li><li class="L7"><span class="pln">  $next_page </span><span class="pun">=</span><span class="pln"> $page </span><span class="pun">&lt;</span><span class="pln"> $last_page </span><span class="pun">?</span><span class="pln"> $page </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> $last_page</span><span class="pun">;</span></li><li class="L8"><span class="pln"> </span></li><li class="L9"><span class="pln">  $category</span><span class="pun">-&gt;</span><span class="pln">setActiveJobs</span><span class="pun">(</span><span class="pln">$em</span><span class="pun">-&gt;</span><span class="pln">getRepository</span><span class="pun">(</span><span class="str">'EnsJobeetBundle:Job'</span><span class="pun">)-&gt;</span><span class="pln">getActiveJobs</span><span class="pun">(</span><span class="pln">$category</span><span class="pun">-&gt;</span><span class="pln">getId</span><span class="pun">(),</span><span class="pln"> $jobs_per_page</span><span class="pun">,</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$page </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> $jobs_per_page</span><span class="pun">));</span></li><li class="L0"><span class="pln"> </span></li><li class="L1"><span class="pln">  </span><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">render</span><span class="pun">(</span><span class="str">'EnsJobeetBundle:Category:show.html.twig'</span><span class="pun">,</span><span class="pln"> array</span><span class="pun">(</span></li><li class="L2"><span class="pln">    </span><span class="str">'category'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> $category</span><span class="pun">,</span></li><li class="L3"><span class="pln">    </span><span class="str">'last_page'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> $last_page</span><span class="pun">,</span></li><li class="L4"><span class="pln">    </span><span class="str">'previous_page'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> $previous_page</span><span class="pun">,</span></li><li class="L5"><span class="pln">    </span><span class="str">'current_page'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> $page</span><span class="pun">,</span></li><li class="L6"><span class="pln">    </span><span class="str">'next_page'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> $next_page</span><span class="pun">,</span></li><li class="L7"><span class="pln">    </span><span class="str">'total_jobs'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> $total_jobs</span></li><li class="L8"><span class="pln">  </span><span class="pun">));</span></li><li class="L9"><span class="pun">}</span></li></ol></pre>
<p>Enfin, nous allons mettre à jour le template:</p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="com">&lt;!-- src/Ens/JobeetBundle/Resources/views/Category/show.html.twig --&gt;</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="pln">{% extends 'EnsJobeetBundle::layout.html.twig' %}</span></li><li class="L3"><span class="pln"> </span></li><li class="L4"><span class="pln">{% block title %}</span></li><li class="L5"><span class="pln">  Jobs in the {{ category.name }} category</span></li><li class="L6"><span class="pln">{% endblock %}</span></li><li class="L7"><span class="pln"> </span></li><li class="L8"><span class="pln">{% block stylesheets %}</span></li><li class="L9"><span class="pln">  {{ parent() }}</span></li><li class="L0"><span class="pln">  </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"stylesheet"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ asset('bundles/ensjobeet/css/jobs.css') }}"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text/css"</span><span class="pln"> </span><span class="atn">media</span><span class="pun">=</span><span class="atv">"all"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L1"><span class="pln">{% endblock %}</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pln">{% block content %}</span></li><li class="L4"><span class="pln">  </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"category"</span><span class="tag">&gt;</span></li><li class="L5"><span class="pln">    </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"feed"</span><span class="tag">&gt;</span></li><li class="L6"><span class="pln">      </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">""</span><span class="tag">&gt;</span><span class="pln">Feed</span><span class="tag">&lt;/a&gt;</span></li><li class="L7"><span class="pln">    </span><span class="tag">&lt;/div&gt;</span></li><li class="L8"><span class="pln">    </span><span class="tag">&lt;h1&gt;</span><span class="pln">{{ category.name }}</span><span class="tag">&lt;/h1&gt;</span></li><li class="L9"><span class="pln">  </span><span class="tag">&lt;/div&gt;</span></li><li class="L0"><span class="pln"> </span></li><li class="L1"><span class="pln">  {% include 'EnsJobeetBundle:Job:list.html.twig' with {'jobs': category.activejobs} %}</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pln">  {% if last_page &gt; 1 %}</span></li><li class="L4"><span class="pln">    </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"pagination"</span><span class="tag">&gt;</span></li><li class="L5"><span class="pln">      </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('EnsJobeetBundle_category', { 'slug': category.slug, 'page': 1 }) }}"</span><span class="tag">&gt;</span></li><li class="L6"><span class="pln">        </span><span class="tag">&lt;img</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"{{ asset('bundles/ensjobeet/images/first.png') }}"</span><span class="pln"> </span><span class="atn">alt</span><span class="pun">=</span><span class="atv">"First page"</span><span class="pln"> </span><span class="atn">title</span><span class="pun">=</span><span class="atv">"First page"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L7"><span class="pln">      </span><span class="tag">&lt;/a&gt;</span></li><li class="L8"><span class="pln"> </span></li><li class="L9"><span class="pln">      </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('EnsJobeetBundle_category', { 'slug': category.slug, 'page': previous_page }) }}"</span><span class="tag">&gt;</span></li><li class="L0"><span class="pln">        </span><span class="tag">&lt;img</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"{{ asset('bundles/ensjobeet/images/previous.png') }}"</span><span class="pln"> </span><span class="atn">alt</span><span class="pun">=</span><span class="atv">"Previous page"</span><span class="pln"> </span><span class="atn">title</span><span class="pun">=</span><span class="atv">"Previous page"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L1"><span class="pln">      </span><span class="tag">&lt;/a&gt;</span></li><li class="L2"><span class="pln"> </span></li><li class="L3"><span class="pln">      {% for page in 1..last_page %}</span></li><li class="L4"><span class="pln">        {% if page == current_page %}</span></li><li class="L5"><span class="pln">          {{ page }}</span></li><li class="L6"><span class="pln">        {% else %}</span></li><li class="L7"><span class="pln">          </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('EnsJobeetBundle_category', { 'slug': category.slug, 'page': page }) }}"</span><span class="tag">&gt;</span><span class="pln">{{ page }}</span><span class="tag">&lt;/a&gt;</span></li><li class="L8"><span class="pln">        {% endif %}</span></li><li class="L9"><span class="pln">      {% endfor %}</span></li><li class="L0"><span class="pln"> </span></li><li class="L1"><span class="pln">      </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('EnsJobeetBundle_category', { 'slug': category.slug, 'page': next_page }) }}"</span><span class="tag">&gt;</span></li><li class="L2"><span class="pln">        </span><span class="tag">&lt;img</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"{{ asset('bundles/ensjobeet/images/next.png') }}"</span><span class="pln"> </span><span class="atn">alt</span><span class="pun">=</span><span class="atv">"Next page"</span><span class="pln"> </span><span class="atn">title</span><span class="pun">=</span><span class="atv">"Next page"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L3"><span class="pln">      </span><span class="tag">&lt;/a&gt;</span></li><li class="L4"><span class="pln"> </span></li><li class="L5"><span class="pln">      </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"{{ path('EnsJobeetBundle_category', { 'slug': category.slug, 'page': last_page }) }}"</span><span class="tag">&gt;</span></li><li class="L6"><span class="pln">        </span><span class="tag">&lt;img</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"{{ asset('bundles/ensjobeet/images/last.png') }}"</span><span class="pln"> </span><span class="atn">alt</span><span class="pun">=</span><span class="atv">"Last page"</span><span class="pln"> </span><span class="atn">title</span><span class="pun">=</span><span class="atv">"Last page"</span><span class="pln"> </span><span class="tag">/&gt;</span></li><li class="L7"><span class="pln">      </span><span class="tag">&lt;/a&gt;</span></li><li class="L8"><span class="pln">    </span><span class="tag">&lt;/div&gt;</span></li><li class="L9"><span class="pln">  {% endif %}</span></li><li class="L0"><span class="pln"> </span></li><li class="L1"><span class="pln">  </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"pagination_desc"</span><span class="tag">&gt;</span></li><li class="L2"><span class="pln">    </span><span class="tag">&lt;strong&gt;</span><span class="pln">{{ total_jobs }}</span><span class="tag">&lt;/strong&gt;</span><span class="pln"> jobs in this category</span></li><li class="L3"><span class="pln"> </span></li><li class="L4"><span class="pln">    {% if last_page &gt; 1 %}</span></li><li class="L5"><span class="pln">      - page </span><span class="tag">&lt;strong&gt;</span><span class="pln">{{ current_page }}/{{ last_page }}</span><span class="tag">&lt;/strong&gt;</span></li><li class="L6"><span class="pln">    {% endif %}</span></li><li class="L7"><span class="pln">  </span><span class="tag">&lt;/div&gt;</span></li><li class="L8"><span class="pln">{% endblock %}</span></li></ol></pre>
<p>Le résultat:</p>
<p class="tcenter"><a href="assets/img/jobeet_7-2.png" rel="shadowbox"><img src="assets/img/jobeet_7-2.png" alt="" class="img-polaroid"></a></p>
<br>
<p class="clearfix noprint">
	<a href="aller-plus-loin-avec-le-modele" class="btn btn-success pull-left">Chapitre précédent</a>
	<a href="les-tests-unitaires" class="btn btn-success pull-right">Chapitre suivant</a>
</p>														<p class="link_source noprint"><a href="http://www.ens.ro/2012/04/11/symfony2-jobeet-day-7-playing-with-the-category-page/" target="_blank">» Lire l'article original</a></p>
																					<br>